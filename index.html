<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mato Real Manager v1.42.4</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg-dark: #121212; --bg-card: #1E1E1E; --bg-input: #2C2C2C; --primary: #00E676; --secondary: #2979FF; --danger: #FF1744; --warning: #FFC400; --purple: #D500F9; --info: #00BCD4; --text-main: #FFFFFF; --border: #333333; }
        body { background: var(--bg-dark); color: var(--text-main); font-family: 'Roboto', sans-serif; margin: 0; padding-bottom: 80px; -webkit-font-smoothing: antialiased; }
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }
        .card { background: var(--bg-card); padding: 15px; border-radius: 12px; margin-bottom: 12px; border: 1px solid var(--border); box-shadow: 0 4px 6px rgba(0,0,0,0.4); position: relative; }
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px; transition: 0.2s; margin-bottom: 5px; color: white; }
        .btn:active { transform: scale(0.98); }
        .btn-green { background: var(--primary); color: #000; } .btn-blue { background: var(--secondary); } .btn-red { background: var(--danger); } .btn-gold { background: var(--warning); color: #000; } .btn-purple { background: var(--purple); }
        .btn-ghost { background: transparent; border: 1px solid #666; color: #ccc; }
        .input-field { width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border); color: white; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; font-family: inherit; font-size: 14px; }
        .header { background: rgba(30, 30, 30, 0.95); backdrop-filter: blur(10px); padding: 15px; position: sticky; top: 0; z-index: 50; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .badge-pos { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 900; margin-right: 8px; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }
        .player-ov { background: #003300; color: #00E676; border: 1px solid #00E676; padding: 2px 6px; border-radius: 4px; font-weight: 900; font-size: 14px; }
        .news-card { background: #262626; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #666; font-size: 13px; line-height: 1.4; white-space: pre-wrap; }
        .news-transfer { border-color: var(--secondary); background: linear-gradient(90deg, #1a1a2e, #16213e); } .news-money { border-color: var(--primary); } .news-money-minus { border-color: var(--danger); } .news-admin { border-color: var(--warning); background: #2a2000; } .news-press { border-color: #00bcd4; background: #003333; } .news-product { border-color: #E91E63; background: #280b18; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #1a1a1a; border-top: 1px solid var(--border); display: flex; padding-bottom: env(safe-area-inset-bottom); z-index: 100; }
        .nav-item { flex: 1; padding: 12px; text-align: center; color: #666; font-size: 9px; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; margin-bottom: 4px; display: block; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 999; display: grid; place-items: center; padding: 15px; backdrop-filter: blur(5px); }
        .modal-content { background: var(--bg-card); width: 100%; max-width: 450px; padding: 20px; border-radius: 12px; border: 1px solid var(--border); max-height: 90vh; overflow-y: auto; }
        .login-tabs { display: flex; border-bottom: 1px solid #333; margin-bottom: 20px; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; color: #666; font-weight: bold; }
        .tab.active { color: var(--primary); border-bottom: 3px solid var(--primary); }
        .rating-badge { color: var(--warning); font-weight: bold; font-size: 11px; margin-left: 5px; display: flex; align-items: center; gap: 2px; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; font-size: 10px; margin-top: 10px; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 8px; }
        .stat-item { display: flex; flex-direction: column; align-items: center; justify-content: center; } .stat-lbl { font-size: 14px; margin-bottom: 2px; } .stat-val { color: #fff; font-weight: 900; font-size: 11px; }
        .dev-credits { font-size: 10px; color: #666; margin-top: -5px; margin-bottom: 15px; text-align: center; display: block; width: 100%; }
        .error-screen { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #220000; color: #ff5555; padding: 20px; text-align: center; }
        .rank-tabs { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 10px; } .rank-tabs::-webkit-scrollbar { display: none; }
        .rank-tab { background: #333; border: 1px solid #444; color: #888; padding: 8px 16px; border-radius: 20px; font-size: 12px; white-space: nowrap; cursor: pointer; transition: 0.2s; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .rank-tab.active { background: var(--primary); color: #000; border-color: var(--primary); }
        .highlight-card { background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%); border: 1px solid var(--secondary); padding: 20px; text-align: center; margin-bottom: 15px; border-radius: 12px; position: relative; overflow: hidden; }
        .product-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; } .product-card { background: #222; border-radius: 8px; overflow: hidden; border: 1px solid #444; text-align: center; } .product-img { width: 100%; height: 100px; object-fit: cover; } .product-info { padding: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const firebaseConfig = { apiKey: "AIzaSyBrtJFfWAqT0AZYHlm4it-noB5h9jIPJEI", authDomain: "gerenciador-de-times-matoreal.firebaseapp.com", projectId: "gerenciador-de-times-matoreal", storageBucket: "gerenciador-de-times-matoreal.firebasestorage.app", messagingSenderId: "29096266740", appId: "1:29096266740:web:ec48e7225c18c20dbc07a1" };
        try { if (!firebase.apps.length) firebase.initializeApp(firebaseConfig); } catch (e) { console.error(e); }
        const db = firebase.firestore();
        const { useState, useEffect } = React;

        const POS = ['GOL', 'ZAG', 'LD', 'LE', 'VOL', 'MC', 'MEI', 'ATA'];
        const SERIES = ['A', 'B', 'C', 'D'];
        const COSTS = [0, 5000000, 20000000, 50000000, 100000000];
        const COMPANY_TYPES = { 'LARGE': { label: 'üè¢ Grande', initial: 500000000, tax: 20000000 }, 'MEDIUM': { label: 'üè≠ M√©dia', initial: 100000000, tax: 2000000 }, 'COMMERCE': { label: 'üè™ Com√©rcio', initial: 10000000, tax: 100000 } };
        const fmt = (v) => "‚Ç£ " + parseFloat(v||0).toLocaleString('pt-BR');
        const getPosColor = (p) => { if(!p) return '#555'; if(p==='GOL') return '#FFD700'; if(['ZAG','LD','LE'].some(x=>p.includes(x))) return '#2979FF'; if(['VOL','MC','MEI'].some(x=>p.includes(x))) return '#00E676'; return '#FF1744'; };

        class ErrorBoundary extends React.Component { constructor(props) { super(props); this.state = { hasError: false, error: null }; } static getDerivedStateFromError(error) { return { hasError: true, error }; } componentDidCatch(error, errorInfo) { console.error("Crash:", error, errorInfo); } render() { if (this.state.hasError) return <div className="error-screen"><h2>Erro Cr√≠tico</h2><p>{this.state.error?.toString()}</p><button className="btn btn-red" onClick={()=>{localStorage.clear(); window.location.reload();}}>REINICIAR</button></div>; return this.props.children; } }

        const formatOfferDetails = (type, v, con, meta, swapIds, players) => {
            let details = []; if(v > 0) details.push(`üí∞ Valor: ${fmt(v)}`); if (meta.installments > 1) details.push(`üìÖ Parcelamento: ${meta.installments}x de ${fmt(v/meta.installments)}`); if (type !== 'TROCA') details.push(`üìù Contrato: ${con} Temporadas`); if (type === 'COMPRA' && meta.sellOn > 0) details.push(`üìà Revenda: ${meta.sellOn}%`); if (type === 'EMPRESTIMO') { details.push(`üí∏ Sal√°rio: Paga ${meta.wageSplit}%`); if (meta.buyOpt > 0) details.push(`üõí Op√ß√£o: ${fmt(meta.buyOpt)}`); } if (type === 'TROCA') { if (swapIds && swapIds.length > 0) { const swapNames = swapIds.map(id => players.find(p=>p.id===id)?.name).join(', '); details.push(`üîÑ Troca por: ${swapNames}`); } if (v > 0) details.push(`üíµ Volta: ${meta.cashDir === 'PAY' ? 'Pago' : 'Recebo'} ${fmt(v)}`); } return details.join('\n');
        };

        function App() {
            const [user, setUser] = useState(null); 
            const [teams, setTeams] = useState([]);
            const [players, setPlayers] = useState([]);
            const [offers, setOffers] = useState([]);
            const [news, setNews] = useState([]);
            const [reqs, setReqs] = useState([]);
            const [conf, setConf] = useState({ marketOpen: true });
            const [papers, setPapers] = useState([]);
            const [journalists, setJournalists] = useState([]);
            const [companies, setCompanies] = useState([]);
            const [sponReqs, setSponReqs] = useState([]);
            const [products, setProducts] = useState([]);
            const [screen, setScreen] = useState('HOME');
            const [modal, setModal] = useState(null);
            const [loading, setLoading] = useState(true);
            const [adminTeam, setAdminTeam] = useState(null); 

            useEffect(() => {
                const unsubs = [
                    db.collection('teams').onSnapshot(s => setTeams(s.docs.map(d => ({id:d.id, ...d.data()})))),
                    db.collection('players').onSnapshot(s => setPlayers(s.docs.map(d => ({id:d.id, ...d.data()})))),
                    db.collection('config').doc('system').onSnapshot(s => setConf(s.exists ? s.data() : {marketOpen:true})),
                    db.collection('financeRequests').onSnapshot(s => setReqs(s.docs.map(d => ({id:d.id, ...d.data()})))),
                    db.collection('newspapers').onSnapshot(s => setPapers(s.docs.map(d => ({id:d.id, ...d.data()})))),
                    db.collection('journalists').onSnapshot(s => setJournalists(s.docs.map(d => ({id:d.id, ...d.data()})))),
                    db.collection('companies').onSnapshot(s => setCompanies(s.docs.map(d => ({id:d.id, ...d.data()})))),
                    db.collection('sponRequests').onSnapshot(s => setSponReqs(s.docs.map(d => ({id:d.id, ...d.data()})))),
                    db.collection('products').orderBy('date', 'desc').onSnapshot(s => setProducts(s.docs.map(d => ({id:d.id, ...d.data()})))),
                    db.collection('news').orderBy('date', 'desc').limit(50).onSnapshot(s => { const list = s.docs.map(d => ({id:d.id, ...d.data()})); setNews(list); setLoading(false); })
                ];
                return () => unsubs.forEach(u => u());
            }, []);

            useEffect(() => {
                if (user?.type === 'USER') { const me = teams.find(t => t.id === user.data.id); if (me) setUser(prev => ({...prev, data: me})); return db.collection('offers').where('sellerId', '==', user.data.id).onSnapshot(s => setOffers(s.docs.map(d => ({id:d.id, ...d.data()})))); }
                if (user?.type === 'COMPANY') { const me = companies.find(c => c.id === user.data.id); if (me) setUser(prev => ({...prev, data: me})); }
            }, [teams, companies, user?.data?.id]);
            const postNews = (text, type='normal') => db.collection('news').add({ text, type, date: Date.now() });

            const login = (id, pwd, type) => {
                if (type === 'TEAM') { const t = teams.find(x => x.id === id); if (t && t.password === pwd) { if (t.status === 'PENDING') alert("Aguarde a Federa√ß√£o."); else { setUser({type:'USER', data:t}); setScreen('HOME'); } } else alert("Erro!"); } 
                else if (type === 'PAPER') { const p = papers.find(x => x.id === id); if (p && p.password === pwd) { if (p.status === 'PENDING') alert("Aguarde a Federa√ß√£o."); else { setUser({type:'PRESS', data:p}); setScreen('PRESS_DASH'); } } else alert("Erro!"); } 
                else if (type === 'JOURNALIST') { const j = journalists.find(x => x.id === id); if (j && j.password === pwd) { if (j.status === 'PENDING') alert("Aguarde o Dono."); else { setUser({type:'PRESS_WORKER', data:j}); setScreen('PRESS_DASH'); } } else alert("Erro!"); }
                else if (type === 'COMPANY') { const c = companies.find(x => x.id === id); if (c && c.password === pwd) { if (c.status === 'PENDING') alert("Aguarde a Federa√ß√£o."); else { setUser({type:'COMPANY', data:c}); setScreen('COMPANY_DASH'); } } else alert("Erro!"); }
            };
            const loginAdmin = () => { setUser({ type: 'ADMIN', data: { id: 'admin', name: 'FEDERA√á√ÉO (ADM)', balance: 0, logo: null, stadiumLevel: 1, serie: 'ADM' } }); setScreen('HOME'); };

            // --- ADMIN ACTIONS ---
            const approveTeam = async (id, bal) => { await db.collection('teams').doc(id).update({ status: 'ACTIVE', balance: parseFloat(bal) }); postNews(`üõ°Ô∏è **NOVO CLUBE**\nAprovado na liga!`, 'infra'); };
            const deleteTeam = async (id) => { if(!confirm("Excluir?")) return; const b = db.batch(); b.delete(db.collection('teams').doc(id)); const s = await db.collection('players').where('teamId', '==', id).get(); s.docs.forEach(d => b.delete(d.ref)); await b.commit(); };
            const approveCompany = async (id) => { await db.collection('companies').doc(id).update({ status: 'ACTIVE' }); const c = companies.find(x=>x.id===id); postNews(`üè¢ **NOVA EMPRESA**\n${c.name} iniciou opera√ß√µes.`, 'money'); };
            const deleteCompany = async (id) => { if(!confirm("Fechar empresa?")) return; await db.collection('companies').doc(id).delete(); };
            const deletePaper = async (id) => { if(!confirm("Excluir jornal?")) return; const b = db.batch(); b.delete(db.collection('newspapers').doc(id)); const j = await db.collection('journalists').where('newspaperId', '==', id).get(); j.docs.forEach(d => b.delete(d.ref)); await b.commit(); };
            const deleteJourno = async (id) => { if(!confirm("Demitir?")) return; await db.collection('journalists').doc(id).delete(); };
            const createTeam = async (n, b, s, p, l) => { await db.collection('teams').add({name:n, balance:parseFloat(b), serie:s, password:p, logo:l, status:'PENDING', stadiumLevel:1}); alert("Aguarde!"); };
            const createCompany = async (n, o, t, p) => { await db.collection('companies').add({name:n, owner:o, type:t, balance:COMPANY_TYPES[t].initial, tax:COMPANY_TYPES[t].tax, password:p, status:'PENDING'}); alert("Aguarde!"); };

            // --- GAME LOGIC ---
            const savePlayer = async (d) => {
                const targetTeamId = (user.type==='ADMIN' && adminTeam) ? adminTeam.id : (user.type==='USER' ? user.data.id : d.teamId);
                let payload = { name: d.name, position: d.position, overall: parseInt(d.overall)||0, value: parseFloat(d.value)||0, salary: parseFloat(d.salary)||0, clause: parseFloat(d.clause)||0, contract: parseInt(d.contract)||0, mood: d.mood, status: d.status, teamId: targetTeamId, loan: false, rating: d.rating ? parseFloat(d.rating) : 0, stats: { goals: parseInt(d.stats?.goals||0), assists: parseInt(d.stats?.assists||0), tackles: parseInt(d.stats?.tackles||0), saves: parseInt(d.stats?.saves||0), yellows: parseInt(d.stats?.yellows||0), reds: parseInt(d.stats?.reds||0) } };
                if(d.id) { await db.collection('players').doc(d.id).update(payload); } else { await db.collection('players').add(payload); postNews(`üÜï **REFOR√áO**\n${(teams.find(t=>t.id===payload.teamId)||{}).name} contrata ${d.name}.`, 'transfer'); } setModal(null);
            };

            const sendOffer = async (target, type, value, swapIds, con, meta, old) => {
                const v = parseFloat(value||0);
                const detailText = formatOfferDetails(type, v, con, meta, swapIds, players);
                const actingName = user.data.name; 
                let headline = "", sellerId = null;
                if (old && old.id) {
                    sellerId = old.buyerId; 
                    headline = `üîÑ **CONTRAPROPOSTA**\nO **${actingName}** enviou novos termos ao **${teams.find(t=>t.id===sellerId)?.name}** por **${target.name}**.`;
                } else {
                    headline = `üö® **PROPOSTA**\nO **${actingName}** quer contratar **${target.name}** do **${teams.find(t=>t.id===target.teamId)?.name}**.`;
                    sellerId = target.teamId;
                }
                if (!sellerId) return alert("Erro: Vendedor n√£o identificado.");
                const pl = { playerId: target.id, playerName: target.name, buyerId: user.data.id, buyerName: user.data.name, sellerId, type, value: v, swapPlayerIds: swapIds || [], offerContract: parseInt(con) || 1, description: detailText, meta: meta || {}, date: Date.now() };
                const b = db.batch(); if(old && old.id) b.delete(db.collection('offers').doc(old.id)); b.set(db.collection('offers').doc(), pl); await b.commit();
                postNews(`${headline}\n\nüìÑ **Detalhes:**\n${detailText}`, 'transfer'); setModal(null); alert("Enviada!");
            };

            const acceptOffer = async (o) => {
                const buy = teams.find(t=>t.id===o.buyerId); const sel = teams.find(t=>t.id===user.data.id); const p = players.find(x=>x.id===o.playerId);
                let cost = o.value; if(o.type === 'TROCA' && o.meta?.cashDir === 'RECEIVE') cost = -o.value; 
                if (o.type === 'COMPRA' && o.meta?.installments > 1) {
                    if (buy.balance < (cost / o.meta.installments)) return alert("Saldo insuficiente (1¬™ parc)!");
                    db.collection('debts').add({ buyerId: buy.id, buyerName: buy.name, sellerId: sel.id, sellerName: sel.name, playerId: p.id, playerName: p.name, totalVal: cost, installmentVal: cost / o.meta.installments, weeksRemaining: parseInt(o.meta.installments), date: Date.now() }); cost = 0; 
                } else { if (buy.balance < cost) return alert("Sem saldo!"); }
                const b = db.batch(); if(cost !== 0) { b.update(db.collection('teams').doc(buy.id), {balance: buy.balance - cost}); b.update(db.collection('teams').doc(sel.id), {balance: sel.balance + cost}); }
                if(o.type==='COMPRA') b.update(db.collection('players').doc(p.id), {teamId: buy.id, status:'NAO_A_VENDA', loan:false, contract: parseInt(o.offerContract)});
                else if(o.type==='EMPRESTIMO') b.update(db.collection('players').doc(p.id), { teamId: buy.id, status:'NAO_A_VENDA', loan:true, loanFrom: sel.id });
                else if(o.type==='TROCA') { b.update(db.collection('players').doc(p.id), {teamId: buy.id}); if(o.swapPlayerIds) o.swapPlayerIds.forEach(id=>b.update(db.collection('players').doc(id), {teamId: sel.id})); }
                setOffers(prev => prev.filter(off => off.id !== o.id)); b.delete(db.collection('offers').doc(o.id)); await b.commit();
                postNews(`ü§ù **NEG√ìCIO FECHADO**\n**${buy.name}** fechou com **${p.name}**!`, 'transfer');
            };

            // --- ADMIN PANEL COMPONENT ---
            const AdminPanel = ({ teams, papers, journalists, companies, reqs, config, onAct, onPost, onApproveTeam, onDeleteTeam, onApproveCompany, onDeleteCompany, onDeletePaper, onDeleteJourno }) => ( 
                <div><h3>Painel Master</h3>
                <div className="card"><button className={`btn ${config.marketOpen?'btn-red':'btn-green'}`} onClick={()=>onAct('MARKET', !config.marketOpen)}>{config.marketOpen?'FECHAR MERCADO':'ABRIR MERCADO'}</button><button className="btn btn-purple" onClick={()=>onAct('WEEK')}>VIRAR SEMANA</button><button className="btn btn-red" onClick={()=>onAct('SEASON')}>VIRAR TEMPORADA</button><button className="btn btn-gold" onClick={()=>{ const t=prompt("T√≠tulo"); const b=prompt("Texto"); if(t)onPost(t,b,'admin'); }}>COMUNICADO</button></div>
                
                {/* PENDENTES */}
                {(teams||[]).filter(t=>t.status==='PENDING').map(t=><div key={t.id} className="card"><b>{t.name}</b> <button className="btn-green" onClick={()=>onApproveTeam(t.id, t.balance)}>V</button> <button className="btn-red" onClick={()=>onDeleteTeam(t.id)}>X</button></div>)}
                {(companies||[]).filter(c=>c.status==='PENDING').map(c=><div key={c.id} className="card"><b>{c.name}</b> ({(COMPANY_TYPES[c.type]||{}).label}) <button className="btn-green" onClick={()=>onApproveCompany(c.id)}>V</button> <button className="btn-red" onClick={()=>onDeleteCompany(c.id)}>X</button></div>)}
                
                <h4>Gest√£o</h4>
                <div style={{maxHeight:200, overflowY:'auto'}}>
                    {(papers||[]).map(p=><div key={p.id} className="card">üì∞ {p.name} <button className="btn-red" style={{width:'auto'}} onClick={()=>onDeletePaper(p.id)}>X</button></div>)}
                    {(companies||[]).filter(c=>c.status==='ACTIVE').map(c=><div key={c.id} className="card">üè¢ {c.name} <button className="btn-red" style={{width:'auto'}} onClick={()=>onDeleteCompany(c.id)}>X</button></div>)}
                    {(journalists||[]).map(j=><div key={j.id} className="card">‚úíÔ∏è {j.name} <button className="btn-red" style={{width:'auto'}} onClick={()=>onDeleteJourno(j.id)}>X</button></div>)}
                </div>
                </div> 
            );

            // --- SUB COMPONENTS (SIMPLIFIED) ---
            const PlayerForm = ({ initial, onSave, onDelete, isAdmin, teams }) => { 
                const [f, setF] = useState(initial || {name:'', position:'ATA', overall:0, value:0, salary:0, clause:0, contract:0, mood:'üòê', status:'NAO_A_VENDA', rating:0, stats:{goals:0,assists:0,tackles:0,saves:0,yellows:0,reds:0}});
                return ( <div><label>Nome</label><input className="input-field" value={f.name} onChange={e=>setF({...f, name:e.target.value})} /><div style={{display:'flex', gap:5}}><input className="input-field" type="number" placeholder="Overall" value={f.overall} onChange={e=>setF({...f, overall:e.target.value})} /><select className="input-field" value={f.position} onChange={e=>setF({...f, position:e.target.value})}>{POS.map(p=><option key={p} value={p}>{p}</option>)}</select></div><div style={{display:'flex', gap:5}}><input className="input-field" type="number" placeholder="Valor" value={f.value} onChange={e=>setF({...f, value:e.target.value})} /><input className="input-field" type="number" placeholder="Sal√°rio" value={f.salary} onChange={e=>setF({...f, salary:e.target.value})} /></div><div style={{display:'flex', gap:5}}><input className="input-field" type="number" placeholder="Multa" value={f.clause} onChange={e=>setF({...f, clause:e.target.value})} /><input className="input-field" type="number" placeholder="Contrato" value={f.contract} onChange={e=>setF({...f, contract:e.target.value})} /></div><select className="input-field" value={f.status} onChange={e=>setF({...f, status:e.target.value})}><option value="NAO_A_VENDA">N√£o Listado</option><option value="VENDA">√Ä Venda</option><option value="EMPRESTIMO">Empr√©stimo</option></select>{isAdmin && <div style={{border:'1px solid var(--primary)', padding:5, borderRadius:5}}><label style={{color:'var(--primary)'}}>Stats</label><div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:5}}><input className="input-field" placeholder="Gols" value={f.stats?.goals} onChange={e=>setF({...f, stats:{...f.stats, goals:e.target.value}})} /><input className="input-field" placeholder="Assis" value={f.stats?.assists} onChange={e=>setF({...f, stats:{...f.stats, assists:e.target.value}})} /><input className="input-field" placeholder="Ama" value={f.stats?.yellows} onChange={e=>setF({...f, stats:{...f.stats, yellows:e.target.value}})} /><input className="input-field" placeholder="Ver" value={f.stats?.reds} onChange={e=>setF({...f, stats:{...f.stats, reds:e.target.value}})} /></div></div>}<div style={{display:'flex', gap:10, marginTop:10}}><button className="btn btn-green" onClick={()=>onSave(f)}>SALVAR</button>{initial && <button className="btn btn-red" onClick={()=>onDelete(initial.id)}>EXCLUIR</button>}</div></div> ); 
            };
            
            const LoginScreen = ({ teams, papers, journalists, companies, onLogin, onCreateTeam, onCreatePaper, onCreateJourno, onCreateComp, onAdmin, onVisitor }) => {
                const [tab, setTab] = useState('LOGIN'); const [sub, setSub] = useState('TEAM'); const [f, setF] = useState({n:'', b:'10000000', s:'A', p:'', type:'LARGE', owner:''}); const [sel, setSel] = useState(null); const [lp, setLp] = useState('');
                const handleUpload = (e) => { const file=e.target.files[0]; const reader=new FileReader(); reader.onloadend=()=>setF({...f, l:reader.result}); if(file) reader.readAsDataURL(file); };
                return ( <div style={{minHeight:'100vh', padding:20, textAlign:'center'}}><h1 style={{color:'var(--primary)'}}>Mato Real <small style={{color:'#fff', fontSize:12}}>v1.42.4</small></h1><div className="login-tabs"><div className={`tab ${tab==='LOGIN'?'active':''}`} onClick={()=>setTab('LOGIN')}>ENTRAR</div><div className={`tab ${tab==='CREATE'?'active':''}`} onClick={()=>setTab('CREATE')}>CRIAR</div><div className={`tab ${tab==='PRESS'?'active':''}`} onClick={()=>setTab('PRESS')}>IMPRENSA</div><div className={`tab ${tab==='EMP'?'active':''}`} onClick={()=>setTab('EMP')}>EMPRESA</div></div>
                    {tab==='LOGIN' && <div>{(teams||[]).filter(t=>t.status!=='PENDING').map(t=><div key={t.id} className="card" onClick={()=>setSel({...t, type:'TEAM'})}><b>{t.name}</b> (S√©rie {t.serie})</div>)}<div style={{marginTop:20}}><button className="btn btn-blue" onClick={onVisitor}>VISITANTE</button><button className="btn btn-ghost" onClick={()=>{if(prompt("Senha:")==='2503') onAdmin()}}>ADMIN</button></div></div>}
                    {tab==='CREATE' && <div><input type="file" onChange={handleUpload}/><input className="input-field" placeholder="Nome" value={f.n} onChange={e=>setF({...f, n:e.target.value})}/><input className="input-field" placeholder="Saldo" value={f.b} onChange={e=>setF({...f, b:e.target.value})}/><input className="input-field" placeholder="Senha" value={f.p} onChange={e=>setF({...f, p:e.target.value})}/><button className="btn btn-green" onClick={()=>onCreateTeam(f.n, f.b, 'A', f.p, f.l)}>CRIAR</button></div>}
                    {tab==='PRESS' && <div><div style={{display:'flex', gap:10}}><button className="btn" onClick={()=>setSub('PL')}>Login</button><button className="btn" onClick={()=>setSub('PC')}>Jornal</button><button className="btn" onClick={()=>setSub('JC')}>Jornalista</button></div>
                        {sub==='PL' && (papers||[]).map(p=><div key={p.id} className="card" onClick={()=>setSel({...p, type:'PAPER'})}>üì∞ {p.name}</div>)}
                        {sub==='PC' && <div><input className="input-field" placeholder="Jornal" id="pn"/><input className="input-field" placeholder="Dono" id="po"/><input className="input-field" placeholder="Senha" id="pp"/><button className="btn btn-green" onClick={()=>onCreatePaper(document.getElementById('pn').value, document.getElementById('pp').value, document.getElementById('po').value)}>CRIAR</button></div>}
                        {sub==='JC' && <div><input className="input-field" placeholder="Nome" id="jn"/><select className="input-field" id="jid">{(papers||[]).map(p=><option key={p.id} value={p.id}>{p.name}</option>)}</select><input className="input-field" placeholder="Senha" id="jp"/><button className="btn btn-green" onClick={()=>onCreateJourno(document.getElementById('jn').value, document.getElementById('jp').value, document.getElementById('jid').value)}>CRIAR</button></div>}
                    </div>}
                    {tab==='EMP' && <div><div style={{display:'flex', gap:10}}><button className="btn" onClick={()=>setSub('EL')}>Login</button><button className="btn" onClick={()=>setSub('EC')}>Criar</button></div>
                        {sub==='EL' && (companies||[]).map(c=><div key={c.id} className="card" onClick={()=>setSel({...c, type:'COMPANY'})}>üè¢ {c.name}</div>)}
                        {sub==='EC' && <div><input className="input-field" placeholder="Nome" value={f.n} onChange={e=>setF({...f, n:e.target.value})}/><input className="input-field" placeholder="Dono" value={f.owner} onChange={e=>setF({...f, owner:e.target.value})}/><select className="input-field" value={f.type} onChange={e=>setF({...f, type:e.target.value})}>{Object.keys(COMPANY_TYPES).map(k=><option key={k} value={k}>{COMPANY_TYPES[k].label}</option>)}</select><input className="input-field" placeholder="Senha" value={f.p} onChange={e=>setF({...f, p:e.target.value})}/><button className="btn btn-green" onClick={()=>onCreateComp(f.n, f.owner, f.type, f.p)}>CRIAR</button></div>}
                    </div>}
                    {sel && <div className="modal-overlay"><div className="modal-content"><h3>{sel.name}</h3><input className="input-field" type="password" placeholder="Senha" value={lp} onChange={e=>setLp(e.target.value)} /><button className="btn btn-green" onClick={()=>onLogin(sel.id, lp, sel.type)}>ENTRAR</button><button className="btn" onClick={()=>setSel(null)}>CANCELAR</button></div></div>}
                </div>
            );
        };
        
        const Ranking = ({ teams, players }) => ( <div><h3>Ranking</h3>{teams.filter(t=>t.status!=='PENDING').map(t=>{ const sv=players.filter(p=>p.teamId===t.id).reduce((a,b)=>a+(b.value||0),0); return {...t, w: t.balance+sv}; }).sort((a,b)=>b.w-a.w).map((t,i)=><div key={t.id} className="card"><b>{i+1}. {t.name}</b><br/>Patrim√¥nio: {fmt(t.w)}</div>)}</div> );
        
        // --- MAIN RENDER ---
        if(loading) return <div style={{display:'grid', placeItems:'center', height:'100vh'}}>Carregando...</div>;
        if(!user) return <LoginScreen teams={teams} papers={papers} journalists={journalists} companies={companies} onLogin={login} onCreateTeam={createTeam} onCreatePaper={createNewspaper} onCreateJourno={createJournalist} onCreateComp={createCompany} onAdmin={loginAdmin} onVisitor={()=>{setUser({type:'VISITOR'}); setScreen('RANKING');}} />;

        return (
            <div>
                <div className="header"><div style={{fontWeight:'bold'}}>{user.type==='ADMIN'?'MASTER':user.data.name}</div><div onClick={()=>window.location.reload()}>SAIR</div></div>
                <div className="container">
                    {screen==='HOME' && user.type==='ADMIN' && <AdminPanel teams={teams} papers={papers} journalists={journalists} companies={companies} config={conf} onAct={adminAction} onPost={postNews} onApproveTeam={approveTeam} onDeleteTeam={deleteTeam} onApproveCompany={approveCompany} onDeleteCompany={deleteCompany} onDeletePaper={deletePaper} onDeleteJourno={deleteJournalist} />}
                    {screen==='HOME' && user.type==='USER' && <div><h3>Seu Time</h3><button className="btn btn-green" onClick={()=>setModal({type:'PLAYER'})}>+ JOGADOR</button>{players.filter(p=>p.teamId===user.data.id).map(p=><div key={p.id} className="card" onClick={()=>setModal({type:'PLAYER', data:p})}><b>{p.name}</b> ({p.position}) - {p.overall}</div>)}</div>}
                    {screen==='RANKING' && <Ranking teams={teams} players={players} />}
                    {screen==='OFFERS' && <div><h3>Propostas</h3>{offers.map(o=><div key={o.id} className="card">{o.description}<br/><button className="btn-green" onClick={()=>acceptOffer(o)}>V</button><button className="btn-red" onClick={()=>rejectOffer(o)}>X</button></div>)}</div>}
                    {modal && <div className="modal-overlay" onClick={()=>setModal(null)}><div className="modal-content" onClick={e=>e.stopPropagation()}>
                        {modal.type==='PLAYER' && <PlayerForm initial={modal.data} onSave={savePlayer} onDelete={(id)=>{db.collection('players').doc(id).delete(); setModal(null);}} isAdmin={user.type==='ADMIN'} teams={teams} />}
                    </div></div>}
                </div>
                <div className="bottom-nav">
                    <div className="nav-item" onClick={()=>setScreen('HOME')}>üè†</div>
                    <div className="nav-item" onClick={()=>setScreen('RANKING')}>üèÜ</div>
                    {user.type==='USER' && <div className="nav-item" onClick={()=>setScreen('OFFERS')}>üîî {offers.length>0 && '‚Ä¢'}</div>}
                </div>
            </div>
        );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ErrorBoundary><App /></ErrorBoundary>);
    </script>
</body>
</html>
