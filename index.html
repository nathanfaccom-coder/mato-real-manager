<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mato Real Manager - Ultimate (Safe Mode)</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body { background: #121212; color: #e0e0e0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; padding-bottom: 80px; margin: 0; }
        .container { padding: 15px; max-width: 800px; margin: 0 auto; }
        
        .team-logo { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #00E676; background: #333; }
        .rank-logo { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 10px; background: #333; }
        .login-logo-img { width: 120px; height: 120px; object-fit: contain; border-radius: 50%; border: 3px solid #00E676; margin: 0 auto 15px auto; display: block; background: #1e1e1e; }

        .card { background: #1E1E1E; padding: 15px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #333; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: transform 0.2s; }
        .card:active { transform: scale(0.99); }
        .player-header { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .player-name { font-size: 16px; font-weight: bold; color: white; display: flex; align-items: center; }
        
        .pos-badge { font-size: 10px; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-right: 6px; text-shadow: 1px 1px 1px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); }
        .player-ov { font-size: 14px; font-weight: bold; color: #00E676; background: #003300; padding: 2px 6px; border-radius: 4px; border: 1px solid #00E676; }
        .player-details { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 11px; color: #aaa; }

        .news-card { background: #252525; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid #888; font-size: 13px; line-height: 1.5; white-space: pre-line; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .news-money-plus { border-left-color: #00E676; } .news-money-minus { border-left-color: #d32f2f; } 
        .news-transfer { border-left-color: #2196F3; background: linear-gradient(90deg, #1E1E1E, #222); } 
        .news-season { border-left-color: #FF5722; background: #2a1b1b; border: 1px solid #FF5722; } 
        .news-infra { border-left-color: #9C27B0; } 
        .news-admin { border-left-color: #FFD700; background: #332b00; border: 1px solid #FFD700; }
        .news-date { font-size: 10px; color: #888; display: block; margin-bottom: 5px; border-bottom: 1px solid #444; padding-bottom: 5px; text-transform: uppercase; }

        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; margin-top: 10px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-size: 11px; }
        .btn-green { background: #00E676; color: black; } .btn-red { background: #d32f2f; color: white; }
        .btn-blue { background: #2196F3; color: white; } .btn-gold { background: #FFD700; color: black; }
        .btn-purple { background: #9C27B0; color: white; } .btn-outline { background: transparent; border: 1px solid #666; color: #ccc; }
        
        .input-field { width: 100%; padding: 12px; background: #2C2C2C; border: 1px solid #333; color: white; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; font-family: inherit; }
        .file-input { width: 100%; padding: 10px; background: #333; color: #aaa; border-radius: 8px; margin-bottom: 10px; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #1a1a1a; display: flex; padding: 10px 0; border-top: 1px solid #333; z-index: 100; box-shadow: 0 -2px 10px rgba(0,0,0,0.5); }
        .nav-item { flex: 1; text-align: center; color: #888; font-size: 10px; position: relative; cursor: pointer; }
        .nav-item i { font-size: 18px; margin-bottom: 4px; display: block; }
        .nav-item.active { color: #00E676; }
        .header { background: #1E1E1E; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #333; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 99; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
        .modal-card { width: 90%; max-width: 400px; max-height: 90vh; overflow-y: auto; background: #1E1E1E; padding: 20px; border-radius: 12px; border: 1px solid #333; box-sizing: border-box; position: relative; }

        .login-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #333; }
        .tab { flex: 1; padding: 15px; text-align: center; color: #888; cursor: pointer; transition: 0.3s; }
        .tab.active { color: #00E676; border-bottom: 2px solid #00E676; font-weight: bold; }
        
        .status-tag { font-size: 9px; padding: 2px 4px; border-radius: 3px; font-weight: bold; display: inline-block; margin-top: 5px; text-transform: uppercase;}
        .st-venda { background: #003300; color: #00E676; border: 1px solid #00E676; }
        .st-sold { background: #FFD700; color: black; border: 1px solid #FFD700; animation: pulse 2s infinite; }
        
        .market-filters { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px; }
        .filter-btn { padding: 8px 16px; background: #252525; color: #888; border-radius: 20px; font-size: 11px; white-space: nowrap; border: 1px solid #444; cursor: pointer; flex: 1; text-align: center; }
        .filter-btn.active { background: #00E676; color: black; border-color: #00E676; font-weight: bold; }

        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }
        
        /* Error Boundary Style */
        .error-screen { padding: 20px; text-align: center; background: #330000; height: 100vh; display: flex; flexDirection: column; justify-content: center; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- ERROR BOUNDARY (O SALVA-VIDAS) ---
        class ErrorBoundary extends React.Component {
            constructor(props) { super(props); this.state = { hasError: false, error: null }; }
            static getDerivedStateFromError(error) { return { hasError: true, error }; }
            componentDidCatch(error, errorInfo) { console.error("Crash:", error, errorInfo); }
            render() {
                if (this.state.hasError) {
                    return (
                        <div className="error-screen">
                            <h2 style={{color:'#ff5252'}}>Opa! Deu erro.</h2>
                            <p style={{color:'#ccc'}}>O jogo travou. Copie o erro abaixo e mande pro suporte:</p>
                            <pre style={{background:'black', padding:10, borderRadius:5, overflow:'auto', fontSize:10, textAlign:'left'}}>
                                {this.state.error?.toString()}
                            </pre>
                            <button className="btn btn-outline" onClick={()=>{localStorage.clear(); window.location.reload();}}>LIMPAR DADOS E REINICIAR</button>
                        </div>
                    );
                }
                return this.props.children; 
            }
        }

        // --- CONFIGURA√á√ÉO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyBrtJFfWAqT0AZYHlm4it-noB5h9jIPJEI",
            authDomain: "gerenciador-de-times-matoreal.firebaseapp.com",
            projectId: "gerenciador-de-times-matoreal",
            storageBucket: "gerenciador-de-times-matoreal.firebasestorage.app",
            messagingSenderId: "29096266740",
            appId: "1:29096266740:web:ec48e7225c18c20dbc07a1"
        };
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        } catch(e) { console.error("Firebase Init Error", e); }
        
        const db = firebase.firestore();
        const { useState, useEffect } = React;

        // --- CONSTANTES ---
        const STADIUM_COSTS = [0, 5000000, 20000000, 50000000, 100000000];
        const STADIUM_NAMES = ["V√°rzea", "Est√°dio Municipal", "Arena Moderna", "Arena Mundial", "Templo do Futebol"];
        const POSITIONS = ['GOL', 'ZAG', 'LD', 'LE', 'VOL', 'MC', 'MEI', 'ATA'];
        
        const getPosColor = (pos) => {
            if(!pos) return '#777';
            if(pos === 'GOL') return '#FFD700'; 
            if(['ZAG','LD','LE'].some(x=>pos.includes(x))) return '#2196F3'; 
            if(['VOL','MC','MEI'].some(x=>pos.includes(x))) return '#4CAF50'; 
            if(pos.includes('ATA')) return '#F44336'; 
            return '#777';
        };

        const fmt = (v) => "‚Ç£ " + parseFloat(v||0).toLocaleString('pt-BR');

        // --- APP PRINCIPAL ---
        function App() {
            const [userTeam, setUserTeam] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [isVisitor, setIsVisitor] = useState(false);
            
            const [teams, setTeams] = useState([]);
            const [players, setPlayers] = useState([]);
            const [offers, setOffers] = useState([]); 
            const [news, setNews] = useState([]); 
            const [financeRequests, setFinanceRequests] = useState([]); 
            const [systemConfig, setSystemConfig] = useState({ marketOpen: true }); 
            
            const [screen, setScreen] = useState('HOME');
            const [loading, setLoading] = useState(true);
            const [showAdmin, setShowAdmin] = useState(false); 
            const [showNotif, setShowNotif] = useState(false); 
            const [offerModal, setOfferModal] = useState(null);
            const [hasNewNews, setHasNewNews] = useState(false);
            const [adminViewingTeam, setAdminViewingTeam] = useState(null);

            useEffect(() => {
                const unsubT = db.collection('teams').onSnapshot(snap => setTeams(snap.docs.map(d => ({id: d.id, ...d.data()}))));
                const unsubP = db.collection('players').onSnapshot(snap => setPlayers(snap.docs.map(d => ({id: d.id, ...d.data()}))));
                const unsubN = db.collection('news').orderBy('date', 'desc').limit(50).onSnapshot(snap => {
                    const list = snap.docs.map(d => ({id: d.id, ...d.data()}));
                    setNews(list);
                    if(list.length > 0) {
                        const lastRead = localStorage.getItem('lastReadNews');
                        if(!lastRead || (list[0].date && list[0].date > parseInt(lastRead))) setHasNewNews(true);
                    }
                    setLoading(false);
                });
                const unsubC = db.collection('config').doc('system').onSnapshot(snap => {
                    if(snap.exists) setSystemConfig(snap.data());
                    else db.collection('config').doc('system').set({marketOpen:true});
                });
                const unsubF = db.collection('financeRequests').onSnapshot(snap => setFinanceRequests(snap.docs.map(d=>({id:d.id, ...d.data()}))));
                return () => { unsubT(); unsubP(); unsubN(); unsubC(); unsubF(); }
            }, []);

            useEffect(() => {
                if(userTeam && !isAdmin && !isVisitor) {
                    const me = teams.find(t => t.id === userTeam.id);
                    if(me) setUserTeam(me);
                    const unsubO = db.collection('offers').where('sellerId', '==', userTeam.id).onSnapshot(snap => setOffers(snap.docs.map(d=>({id:d.id, ...d.data()}))));
                    return () => unsubO && unsubO();
                }
            }, [teams, userTeam?.id]);

            const postNews = (text, type='normal') => db.collection('news').add({ text, type, date: Date.now() });

            const handleLogin = (team, pwd) => {
                if(pwd === team.password) { localStorage.setItem('myTeamId', team.id); setUserTeam(team); setIsAdmin(false); setIsVisitor(false); }
                else alert("Senha incorreta!");
            };
            const handleAdminLogin = () => { if(prompt("Senha Master:") === '2503') { setUserTeam({name:"FEDERA√á√ÉO (ADM)", id:"admin"}); setIsAdmin(true); } else alert("Erro."); };
            const handleVisitorLogin = () => { setUserTeam({name:"Visitante", id:"visitor"}); setIsVisitor(true); setScreen('RANKING'); };

            const createTeam = async (name, bal, serie, pass, logo) => {
                const exist = teams.find(t=>t.name.toLowerCase()===name.toLowerCase());
                if(exist) return alert("Nome j√° existe!");
                const ref = await db.collection('teams').add({ name, balance: parseFloat(bal), serie, password: pass, stadiumLevel: 1, logo: logo||null, allowOffers: true });
                postNews(`üõ°Ô∏è **NOVO CLUBE!**\nO **${name}** acaba de ser fundado na S√©rie ${serie}.`, 'infra');
                localStorage.setItem('myTeamId', ref.id);
                setUserTeam({id:ref.id, name, balance:parseFloat(bal), serie, password:pass, stadiumLevel:1, logo:logo||null});
            };

            const addPlayer = (name, pos, ov, val, sal, clause, con, mood) => {
                const target = isAdmin && adminViewingTeam ? adminViewingTeam : userTeam;
                db.collection('players').add({
                    name, position: pos, overall: parseInt(ov), value: parseFloat(val), salary: parseFloat(sal),
                    clause: parseFloat(clause), contract: parseInt(con), mood: mood||'üòê', status: 'NAO_A_VENDA',
                    teamId: target.id, loan: false
                });
                postNews(`üÜï **REFOR√áO!**\n${target.name} apresenta **${name}** (${pos}).\n‚≠ê Overall: ${ov}`, 'new-player');
            };

            const updatePlayer = (pId, name, st, pos, val, ov, sal, clause, con, forcedTeamId, mood) => {
                let data = { name, status: st, position: pos, value: parseFloat(val), overall: parseInt(ov), salary: parseFloat(sal), clause: parseFloat(clause), contract: parseInt(con), mood };
                if (isAdmin && forcedTeamId && forcedTeamId !== 'current') {
                    const newTeam = teams.find(t => t.id === forcedTeamId);
                    data.teamId = forcedTeamId; data.loan = false;
                    data.futureTransfer = firebase.firestore.FieldValue.delete();
                    postNews(`üëÆ‚Äç‚ôÇÔ∏è **INTERVEN√á√ÉO**\nA Federa√ß√£o determinou a transfer√™ncia imediata de **${name}** para o **${newTeam?.name || 'Novo Time'}**!`, 'admin');
                }
                db.collection('players').doc(pId).update(data);
                if(isAdmin) alert("Dados Atualizados!");
            };

            const deletePlayer = (pId) => { if(confirm("Apagar jogador?")) db.collection('players').doc(pId).delete(); };

            const toggleMarket = () => {
                const open = !systemConfig.marketOpen;
                db.collection('config').doc('system').update({ marketOpen: open });
                postNews(open ? "üì¢ **JANELA ABERTA!**\nO mercado de transfer√™ncias est√° oficialmente aberto." : "üîí **JANELA FECHADA!**\nNovos acordos ser√£o validados apenas na pr√≥xima temporada.", 'infra');
            };

            const sendOffer = async (target, type, val, swapId, seas, oldOffer) => {
                let desc = "", swapName = "";
                let v = parseFloat(val||0);
                if(type==='COMPRA') desc = `Compra: ${fmt(v)} | ${seas} Anos`;
                if(type==='EMPRESTIMO') desc = `Empr√©stimo (Taxa: ${fmt(v)}) | ${seas} Temp`;
                if(type==='TROCA') { const myP = players.find(p=>p.id===swapId); swapName = myP?.name || '?'; desc = `Troca: ${fmt(v)} + ${swapName}`; }

                const batch = db.batch();
                if(oldOffer) batch.delete(db.collection('offers').doc(oldOffer.id));
                const ref = db.collection('offers').doc();
                batch.set(ref, {
                    playerId: target.id, playerName: target.name,
                    buyerId: userTeam.id, buyerName: userTeam.name,
                    sellerId: oldOffer ? oldOffer.buyerId : target.teamId,
                    type, value: v, swapPlayerId: swapId||null, swapPlayerName: swapName||null,
                    offerContract: seas, description: desc, date: Date.now()
                });
                await batch.commit();
                postNews(`üö® **PROPOSTA**\n${userTeam.name} enviou oferta por **${target.name}**.\n${desc}`, 'transfer');
                alert("Enviada!"); setOfferModal(null); setShowNotif(false);
            };

            const acceptOffer = async (offer) => {
                const buyer = teams.find(t=>t.id===offer.buyerId);
                const seller = teams.find(t=>t.id===userTeam.id);
                const player = players.find(p=>p.id===offer.playerId);

                if(!buyer || !player) return alert("Erro nos dados.");
                const batch = db.batch();

                if(buyer.balance < offer.value) return alert("Comprador sem saldo!");
                const executeNow = systemConfig.marketOpen || offer.type === 'EMPRESTIMO';

                if (offer.type === 'COMPRA') {
                    batch.update(db.collection('teams').doc(buyer.id), { balance: buyer.balance - offer.value });
                    if(seller) batch.update(db.collection('teams').doc(seller.id), { balance: seller.balance + offer.value });

                    if (executeNow) {
                        batch.update(db.collection('players').doc(player.id), { teamId: buyer.id, status: 'NAO_A_VENDA', loan: false, contract: parseInt(offer.offerContract) });
                        postNews(`ü§ù **NEG√ìCIO FECHADO!**\n${buyer.name} contrata **${player.name}** por ${fmt(offer.value)}.`, 'transfer');
                    } else {
                        batch.update(db.collection('players').doc(player.id), { status: 'VENDIDO', futureTransfer: { teamId: buyer.id, teamName: buyer.name, contract: parseInt(offer.offerContract) } });
                        postNews(`ü§ù **PR√â-ACORDO FIRMADO**\nCom a janela fechada, **${player.name}** se apresentar√° ao **${buyer.name}** no in√≠cio da pr√≥xima temporada!`, 'transfer');
                    }
                } 
                else if (offer.type === 'EMPRESTIMO') {
                     if(offer.value > 0) {
                        batch.update(db.collection('teams').doc(buyer.id), { balance: buyer.balance - offer.value });
                        if(seller) batch.update(db.collection('teams').doc(seller.id), { balance: seller.balance + offer.value });
                     }
                     batch.update(db.collection('players').doc(player.id), { teamId: buyer.id, status: 'NAO_A_VENDA', loan: true, loanFrom: seller?.id });
                     postNews(`üîÑ **EMPR√âSTIMO**\n${buyer.name} refor√ßa elenco com **${player.name}**.`, 'transfer');
                }
                else if (offer.type === 'TROCA') {
                    if(!systemConfig.marketOpen) return alert("Trocas apenas com Janela Aberta!");
                    if(buyer.balance < offer.value) return alert("Sem saldo para volta!");
                    const swapP = players.find(p=>p.id===offer.swapPlayerId);
                    
                    batch.update(db.collection('teams').doc(buyer.id), { balance: buyer.balance - offer.value });
                    if(seller) batch.update(db.collection('teams').doc(seller.id), { balance: seller.balance + offer.value });
                    
                    batch.update(db.collection('players').doc(player.id), { teamId: buyer.id, status: 'NAO_A_VENDA', contract: parseInt(offer.offerContract) });
                    if(swapP) batch.update(db.collection('players').doc(swapP.id), { teamId: seller.id, status: 'NAO_A_VENDA' });
                    postNews(`üîÄ **TROCA BOMB√ÅSTICA**\n${buyer.name} e ${seller?.name} trocam jogadores:\n${player.name} ‚Üî ${swapP?.name}`, 'transfer');
                }

                batch.delete(db.collection('offers').doc(offer.id));
                await batch.commit();
                alert("Proposta Aceita!"); setShowNotif(false);
            };

            const payClause = (player) => {
                if(userTeam.balance < player.clause) return alert("Sem saldo!");
                const seller = teams.find(t=>t.id===player.teamId);
                const batch = db.batch();
                batch.update(db.collection('teams').doc(userTeam.id), { balance: userTeam.balance - player.clause });
                if(seller) batch.update(db.collection('teams').doc(seller.id), { balance: seller.balance + player.clause });
                batch.update(db.collection('players').doc(player.id), { teamId: userTeam.id, status: 'NAO_A_VENDA', loan: false, contract: 3 });
                batch.commit();
                postNews(`üí£ **MULTA PAGA!**\n${userTeam.name} deposita a multa de ${fmt(player.clause)} e leva **${player.name}** sem negociar!`, 'transfer');
            };

            const preContract = (player) => {
                if(player.contract > 1) return alert("Contrato ainda vigente.");
                if(!confirm("Assinar pr√©-contrato?")) return;
                db.collection('players').doc(player.id).update({ preContract: { teamId: userTeam.id, teamName: userTeam.name } });
                postNews(`üìú **ASSINOU!**\n${userTeam.name} garante **${player.name}** de gra√ßa para a pr√≥xima temporada.`, 'transfer');
            };

            const processWeek = async () => {
                if(!confirm("Processar pagamentos semanais?")) return;
                setLoading(true);
                const batch = db.batch();
                teams.forEach(t => {
                    const folha = players.filter(p=>p.teamId===t.id).reduce((a,b)=>a+(b.salary||0),0);
                    const pat = t.sponsorship ? t.sponsorship.value : 0;
                    batch.update(db.collection('teams').doc(t.id), { balance: (t.balance||0) + pat - folha });
                });
                await batch.commit();
                postNews("üìÖ **VIRADA DE SEMANA**\nPagamentos de sal√°rios e patroc√≠nios processados.", 'infra');
                setLoading(false); alert("Feito!");
            };

            const processSeason = async () => {
                if(!confirm("‚ö†Ô∏è VIRAR TEMPORADA? Isso processar√° transfer√™ncias pendentes e reduzir√° contratos.")) return;
                setLoading(true);
                const batch = db.batch();
                const allP = await db.collection('players').get();
                let moves = 0;

                allP.docs.forEach(doc => {
                    const p = doc.data();
                    let updates = {};
                    if (p.futureTransfer) {
                        updates.teamId = p.futureTransfer.teamId;
                        updates.contract = p.futureTransfer.contract;
                        updates.status = 'NAO_A_VENDA';
                        updates.futureTransfer = firebase.firestore.FieldValue.delete();
                        updates.loan = false;
                        moves++;
                    } else if ((p.contract <= 1 || p.contract === 0) && p.preContract) {
                        updates.teamId = p.preContract.teamId;
                        updates.contract = 1; 
                        updates.status = 'NAO_A_VENDA';
                        updates.preContract = firebase.firestore.FieldValue.delete();
                        updates.loan = false;
                        moves++;
                    } else {
                        let nc = (p.contract || 0) - 1;
                        if(nc < 0) nc = 0;
                        updates.contract = nc;
                        if(nc === 0) updates.status = 'EXPIRADO';
                    }
                    batch.update(doc.ref, updates);
                });

                await batch.commit();
                postNews(`üåû **NOVA TEMPORADA!**\nO calend√°rio virou! ${moves} jogadores mudaram de casa. Contratos atualizados.`, 'season');
                setLoading(false); alert("Temporada virada!");
            };

            const adminPostCustomNews = () => {
                const title = prompt("T√≠tulo da Not√≠cia:");
                const body = prompt("Texto da Not√≠cia:");
                const type = prompt("Tipo (admin, transfer, infra):", "admin");
                if(title && body) postNews(`üì¢ **${title.toUpperCase()}**\n${body}`, type);
            };

            if(loading) return <div style={{padding:50,textAlign:'center'}}>Carregando Mato Real Manager...</div>;
            if(!userTeam) return <LoginScreen teams={teams} onLogin={handleLogin} onCreate={createTeam} onAdminLogin={handleAdminLogin} onVisitor={handleVisitorLogin} onUpload={handleImageUpload} />;

            return (
                <div>
                    <div className="header">
                        <div style={{display:'flex', alignItems:'center', gap:10}}>
                            {!isAdmin && userTeam.logo && <img src={userTeam.logo} className="team-logo"/>}
                            <div>
                                <div style={{fontSize:16, fontWeight:'bold'}}>{userTeam.name}</div>
                                {isAdmin && <span style={{color:'gold', fontSize:10}}>MODO MASTER</span>}
                            </div>
                        </div>
                        <div style={{display:'flex', gap:15, alignItems:'center'}}>
                            {!isAdmin && !isVisitor && (
                                <div onClick={()=>setShowNotif(true)} style={{position:'relative', cursor:'pointer'}}>
                                    <i className="fas fa-bell" style={{color: offers.length?'#FFD700':'#888', fontSize:20}}></i>
                                    {offers.length > 0 && <div style={{position:'absolute', top:-5, right:-5, background:'red', borderRadius:'50%', width:15, height:15, fontSize:10, textAlign:'center'}}>{offers.length}</div>}
                                </div>
                            )}
                            {!isVisitor && <div style={{color: '#00E676', fontWeight:'bold', fontSize:14}}>{isAdmin ? '‚àû' : fmt(userTeam.balance)}</div>}
                            {!isVisitor && <i className="fas fa-cog" onClick={()=>setShowAdmin(true)} style={{color:'#888', fontSize:20}}></i>}
                            {isVisitor && <i className="fas fa-sign-out-alt" onClick={()=>window.location.reload()} style={{color:'#888', fontSize:20}}></i>}
                        </div>
                    </div>

                    <div className="container">
                        {screen === 'HOME' && (
                            <div>
                                {isAdmin ? (
                                    <div className="card">
                                        <h3>PAINEL DE CONTROLE</h3>
                                        <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:10, marginBottom:15}}>
                                            <button className="btn" style={{background: systemConfig.marketOpen?'#d32f2f':'#00E676', margin:0}} onClick={toggleMarket}>{systemConfig.marketOpen?'FECHAR JANELA':'ABRIR JANELA'}</button>
                                            <button className="btn btn-gold" style={{margin:0}} onClick={adminPostCustomNews}>üì¢ COMUNICADO</button>
                                            <button className="btn btn-purple" style={{margin:0}} onClick={processWeek}>VIRAR SEMANA</button>
                                            <button className="btn btn-red" style={{margin:0}} onClick={processSeason}>VIRAR TEMPORADA</button>
                                        </div>
                                        <h4>Pedidos Financeiros</h4>
                                        {financeRequests.filter(r=>r.status==='PENDING').map(r=>(
                                            <div key={r.id} style={{borderBottom:'1px solid #333', padding:5}}>
                                                <b>{r.teamName}</b>: {fmt(r.amount)} ({r.type}) <br/>
                                                <small>{r.details}</small><br/>
                                                <button className="btn-green" style={{padding:'4px 8px'}} onClick={()=>handleFinanceRequest(r,'APPROVE')}>ACEITAR</button>
                                                <button className="btn-red" style={{padding:'4px 8px', marginLeft:5}} onClick={()=>handleFinanceRequest(r,'REJECT')}>NEGAR</button>
                                            </div>
                                        ))}
                                        <h4>Clubes</h4>
                                        {teams.map(t=>(
                                            <div key={t.id} style={{padding:10, borderBottom:'1px solid #333', display:'flex', justifyContent:'space-between'}}>
                                                <span>{t.name}</span>
                                                <div>
                                                    <button className="btn-purple" style={{padding:'5px 10px'}} onClick={()=>{setAdminViewingTeam(t); setScreen('ADMIN_SQUAD');}}>ELENCO</button>
                                                    <button className="btn-green" style={{padding:'5px 10px'}} onClick={()=>adminUpdateBalance(t)}>$</button>
                                                    <button className="btn-red" style={{padding:'5px 10px'}} onClick={()=>adminDeleteTeam(t)}>X</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                ) : isVisitor ? <div style={{textAlign:'center', marginTop:50}}>Bem-vindo ao Mato Real!</div> : (
                                    <div>
                                        <div className="card" style={{borderLeft:'4px solid #9C27B0'}}>
                                            <div style={{display:'flex', justifyContent:'space-between'}}>
                                                <div>
                                                    <small style={{color:'#9C27B0', fontWeight:'bold'}}>EST√ÅDIO (Nvl {userTeam.stadiumLevel})</small>
                                                    <div style={{fontWeight:'bold'}}>{STADIUM_NAMES[(userTeam.stadiumLevel||1)-1]}</div>
                                                </div>
                                                <button className="btn-purple" style={{width:'auto', fontSize:11}} onClick={()=>setShowAdmin(true)}>OBRAS</button>
                                            </div>
                                        </div>
                                        <MyTeam ps={players.filter(p=>p.teamId===userTeam.id)} onAdd={addPlayer} onUpd={updatePlayer} onDel={deletePlayer} isAdmin={false} allTeams={teams} />
                                    </div>
                                )}
                            </div>
                        )}

                        {screen === 'ADMIN_SQUAD' && isAdmin && adminViewingTeam && (
                            <div>
                                <button className="btn" style={{background:'#444', marginBottom:10}} onClick={()=>setScreen('HOME')}>VOLTAR</button>
                                <h3>Editando: {adminViewingTeam.name}</h3>
                                <MyTeam ps={players.filter(p=>p.teamId===adminViewingTeam.id)} onAdd={addPlayer} onUpd={updatePlayer} onDel={deletePlayer} isAdmin={true} allTeams={teams} />
                            </div>
                        )}

                        {screen === 'MARKET' && <Market me={userTeam.id} teams={teams} ps={players} isVisitor={isVisitor||isAdmin} marketOpen={systemConfig.marketOpen} onOffer={(p)=>setOfferModal(p)} onPayClause={payClause} onPreContract={preContract} />}
                        
                        {screen === 'RANKING' && <Ranking teams={teams} players={players} />}
                        
                        {screen === 'NEWS' && (
                            <div>
                                <h3>Plant√£o de Not√≠cias</h3>
                                {news.map(n=>(
                                    <div key={n.id} className={`news-card news-${n.type}`}>
                                        <span className="news-date">{new Date(n.date).toLocaleString()}</span>
                                        {n.text}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    <div className="bottom-nav">
                        <div className={`nav-item ${screen==='HOME'?'active':''}`} onClick={()=>setScreen('HOME')}><i className="fas fa-home"></i>{isAdmin?'ADM':'TIME'}</div>
                        <div className={`nav-item ${screen==='MARKET'?'active':''}`} onClick={()=>setScreen('MARKET')}><i className="fas fa-globe"></i>MERCADO</div>
                        <div className={`nav-item ${screen==='RANKING'?'active':''}`} onClick={()=>setScreen('RANKING')}><i className="fas fa-trophy"></i>RANK</div>
                        <div className={`nav-item ${screen==='NEWS'?'active':''}`} onClick={()=>{setScreen('NEWS'); setHasNewNews(false); localStorage.setItem('lastReadNews', Date.now());}}>
                            <i className="fas fa-newspaper"></i>{hasNewNews && <span style={{position:'absolute', top:5, right:'35%', width:8, height:8, background:'gold', borderRadius:'50%'}}></span>}NOT√çCIAS
                        </div>
                    </div>

                    {showAdmin && !isAdmin && !isVisitor && <AdminModal team={userTeam} onClose={()=>setShowAdmin(false)} onUpdate={(d)=>{db.collection('teams').doc(userTeam.id).update(d); setUserTeam({...userTeam, ...d});}} onReq={(t,a,d)=>{db.collection('financeRequests').add({teamId:userTeam.id, teamName:userTeam.name, type:t, amount:parseFloat(a), details:d, status:'PENDING'}); alert("Enviado!"); setShowAdmin(false);}} onUpgrade={upgradeStadium} onUpload={handleImageUpload} />}
                    {showAdmin && isAdmin && <div className="modal-bg"><div className="modal-card"><button className="btn-red" onClick={()=>window.location.reload()}>SAIR DO MODO ADMIN</button><br/><button className="btn" onClick={()=>setShowAdmin(false)}>FECHAR</button></div></div>}
                    
                    {offerModal && <OfferForm p={offerModal} myPs={players.filter(p=>p.teamId===userTeam.id)} onSend={sendOffer} onClose={()=>setOfferModal(null)} />}
                    
                    {showNotif && (
                        <div className="modal-bg"><div className="modal-card">
                            <h3>Propostas Recebidas</h3>
                            {offers.map(o=>(
                                <div key={o.id} style={{background:'#222', padding:10, marginBottom:10, borderRadius:8}}>
                                    <b style={{color:'#00E676'}}>{o.playerName}</b><br/>
                                    <small>De: {o.buyerName}</small>
                                    <div style={{margin:'5px 0', borderLeft:'2px solid #aaa', paddingLeft:5}}>{o.description}</div>
                                    <div style={{display:'flex', gap:5}}>
                                        <button className="btn-green" style={{fontSize:10}} onClick={()=>acceptOffer(o)}>ACEITAR</button>
                                        <button className="btn-blue" style={{fontSize:10}} onClick={()=>{setOfferModal({...players.find(p=>p.id===o.playerId), oldOffer:o, oldVal:o.value}); setShowNotif(false);}}>CONTRAPROPOSTA</button>
                                        <button className="btn-red" style={{fontSize:10}} onClick={()=>{db.collection('offers').doc(o.id).delete(); postNews(`‚ùå **RECUSADO!**\n${userTeam.name} rejeitou a oferta de ${o.buyerName} por ${o.playerName}.`, 'minus');}}>RECUSAR</button>
                                    </div>
                                </div>
                            ))}
                            <button className="btn" onClick={()=>setShowNotif(false)}>FECHAR</button>
                        </div></div>
                    )}
                </div>
            );
        }

        // --- COMPONENTES SECUND√ÅRIOS ---

        function Market({ me, teams, ps, isVisitor, marketOpen, onOffer, onPayClause, onPreContract }) {
            const [mode, setMode] = useState('MENU');
            const [serie, setSerie] = useState('A');
            const [selTeam, setSelTeam] = useState(null);
            const [globalType, setGlobalType] = useState(null);

            if(mode === 'MENU') return (
                <div>
                    <h3>Mercado {marketOpen?'üü¢':'üî¥'}</h3>
                    <div style={{display:'flex', gap:10, marginBottom:20}}>
                        <div className="card" style={{flex:1, textAlign:'center', cursor:'pointer', border:'1px solid #00E676'}} onClick={()=>{setGlobalType('VENDA'); setMode('GLOBAL');}}><i className="fas fa-shopping-cart" style={{fontSize:24, color:'#00E676'}}></i><br/>√Ä VENDA</div>
                        <div className="card" style={{flex:1, textAlign:'center', cursor:'pointer', border:'1px solid #2196F3'}} onClick={()=>{setGlobalType('EMPRESTIMO'); setMode('GLOBAL');}}><i className="fas fa-exchange-alt" style={{fontSize:24, color:'#2196F3'}}></i><br/>EMPR√âSTIMOS</div>
                    </div>
                    <h4>Navegar por S√©rie</h4>
                    <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:10}}>
                        {['A','B','C','D'].map(s=><div key={s} className="card" onClick={()=>{setSerie(s); setMode('SERIE');}} style={{textAlign:'center', cursor:'pointer'}}><b style={{fontSize:18}}>S√©rie {s}</b></div>)}
                    </div>
                </div>
            );

            if(mode === 'GLOBAL') {
                const list = ps.filter(p=>p.teamId!==me && p.status===globalType).sort((a,b)=>b.overall-a.overall);
                return (
                    <div>
                        <button className="btn" style={{background:'#444', marginBottom:10}} onClick={()=>setMode('MENU')}>VOLTAR</button>
                        <h3>{globalType} (Todos)</h3>
                        {list.map(p=>{
                            const t = teams.find(tm=>tm.id===p.teamId);
                            return <PlayerCard key={p.id} p={p} ownerName={t?t.name:'?'} marketOpen={marketOpen} isVisitor={isVisitor} onOffer={onOffer} onPayClause={onPayClause} />
                        })}
                    </div>
                )
            }

            if(mode === 'SERIE') {
                if(!selTeam) return (
                    <div>
                        <button className="btn" style={{background:'#444', marginBottom:10}} onClick={()=>setMode('MENU')}>VOLTAR</button>
                        <h3>Clubes S√©rie {serie}</h3>
                        {teams.filter(t=>t.serie===serie && (isVisitor || t.id!==me)).map(t=>(
                            <div key={t.id} className="card" onClick={()=>setSelTeam(t)} style={{display:'flex', alignItems:'center', gap:10}}>
                                {t.logo ? <img src={t.logo} className="rank-logo"/> : <div className="rank-logo"></div>}
                                <div><b>{t.name}</b><br/><small>‚Ç£ {fmt(t.balance)}</small></div>
                            </div>
                        ))}
                    </div>
                );
                return (
                    <div>
                        <button className="btn" style={{background:'#444', marginBottom:10}} onClick={()=>setSelTeam(null)}>VOLTAR</button>
                        <h3>{selTeam.name}</h3>
                        {ps.filter(p=>p.teamId===selTeam.id).sort((a,b)=>b.overall-a.overall).map(p=>(
                            <PlayerCard key={p.id} p={p} marketOpen={marketOpen} isVisitor={isVisitor} onOffer={onOffer} onPayClause={onPayClause} onPre={onPreContract} />
                        ))}
                    </div>
                )
            }
        }

        function PlayerCard({ p, ownerName, marketOpen, isVisitor, onOffer, onPayClause, onPre }) {
            return (
                <div className="card">
                    <div className="player-header">
                        <span className="player-name">
                            <span className="pos-badge" style={{background: getPosColor(p.position)}}>{p.position}</span>
                            {p.name}
                        </span>
                        <span className="player-ov">{p.overall}</span>
                    </div>
                    <div className="player-details">
                        {ownerName && <div style={{gridColumn:'span 2', color:'white', borderBottom:'1px solid #333', paddingBottom:5, marginBottom:5}}>Time: <b>{ownerName}</b></div>}
                        <div>üí∞ {fmt(p.value)}</div>
                        <div>üìÑ {p.contract} Anos</div>
                        <div>üíµ Sal: {fmt(p.salary)}</div>
                        <div>üîí Mul: {p.clause > 0 ? fmt(p.clause) : '--'}</div>
                    </div>
                    {!isVisitor && (
                        <div style={{marginTop:10}}>
                            {p.status==='VENDIDO' ? <small className="status-tag st-sold">VENDIDO</small> : (
                                <>
                                    {p.clause > 0 && <button className="btn-gold" style={{width:'auto', padding:'4px 8px', fontSize:10, marginRight:5}} onClick={()=>onPayClause(p)}>MULTA</button>}
                                    {(p.contract<=1 && !p.preContract) && <button className="btn-blue" style={{width:'auto', padding:'4px 8px', fontSize:10, marginRight:5}} onClick={()=>onPre(p)}>PR√â</button>}
                                    {(marketOpen || p.status!=='INTRANSFERIVEL') ? 
                                        <button className="btn-purple" style={{width:'auto', padding:'4px 8px', fontSize:10}} onClick={()=>onOffer(p)}>NEGOCIAR</button> :
                                        <span className="status-tag" style={{background:'#333'}}>BLOQUEADO</span>
                                    }
                                </>
                            )}
                        </div>
                    )}
                </div>
            )
        }

        function MyTeam({ ps, onAdd, onUpd, onDel, isAdmin, allTeams }) {
            const [editP, setEditP] = useState(null);
            const [add, setAdd] = useState(false);
            const [np, setNp] = useState({n:'', p:'GOL', o:'', v:'', s:'', c:'', m:'', k:'3'}); // New Player State
            const [ep, setEp] = useState({}); // Edit Player State

            const saveEdit = () => {
                onUpd(editP.id, ep.n, ep.s, ep.pos, ep.v, ep.o, ep.sal, ep.cl, ep.con, ep.team, ep.mood);
                setEditP(null);
            };

            return (
                <div>
                    <button className="btn" style={{background:'#333', marginBottom:15}} onClick={()=>setAdd(!add)}>{add?'CANCELAR':'+ NOVO JOGADOR'}</button>
                    
                    {add && <div className="card">
                        <input className="input-field" placeholder="Nome" value={np.n} onChange={e=>setNp({...np, n:e.target.value})} />
                        <select className="input-field" value={np.p} onChange={e=>setNp({...np, p:e.target.value})}>{POSITIONS.map(p=><option key={p} value={p}>{p}</option>)}</select>
                        <div style={{display:'flex', gap:5}}>
                            <input className="input-field" type="number" placeholder="Over" value={np.o} onChange={e=>setNp({...np, o:e.target.value})} />
                            <input className="input-field" type="number" placeholder="Idade/Contrato" value={np.k} onChange={e=>setNp({...np, k:e.target.value})} />
                        </div>
                        <input className="input-field" type="number" placeholder="Valor" value={np.v} onChange={e=>setNp({...np, v:e.target.value})} />
                        <input className="input-field" type="number" placeholder="Sal√°rio" value={np.s} onChange={e=>setNp({...np, s:e.target.value})} />
                        <input className="input-field" type="number" placeholder="Multa" value={np.m} onChange={e=>setNp({...np, m:e.target.value})} />
                        <button className="btn-green" onClick={()=>{onAdd(np.n, np.p, np.o, np.v, np.s, np.m, np.k, 'üòê'); setAdd(false);}}>CRIAR</button>
                    </div>}

                    {editP && <div className="modal-bg"><div className="modal-card">
                        <h3>Editar {editP.name}</h3>
                        <label>Nome:</label><input className="input-field" value={ep.n} onChange={e=>setEp({...ep, n:e.target.value})} />
                        <label>Posi√ß√£o:</label><select className="input-field" value={ep.pos} onChange={e=>setEp({...ep, pos:e.target.value})}>{POSITIONS.map(p=><option key={p} value={p}>{p}</option>)}</select>
                        <label>Status:</label><select className="input-field" value={ep.s} onChange={e=>setEp({...ep, s:e.target.value})}><option value="NAO_A_VENDA">Normal</option><option value="VENDA">√Ä Venda</option><option value="EMPRESTIMO">Empr√©stimo</option><option value="INTRANSFERIVEL">Bloqueado</option></select>
                        <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:5}}>
                            <div><label>Over:</label><input className="input-field" value={ep.o} onChange={e=>setEp({...ep, o:e.target.value})} /></div>
                            <div><label>Contrato:</label><input className="input-field" value={ep.con} onChange={e=>setEp({...ep, con:e.target.value})} /></div>
                        </div>
                        <label>Valor:</label><input className="input-field" value={ep.v} onChange={e=>setEp({...ep, v:e.target.value})} />
                        <label>Sal√°rio:</label><input className="input-field" value={ep.sal} onChange={e=>setEp({...ep, sal:e.target.value})} />
                        <label>Multa:</label><input className="input-field" value={ep.cl} onChange={e=>setEp({...ep, cl:e.target.value})} />
                        
                        {isAdmin && (
                            <div style={{border:'1px solid gold', padding:10, borderRadius:8, marginTop:10}}>
                                <label style={{color:'gold'}}>‚ö† FOR√áAR TRANSFER√äNCIA (ADM)</label>
                                <select className="input-field" value={ep.team} onChange={e=>setEp({...ep, team:e.target.value})}>
                                    <option value="current">-- Manter no Time --</option>
                                    {allTeams.map(t=><option key={t.id} value={t.id}>{t.name}</option>)}
                                </select>
                            </div>
                        )}

                        <div style={{display:'flex', gap:10, marginTop:10}}>
                            <button className="btn-green" onClick={saveEdit}>SALVAR</button>
                            <button className="btn-red" onClick={()=>{onDel(editP.id); setEditP(null);}}>EXCLUIR</button>
                        </div>
                        <button className="btn" style={{marginTop:10}} onClick={()=>setEditP(null)}>CANCELAR</button>
                    </div></div>}

                    {ps.sort((a,b)=>b.overall-a.overall).map(p=>(
                        <div key={p.id} className="card" onClick={()=>{setEditP(p); setEp({n:p.name, s:p.status, pos:p.position, v:p.value, o:p.overall, sal:p.salary, cl:p.clause, con:p.contract, mood:p.mood, team:'current'});}}>
                            <div className="player-header">
                                <span className="player-name"><span className="pos-badge" style={{background:getPosColor(p.position)}}>{p.position}</span>{p.name} {p.loan && <small style={{color:'#2196F3'}}>(EMP)</small>}</span>
                                <span className="player-ov">{p.overall}</span>
                            </div>
                            <div className="player-details">
                                <div>üí∞ {fmt(p.salary)}</div>
                                <div>üíµ {fmt(p.value)}</div>
                                <div>üìÑ {p.contract} Anos</div>
                                <div style={{color: p.status==='VENDA'?'#00E676':p.status==='VENDIDO'?'gold':'#777'}}>{p.status}</div>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        function Ranking({ teams, players }) {
            const list = teams.map(t => {
                const wealth = (t.balance||0) + players.filter(p => p.teamId === t.id).reduce((acc, p) => acc + (p.value || 0), 0);
                return { ...t, wealth };
            }).sort((a,b) => b.wealth - a.wealth);
            return (
                <div>
                    <h3>üèÜ Ranking de Bilion√°rios</h3>
                    {list.map((t, i) => (
                        <div key={t.id} className="card" style={{display:'flex', alignItems:'center', gap:15}}>
                            <span style={{fontSize:20, fontWeight:'bold', color:'#555', width:30}}>{i+1}¬∫</span>
                            {t.logo ? <img src={t.logo} className="rank-logo" /> : <div className="rank-logo"></div>}
                            <div>
                                <b style={{fontSize:16}}>{t.name}</b><br/>
                                <small style={{color:'#00E676'}}>Patrim√¥nio: ‚Ç£ {fmt(t.wealth).replace('‚Ç£ ','')}</small>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        function LoginScreen({ teams, onLogin, onCreate, onAdminLogin, onVisitor, onUpload }) {
            const [mode, setMode] = useState('LOGIN');
            const [n, setN] = useState(''); const [b, setB] = useState('10000000'); const [s, setS] = useState('A'); const [p, setP] = useState(''); const [l, setL] = useState(null);
            const [sel, setSel] = useState(null); const [lp, setLp] = useState('');

            return (
                <div style={{minHeight:'100vh', padding:20, textAlign:'center'}}>
                    <h1 style={{color:'#00E676'}}>Mato Real Manager</h1>
                    <div className="login-tabs"><div className={`tab ${mode==='LOGIN'?'active':''}`} onClick={()=>setMode('LOGIN')}>ENTRAR</div><div className={`tab ${mode==='CREATE'?'active':''}`} onClick={()=>setMode('CREATE')}>CRIAR</div></div>
                    
                    {mode === 'LOGIN' ? (
                        <div style={{textAlign:'left'}}>
                            {(teams||[]).map(t=>(
                                <div key={t.id} className="card" onClick={()=>setSel(t)} style={{display:'flex', alignItems:'center', gap:10, cursor:'pointer'}}>
                                    {t.logo ? <img src={t.logo} className="team-logo"/> : <div className="team-logo"></div>}
                                    <div><b>{t.name}</b><br/><small style={{color:'#666'}}>S√©rie {t.serie}</small></div>
                                </div>
                            ))}
                            <button className="btn btn-blue" onClick={onVisitor}>ENTRAR COMO VISITANTE</button>
                            <button className="btn btn-outline" onClick={onAdminLogin}>√ÅREA DO ADMIN</button>
                        </div>
                    ) : (
                        <div>
                            <input type="file" className="file-input" onChange={e=>onUpload(e, setL)} />
                            <input className="input-field" placeholder="Nome do Clube" value={n} onChange={e=>setN(e.target.value)} />
                            <input className="input-field" type="number" placeholder="Saldo Inicial" value={b} onChange={e=>setB(e.target.value)} />
                            <select className="input-field" value={s} onChange={e=>setS(e.target.value)}><option>A</option><option>B</option><option>C</option></select>
                            <input className="input-field" type="number" placeholder="Senha (PIN)" value={p} onChange={e=>setP(e.target.value)} />
                            <button className="btn-green" onClick={()=>onCreate(n,b,s,p,l)}>FUNDAR CLUBE</button>
                        </div>
                    )}

                    {sel && <div className="modal-bg"><div className="modal-card">
                        <h3>{sel.name}</h3>
                        <input className="input-field" type="password" placeholder="Senha" value={lp} onChange={e=>setLp(e.target.value)} />
                        <button className="btn-green" onClick={()=>onLogin(sel, lp)}>ACESSAR</button>
                        <button className="btn" onClick={()=>setSel(null)}>CANCELAR</button>
                    </div></div>}
                </div>
            )
        }

        function handleImageUpload(e, callback) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onloadend = () => callback(reader.result);
            reader.readAsDataURL(file);
        }

        function AdminModal({ team, onClose, onUpdate, onReq, onUpgrade, onUpload }) {
            const [tab, setTab] = useState(1);
            const [n, setN] = useState(team?.name || ''); const [s, setS] = useState(team?.serie || 'A'); const [l, setL] = useState(team?.logo || null);
            const [ra, setRa] = useState(''); const [rd, setRd] = useState(''); const [rt, setRt] = useState('INJECTION');

            return (
                <div className="modal-bg"><div className="modal-card">
                    <div className="login-tabs"><div className={`tab ${tab===1?'active':''}`} onClick={()=>setTab(1)}>DADOS</div><div className={`tab ${tab===2?'active':''}`} onClick={()=>setTab(2)}>FINAN√áAS</div></div>
                    {tab===1 ? (
                        <div>
                            {l && <img src={l} className="login-logo-img"/>}
                            <input type="file" className="file-input" onChange={e=>onUpload(e, setL)} />
                            <input className="input-field" value={n} onChange={e=>setN(e.target.value)} />
                            <select className="input-field" value={s} onChange={e=>setS(e.target.value)}><option>A</option><option>B</option><option>C</option></select>
                            <button className="btn-blue" onClick={()=>{onUpdate({name:n, serie:s, logo:l}); onClose();}}>SALVAR</button>
                            <div style={{marginTop:15, borderTop:'1px solid #444', paddingTop:10}}>
                                <p>Est√°dio N√≠vel {team?.stadiumLevel}</p>
                                <button className="btn-purple" onClick={onUpgrade}>EVOLUIR (‚Ç£ {STADIUM_COSTS[team?.stadiumLevel]?.toLocaleString()})</button>
                            </div>
                        </div>
                    ) : (
                        <div>
                            <select className="input-field" value={rt} onChange={e=>setRt(e.target.value)}><option value="INJECTION">Inje√ß√£o</option><option value="SPONSORSHIP">Patroc√≠nio</option></select>
                            <input className="input-field" type="number" placeholder="Valor" value={ra} onChange={e=>setRa(e.target.value)} />
                            <input className="input-field" placeholder="Motivo/Empresa" value={rd} onChange={e=>setRd(e.target.value)} />
                            <button className="btn-green" onClick={()=>onReq(rt, ra, rd)}>ENVIAR PEDIDO</button>
                        </div>
                    )}
                    <button className="btn" style={{marginTop:10}} onClick={onClose}>FECHAR</button>
                </div></div>
            )
        }

        function OfferForm({ p, myPs, onSend, onClose }) {
            const [t, setT] = useState('COMPRA'); const [v, setV] = useState(p.oldVal||''); const [s, setS] = useState('1'); const [sw, setSw] = useState('');
            return (
                <div className="modal-bg"><div className="modal-card">
                    <h3>Negociar {p.name}</h3>
                    <div style={{display:'flex', gap:5, marginBottom:10}}>
                        <button className="btn" style={{background:t==='COMPRA'?'#00E676':'#333', color:t==='COMPRA'?'black':'white', fontSize:10}} onClick={()=>setT('COMPRA')}>COMPRA</button>
                        <button className="btn" style={{background:t==='EMPRESTIMO'?'#00E676':'#333', color:t==='EMPRESTIMO'?'black':'white', fontSize:10}} onClick={()=>setT('EMPRESTIMO')}>EMP</button>
                        <button className="btn" style={{background:t==='TROCA'?'#00E676':'#333', color:t==='TROCA'?'black':'white', fontSize:10}} onClick={()=>setT('TROCA')}>TROCA</button>
                    </div>
                    {t==='COMPRA' && <input className="input-field" type="number" placeholder="Valor" value={v} onChange={e=>setV(e.target.value)} />}
                    {t==='EMPRESTIMO' && <input className="input-field" type="number" placeholder="Taxa (Opcional)" value={v} onChange={e=>setV(e.target.value)} />}
                    {t==='TROCA' && <div><input className="input-field" type="number" placeholder="Volta em Dinheiro" value={v} onChange={e=>setV(e.target.value)} /><select className="input-field" value={sw} onChange={e=>setSw(e.target.value)}><option value="">Seu Jogador...</option>{myPs.map(mp=><option key={mp.id} value={mp.id}>{mp.name}</option>)}</select></div>}
                    {t!=='EMPRESTIMO' && <input className="input-field" type="number" placeholder="Contrato (Anos)" value={s} onChange={e=>setS(e.target.value)} />}
                    {t==='EMPRESTIMO' && <select className="input-field" value={s} onChange={e=>setS(e.target.value)}><option value="0.5">Meia Temp</option><option value="1">1 Temp</option></select>}
                    <button className="btn-green" onClick={()=>onSend(p, t, v, sw, s, p.oldOffer)}>ENVIAR PROPOSTA</button>
                    <button className="btn" onClick={onClose}>CANCELAR</button>
                </div></div>
            )
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><App /></ErrorBoundary>);
    </script>
</body>
</html>
