<!-- =========================================================
IN√çCIO - ESTRUTURA BASE DO APLICATIVO
Respons√°vel por:
- HTML principal
- Imports (React, Babel, Firebase)
- Estilos globais
- Configura√ß√µes iniciais
========================================================= -->

<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gerenciador de Times de Mato Real</title>

    <!-- ================= IMPORTS REACT + BABEL ================= -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- ================= IMPORTS FIREBASE ================= -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- ================= FONTS E √çCONES ================= -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">

    <!-- ================= ESTILOS GLOBAIS ================= -->
    <style>
        :root {
            --bg-dark: #121212;
            --bg-card: #1E1E1E;
            --bg-input: #2C2C2C;
            --primary: #00E676;
            --secondary: #2979FF;
            --danger: #FF1744;
            --warning: #FFC400;
            --purple: #D500F9;
            --text-main: #FFFFFF;
            --border: #333333;
        }

        body {
            background: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding-bottom: 80px;
            -webkit-font-smoothing: antialiased;
        }

        /* --- (estilos continuam iguais, apenas organizados) --- */
        /* N√ÉO REMOVER NADA AQUI, √â O DESIGN DO APP */
    </style>
</head>

<body>

    <!-- ================= ROOT DO REACT ================= -->
    <div id="root"></div>

    <!-- =================================================
    IN√çCIO - CONFIGURA√á√ÉO REACT + FIREBASE
    ================================================= -->
    <script type="text/babel">

        // ================= ERROR BOUNDARY =================
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error("Crash:", error, errorInfo);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="error-screen">
                            <h2>Ocorreu um erro!</h2>
                            <p>O aplicativo encontrou um problema inesperado.</p>
                            <button
                                className="btn btn-red"
                                onClick={() => {
                                    localStorage.clear();
                                    window.location.reload();
                                }}
                            >
                                REINICIAR APLICATIVO
                            </button>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // ================= FIREBASE CONFIG =================
        const firebaseConfig = {
            apiKey: "AIzaSyBrtJFfWAqT0AZYHlm4it-noB5h9jIPJEI",
            authDomain: "gerenciador-de-times-matoreal.firebaseapp.com",
            projectId: "gerenciador-de-times-matoreal",
            storageBucket: "gerenciador-de-times-matoreal.firebasestorage.app",
            messagingSenderId: "29096266740",
            appId: "1:29096266740:web:ec48e7225c18c20dbc07a1"
        };

        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
        } catch (e) {
            console.error(e);
        }

        const db = firebase.firestore();

        // ================= HOOKS REACT =================
        const { useState, useEffect } = React;

        // ================= CONSTANTES DO JOGO =================
        const POS = ['GOL', 'ZAG', 'LD', 'LE', 'VOL', 'MC', 'MEI', 'ATA'];
        const SERIES = ['A', 'B', 'C', 'D'];
        const COSTS = [0, 5000000, 20000000, 50000000, 100000000];

        // ================= FUN√á√ïES UTILIT√ÅRIAS =================
        const fmt = (v) =>
            "‚Ç£ " + parseFloat(v || 0).toLocaleString('pt-BR');

        const getPosColor = (p) => {
            if (!p) return '#555';
            if (p === 'GOL') return '#FFD700';
            if (['ZAG', 'LD', 'LE'].some(x => p.includes(x))) return '#2979FF';
            if (['VOL', 'MC', 'MEI'].some(x => p.includes(x))) return '#00E676';
            return '#FF1744';
        };


        // =========================================================
// IN√çCIO - SISTEMA DE EMPRESAS (CONSTANTES ECON√îMICAS)
// Respons√°vel por:
// - Tipos de empresas dispon√≠veis no jogo
// - Capital inicial
// - Impostos
// - Categorias de produtos
// =========================================================


// --- ETAPA 1: TIPOS DE EMPRESAS ---
const COMPANY_TYPES = {
    COMERCIO: {
        label: 'Com√©rcio Local',
        start: 2500000,
        tax: 50000,
        desc: 'Ideal para iniciantes. Imposto baixo.'
    },
    MEDIA: {
        label: 'M√©dia Empresa',
        start: 20000000,
        tax: 350000,
        desc: 'Poder moderado. Imposto m√©dio.'
    },
    GRANDE: {
        label: 'Grande Empresa',
        start: 100000000,
        tax: 2000000,
        desc: 'Gigante do mercado. Imposto alto.'
    }
};


// --- ETAPA 2: CATEGORIAS DE PRODUTOS ---
const PROD_CATS = {
    CHUTEIRA: 'üëü Chuteira',
    LUVAS: 'üß§ Luvas/Acess√≥rios',
    CONSUMIVEL: '‚ö° Consum√≠vel/Energia',
    VEICULO: 'üöó Ve√≠culo',
    IMOVEL: 'üè† Im√≥vel',
    TECNOLOGIA: 'üì± Tecnologia',
    LUXO: 'üíé Luxo/Moda',
    SAUDE: 'üíä Sa√∫de'
};


// =========================================================
// FIM - SISTEMA DE EMPRESAS (CONSTANTES ECON√îMICAS)
// =========================================================


   // =========================================================
// IN√çCIO - SISTEMA DE RPG (N√çVEL, XP E PROGRESS√ÉO)
// Respons√°vel por:
// - Definir n√≠vel m√≠nimo e m√°ximo
// - Calcular XP necess√°rio para subir de n√≠vel
// - Controlar ganho e perda de XP
// =========================================================


// --- LIMITES DE N√çVEL ---
const MIN_LEVEL = 45;
const MAX_LEVEL = 100;


// --- XP NECESS√ÅRIO PARA PR√ìXIMO N√çVEL ---
// Exemplo:
// N√≠vel 45 -> 4500 XP
// N√≠vel 90 -> 9000 XP
const getXPNext = (lvl) => lvl * 100;


// --- C√ÅLCULO DE NOVO N√çVEL (GANHO / PERDA DE XP) ---
const calcNewLevel = (currentLvl, currentXP, change) => {
    let lvl = currentLvl;
    let xp = currentXP + change;

    // ===== LEVEL UP =====
    while (xp >= getXPNext(lvl) && lvl < MAX_LEVEL) {
        xp -= getXPNext(lvl);
        lvl++;
    }

    // ===== LEVEL DOWN =====
    while (xp < 0 && lvl > MIN_LEVEL) {
        lvl--;
        xp += getXPNext(lvl); // Recupera XP do n√≠vel anterior
    }

    // ===== LIMITES DE SEGURAN√áA =====
    if (lvl <= MIN_LEVEL && xp < 0) xp = 0;
    if (lvl >= MAX_LEVEL) xp = 0;

    return { lvl, xp };
};


// =========================================================
// FIM - SISTEMA DE RPG (N√çVEL, XP E PROGRESS√ÉO)
// =========================================================




       // =========================================================
// IN√çCIO - FORMATADOR DE DETALHES DE PROPOSTA
// Respons√°vel por:
// - Criar o texto exibido nas propostas
// - Unificar regras de Compra, Empr√©stimo e Troca
// - Evitar duplica√ß√£o de l√≥gica na UI
// =========================================================

const formatOfferDetails = (type, v, con, meta, swapIds, players) => {
    let details = [];

    // ===== VALOR DA PROPOSTA =====
    if (v > 0) {
        details.push(`üí∞ Valor: ${fmt(v)}`);
    }

    // ===== PARCELAMENTO =====
    if (meta.installments > 1) {
        details.push(
            `üìÖ Parcelamento: ${meta.installments}x de ${fmt(v / meta.installments)}`
        );
    }

    // ===== CONTRATO =====
    if (type !== 'TROCA') {
        details.push(`üìù Contrato: ${con} Temporadas`);
    }

    // ===== CL√ÅUSULA DE REVENDA =====
    if (type === 'COMPRA' && meta.sellOn > 0) {
        details.push(`üìà Revenda: ${meta.sellOn}% futura venda`);
    }

    // ===== EMPR√âSTIMO =====
    if (type === 'EMPRESTIMO') {
        details.push(`üí∏ Sal√°rios: Comprador paga ${meta.wageSplit}%`);

        if (meta.buyOpt > 0) {
            details.push(`üõí Op√ß√£o de Compra: ${fmt(meta.buyOpt)}`);
        }
    }

    // ===== TROCA =====
    if (type === 'TROCA') {

        if (swapIds && swapIds.length > 0) {
            const swapNames = swapIds
                .map(id => players.find(p => p.id === id)?.name)
                .join(', ');

            details.push(`üîÑ Troca por: ${swapNames}`);
        }

        if (v > 0) {
            details.push(
                `üíµ Volta: ${meta.cashDir === 'PAY' ? 'Eu pago' : 'Eu recebo'} ${fmt(v)}`
            );
        }
    }

    return details.join('\n');
};

// =========================================================
// FIM - FORMATADOR DE DETALHES DE PROPOSTA
// =========================================================




        // =========================================================
// IN√çCIO - APP PRINCIPAL (ESTADOS, FIREBASE E LOGIN)
// Respons√°vel por:
// - Estados globais do aplicativo
// - Conex√£o em tempo real com Firebase
// - Login de usu√°rios, imprensa, empresas e jogadores
// =========================================================

function App() {

    // ================= ESTADOS GLOBAIS =================
    const [user, setUser] = useState(null);
    const [teams, setTeams] = useState([]);
    const [players, setPlayers] = useState([]);
    const [offers, setOffers] = useState([]);
    const [news, setNews] = useState([]);
    const [reqs, setReqs] = useState([]);
    const [conf, setConf] = useState({ marketOpen: true });
    const [papers, setPapers] = useState([]);
    const [journalists, setJournalists] = useState([]);
    const [companies, setCompanies] = useState([]);
    const [products, setProducts] = useState([]);
    const [sps, setSps] = useState([]);
    const [sales, setSales] = useState([]);

    // ================= CONTROLE DE UI =================
    const [screen, setScreen] = useState('HOME');
    const [modal, setModal] = useState(null);
    const [loading, setLoading] = useState(true);
    const [newNews, setNewNews] = useState(false);
    const [adminTeam, setAdminTeam] = useState(null);


    // ================= LISTENERS FIREBASE =================
    useEffect(() => {

        const unsubs = [
            db.collection('teams').onSnapshot(s =>
                setTeams(s.docs.map(d => ({ id: d.id, ...d.data() })))
            ),

            db.collection('players').onSnapshot(s =>
                setPlayers(s.docs.map(d => ({ id: d.id, ...d.data() })))
            ),

            db.collection('config').doc('system').onSnapshot(s =>
                setConf(s.exists ? s.data() : { marketOpen: true })
            ),

            db.collection('financeRequests').onSnapshot(s =>
                setReqs(s.docs.map(d => ({ id: d.id, ...d.data() })))
            ),

            db.collection('newspapers').onSnapshot(s =>
                setPapers(s.docs.map(d => ({ id: d.id, ...d.data() })))
            ),

            db.collection('journalists').onSnapshot(s =>
                setJournalists(s.docs.map(d => ({ id: d.id, ...d.data() })))
            ),

            db.collection('companies').onSnapshot(s =>
                setCompanies(s.docs.map(d => ({ id: d.id, ...d.data() })))
            ),

            db.collection('products').onSnapshot(s =>
                setProducts(s.docs.map(d => ({ id: d.id, ...d.data() })))
            ),

            db.collection('sponsorships').onSnapshot(s =>
                setSps(s.docs.map(d => ({ id: d.id, ...d.data() })))
            ),

            db.collection('sales')
                .orderBy('date', 'desc')
                .limit(50)
                .onSnapshot(s =>
                    setSales(s.docs.map(d => d.data()))
                ),

            db.collection('news')
                .orderBy('date', 'desc')
                .limit(50)
                .onSnapshot(s => {
                    const list = s.docs.map(d => ({ id: d.id, ...d.data() }));
                    setNews(list);

                    const lastRead = localStorage.getItem('lastRead');
                    if (list.length && (!lastRead || list[0].date > parseInt(lastRead))) {
                        setNewNews(true);
                    }
                    setLoading(false);
                })
        ];

        return () => unsubs.forEach(u => u());
    }, []);


    // ================= SINCRONIZA USU√ÅRIO =================
    useEffect(() => {

        if (user?.type === 'USER') {
            const me = teams.find(t => t.id === user.data.id);
            if (me) setUser(prev => ({ ...prev, data: me }));

            return db.collection('offers').onSnapshot(s => {
                setOffers(s.docs.map(d => ({ id: d.id, ...d.data() })));
            });
        }

        if (user?.type === 'COMPANY') {
            const me = companies.find(c => c.id === user.data.id);
            if (me) {
                if (me.status === 'BLOCKED') {
                    alert("üö´ Empresa Bloqueada/Falida.");
                    window.location.reload();
                } else {
                    setUser(prev => ({ ...prev, data: me }));
                }
            }
        }

    }, [teams, companies, user?.data?.id]);


    // ================= NOT√çCIAS =================
    const postNews = (text, type = 'normal') =>
        db.collection('news').add({ text, type, date: Date.now() });


    // ================= LOGIN =================
    const login = (id, pwd, type) => {

        if (type === 'TEAM') {
            const t = teams.find(x => x.id === id);
            if (t && t.password === pwd) {
                if (t.status === 'PENDING') alert("‚è≥ Aguarde a Federa√ß√£o.");
                else {
                    setUser({ type: 'USER', data: t });
                    setScreen('HOME');
                }
            } else alert("Erro!");
        }

        else if (type === 'PAPER') {
            const p = papers.find(x => x.id === id);
            if (p && p.password === pwd) {
                if (p.status === 'PENDING') alert("‚è≥ Aguarde a Federa√ß√£o.");
                else {
                    setUser({ type: 'PRESS', data: p });
                    setScreen('PRESS_DASH');
                }
            } else alert("Erro!");
        }

        else if (type === 'JOURNALIST') {
            const j = journalists.find(x => x.id === id);
            if (j && j.password === pwd) {
                if (j.status === 'PENDING') alert("‚è≥ Aguarde o Dono do Jornal.");
                else {
                    setUser({ type: 'PRESS_WORKER', data: j });
                    setScreen('PRESS_DASH');
                }
            } else alert("Erro!");
        }

        else if (type === 'COMPANY') {
            const c = companies.find(x => x.id === id);
            if (c && c.password === pwd) {
                if (c.status === 'PENDING') alert("‚è≥ Aguarde a Federa√ß√£o.");
                else if (c.status === 'BLOCKED') alert("üö´ Empresa Bloqueada.");
                else {
                    setUser({ type: 'COMPANY', data: c });
                    setScreen('COMPANY_HOME');
                }
            } else alert("Erro!");
        }

        else if (type === 'PLAYER') {
            const pl = players.find(x => x.id === id);
            const pass = pl?.password || '1234';
            if (pl && pass === pwd) {
                setUser({ type: 'PLAYER', data: pl });
                setScreen('PLAYER_DASH');
            } else alert("Senha incorreta!");
        }
    };

    // ‚¨á‚¨á‚¨á AQUI VEM O return (JSX) ‚Äî N√ÉO INCLU√çDO NESTE BLOCO ‚¨á‚¨á‚¨á
}

// =========================================================
// FIM - APP PRINCIPAL (ESTADOS, FIREBASE E LOGIN)
// =========================================================


            // =========================================================
// IN√çCIO - SISTEMA ADMINISTRATIVO E CRIA√á√ÉO DE CONTAS
// Respons√°vel por:
// - Login do Administrador (Federa√ß√£o)
// - Cria√ß√£o de Times
// - Cria√ß√£o de Jornais
// - Cria√ß√£o de Jornalistas
// =========================================================


// --- LOGIN ADMINISTRADOR (FEDERA√á√ÉO) ---
const loginAdmin = () => {
    setUser({
        type: 'ADMIN',
        data: {
            id: 'admin',
            name: 'FEDERA√á√ÉO (ADM)',
            balance: 0,
            logo: null,
            stadiumLevel: 1,
            serie: 'ADM'
        }
    });
    setScreen('HOME');
};


// --- CRIA√á√ÉO DE TIME ---
const createTeam = async (name, bal, serie, pass, logo) => {
    if (teams.find(t => t.name.toLowerCase() === name.toLowerCase())) {
        return alert("Nome em uso!");
    }

    await db.collection('teams').add({
        name,
        balance: parseFloat(bal),
        serie,
        password: pass,
        stadiumLevel: 1,
        logo: logo || null,
        status: 'PENDING'
    });

    alert("Criado! Aguarde aprova√ß√£o.");
};


// --- CRIA√á√ÉO DE JORNAL ---
const createNewspaper = async (name, pass, owner) => {
    await db.collection('newspapers').add({
        name,
        password: pass,
        ownerName: owner,
        status: 'PENDING'
    });

    alert("Jornal criado! Aguarde Federa√ß√£o.");
};


// --- CRIA√á√ÉO DE JORNALISTA ---
const createJournalist = async (name, pass, paperId) => {
    await db.collection('journalists').add({
        name,
        password: pass,
        newspaperId: paperId,
        status: 'PENDING'
    });

    alert("Conta criada! Aguarde seu Chefe.");
};


// =========================================================
// FIM - SISTEMA ADMINISTRATIVO E CRIA√á√ÉO DE CONTAS
// =========================================================


            

          /* ======================================================================
   BLOCO 1 ‚Äî CRIA√á√ÉO DE EMPRESA
   Fun√ß√£o respons√°vel por enviar solicita√ß√£o de cria√ß√£o de empresa
   para o banco de dados (status inicial: PENDING)
====================================================================== */
const createCompany = async (f) => {

    if(!f.n || !f.p) return alert("Preencha tudo!");

    await db.collection('companies').add({ 
        name: f.n, 
        owner: f.owner, 
        password: f.p, 
        companyType: f.type, 
        balance: COMPANY_TYPES[f.type].start, 
        status: 'PENDING' 
    });

    alert("Solicita√ß√£o enviada! Aguarde a Federa√ß√£o.");

};
/* ========================== FIM BLOCO 1 ========================== */


/* ======================================================================
   BLOCO 2 ‚Äî PRODUTOS
   Cria√ß√£o e edi√ß√£o de produtos das empresas
   Inclui categoria, pre√ßo, imagem e not√≠cias autom√°ticas
====================================================================== */
const saveProduct = async (p) => {

    const price = parseFloat(p.price);

    const payload = { 
        name: p.name, 
        price, 
        img: p.img, 
        desc: p.desc,
        cat: p.cat || 'CHUTEIRA',
        companyId: user.data.id 
    };

    if (p.id) {

        const old = products.find(x => x.id === p.id);

        if (old && price < old.price) {
            postNews(
                `üö® **PROMO√á√ÉO!**\nA **${user.data.name}** baixou o pre√ßo de **${p.name}**!\nDe: ${fmt(old.price)} ‚ûù Por: ${fmt(price)}`, 
                'biz'
            );
        }

        delete payload.companyId;

        await db.collection('products').doc(p.id).update(payload);

    } else {

        await db.collection('products').add(payload);

        postNews(
            `üõçÔ∏è **NOVIDADE**\nA **${user.data.name}** lan√ßou: **${p.name}** (${PROD_CATS[payload.cat]}) por ${fmt(price)}.`, 
            'biz'
        );

    }
};
/* ========================== FIM BLOCO 2 ========================== */


/* ======================================================================
   BLOCO 3 ‚Äî PATROC√çNIO
   Solicita√ß√£o, aprova√ß√£o, rejei√ß√£o e cancelamento de patroc√≠nios
====================================================================== */
const requestSponsorship = async (companyId, val) => {

    if (sps.find(s => s.companyId === companyId && s.teamId === user.data.id)) {
        return alert("J√° existe uma negocia√ß√£o ou contrato ativo com esta empresa.");
    }

    const comp = companies.find(c => c.id === companyId);

    await db.collection('sponsorships').add({ 
        companyId, 
        companyName: comp.name, 
        teamId: user.data.id, 
        teamName: user.data.name, 
        value: parseFloat(val), 
        status: 'PENDING' 
    });

    alert("Proposta enviada para a empresa!");

};


const processSponsorship = async (s, status) => {

    if (status === 'REJECTED' || status === 'CANCELLED') {

        if(confirm(status === 'REJECTED' ? "Recusar proposta?" : "Cancelar contrato?")) {
            await db.collection('sponsorships').doc(s.id).delete();
        }

    } else if (status === 'ACTIVE') {

        await db.collection('sponsorships').doc(s.id).update({ status: 'ACTIVE' });

        postNews(
            `ü§ù **NOVO PATROC√çNIO**\nA **${user.data.name}** agora patrocina o **${s.teamName}**!`, 
            'biz'
        );

    }
};
/* ========================== FIM BLOCO 3 ========================== */


/* ======================================================================
   BLOCO 4 ‚Äî COMPRAS
   Compra de produtos, desconto de saldo e registro de vendas
====================================================================== */
const buyProduct = async (prod, seller) => {

    const currentBalance = user.data.balance || 0;

    if (currentBalance < prod.price) return alert("Saldo insuficiente!");
    if (!confirm(`Comprar ${prod.name} por ${fmt(prod.price)}?`)) return;

    const b = db.batch();

    if (user.type === 'PLAYER') {
        b.update(
            db.collection('players').doc(user.data.id), 
            { balance: currentBalance - prod.price }
        );
    } else {
        b.update(
            db.collection('teams').doc(user.data.id), 
            { balance: currentBalance - prod.price }
        );
    }

    b.update(
        db.collection('companies').doc(seller.id), 
        { balance: seller.balance + prod.price }
    );

    const saleRef = db.collection('sales').doc();
    b.set(saleRef, { 
        companyId: seller.id, 
        productName: prod.name, 
        buyerName: user.data.name, 
        price: prod.price, 
        date: Date.now() 
    });

    await b.commit();

    alert("Compra realizada com sucesso!");

};
/* ========================== FIM BLOCO 4 ========================== */




           /* ======================================================================
   BLOCO 5 ‚Äî ADMINISTRA√á√ÉO DE TIMES
   Aprova√ß√£o, exclus√£o e ajuste financeiro de clubes
====================================================================== */
const approveTeam = async (teamId, finalBalance) => {

    await db.collection('teams').doc(teamId).update({ 
        status: 'ACTIVE', 
        balance: parseFloat(finalBalance) 
    });

    const t = teams.find(x => x.id === teamId);

    postNews(
        `üõ°Ô∏è **NOVO CLUBE!**\nO **${t.name}** foi aprovado na S√©rie ${t.serie}.`, 
        'infra'
    );

    alert("Aprovado!");
};


const deleteTeam = async (teamId) => {

    if(!confirm("‚ö†Ô∏è PERIGO: Excluir time e jogadores?")) return;

    const batch = db.batch();

    batch.delete(db.collection('teams').doc(teamId));

    const snap = await db.collection('players')
        .where('teamId', '==', teamId)
        .get();

    snap.docs.forEach(doc => batch.delete(doc.ref));

    await batch.commit();

    postNews(
        "üö´ **CLUBE EXTINTO**\nUm time encerrou atividades.", 
        'infra'
    );
};


const updateBalance = async (teamId, newBal) => {

    await db.collection('teams').doc(teamId).update({ 
        balance: parseFloat(newBal) 
    });

    alert("Atualizado!");
};
/* ========================== FIM BLOCO 5 ========================== */


/* ======================================================================
   BLOCO 6 ‚Äî JORNAIS E JORNALISTAS
   Exclus√£o de jornais e demiss√£o de jornalistas
====================================================================== */
const deletePaper = async (id) => {

    if(!confirm("Excluir Jornal e demitir jornalistas?")) return;

    const batch = db.batch();

    batch.delete(db.collection('newspapers').doc(id));

    const js = await db.collection('journalists')
        .where('newspaperId', '==', id)
        .get();

    js.docs.forEach(d => batch.delete(d.ref));

    await batch.commit();

    alert("Jornal fechado!");
};


const deleteJournalist = async (id) => {

    if(!confirm("Demitir Jornalista?")) return;

    await db.collection('journalists').doc(id).delete();

    alert("Demitido!");
};
/* ========================== FIM BLOCO 6 ========================== */


/* ======================================================================
   BLOCO 7 ‚Äî FINAN√áAS DO CLUBE
   Retirada de dinheiro com registro em not√≠cias
====================================================================== */
const withdrawMoney = async (amount, reason) => {

    const val = parseFloat(amount.replace(',', '.'));

    if(isNaN(val) || val <= 0) return alert("Valor inv√°lido!");
    if(user.data.balance < val) return alert("Saldo insuficiente!");

    await db.collection('teams').doc(user.data.id).update({ 
        balance: firebase.firestore.FieldValue.increment(-val) 
    });

    postNews(
        `üí∏ **SA√çDA DE CAIXA**\nO **${user.data.name}** retirou ${fmt(val)}.\nüìù Motivo: ${reason}`, 
        'money-minus'
    );

    setModal(null);
};
/* ========================== FIM BLOCO 7 ========================== */


           /* ======================================================================
   BLOCO 8 ‚Äî SISTEMA DE JOGADORES
   Cria√ß√£o, edi√ß√£o e atualiza√ß√£o de jogadores
   (inclui regras de time, atributos, XP e status)
====================================================================== */

/* ----------------------------------------------------------------------
   FUN√á√ÉO: savePlayer
   Respons√°vel por:
   - Criar novo jogador OU atualizar existente
   - Definir corretamente o time (USER / ADMIN / FREE)
   - Validar atributos m√≠nimos
   - Resetar XP quando overall muda
   - Publicar not√≠cia quando √© contrata√ß√£o nova
---------------------------------------------------------------------- */
const savePlayer = async (d) => {

    try {

        const isNew = !d.id;
        const ref = isNew 
            ? db.collection('players').doc() 
            : db.collection('players').doc(d.id);

        const old = isNew 
            ? {} 
            : (players.find(pl => pl.id === d.id) || {});


        // REGRA DE OURO: define para qual time o jogador vai
        let targetTeamId = d.teamId || old.teamId || 'FREE';

        if (user.type === 'USER') targetTeamId = user.data.id;
        if (user.type === 'ADMIN' && adminTeam) targetTeamId = adminTeam.id;
        if (d.forcedTeamId) targetTeamId = d.forcedTeamId;


        // DADOS DO JOGADOR
        const data = {

            name: d.name || "Jogador Novo",
            position: d.position || "ATA",
            overall: Math.max(45, parseInt(d.overall) || 45),

            value: parseFloat(d.value) || 0,
            salary: parseFloat(d.salary) || 1000,
            clause: parseFloat(d.clause) || 1000000,
            contract: parseInt(d.contract) || 1,

            mood: d.mood || 'üòê',
            status: d.status || 'NAO_A_VENDA',

            teamId: targetTeamId,
            password: d.password || old.password || '1234',

            balance: parseFloat(d.balance || old.balance || 0),
            xp: parseInt(d.xp || old.xp || 0),
            energy: parseInt(d.energy || old.energy || 100),

            stats: d.stats || old.stats || {
                goals: 0,
                assists: 0,
                tackles: 0,
                saves: 0,
                yellows: 0,
                reds: 0
            }
        };


        // Se overall mudou, reseta XP
        if (!isNew && data.overall !== old.overall) {
            data.xp = 0;
        }


        await ref.set(data, { merge: true });
        setModal(null);


        // P√≥s-salvamento
        if (isNew) {

            const tName = teams.find(t => t.id === targetTeamId)?.name || "um clube";

            postNews(
                `üÜï **REFOR√áO**\nO **${tName}** contratou **${data.name}**!`,
                'transfer'
            );

        } else {

            alert("Jogador atualizado!");

        }

    } catch (e) {

        console.error(e);
        alert("Erro ao salvar! Verifique se digitou apenas n√∫meros nos campos de valor.");

    }
};


/* ----------------------------------------------------------------------
   FUN√á√ÉO: updateStats
   Atualiza apenas as estat√≠sticas do jogador
---------------------------------------------------------------------- */
const updateStats = async (pid, newStats) => { 

    await db.collection('players').doc(pid).update({ 
        stats: newStats 
    }); 

    alert("Stats Atualizados!"); 
    setModal(null); 

};
/* ========================== FIM BLOCO 8 ========================== */



           /* ======================================================================
   BLOCO 9 ‚Äî SISTEMA DE NEGOCIA√á√ÉO CL√ÅSSICO (CLUBE x CLUBE)
   Envio de propostas, contrapropostas, aceite, recusa e renova√ß√£o
====================================================================== */

/* ----------------------------------------------------------------------
   FUN√á√ÉO: sendOffer
   Envia uma oferta ou contraproposta por um jogador
   - Blindagem de valores num√©ricos
   - Sistema de turnos (quem envia / quem recebe)
   - Gera√ß√£o de descri√ß√£o detalhada
---------------------------------------------------------------------- */
const sendOffer = async (target, type, value, swapIds, con, meta, old) => {

    try {

        // Blindagem de dados num√©ricos
        const v = parseFloat(value) || 0;
        const contractYears = parseInt(con) || 1;

        const actingTeamName = user.data.name;
        const targetPlayerName = target.name;


        // Descri√ß√£o detalhada da oferta
        let details = `üí∞ Taxa: ${fmt(v)}\n`;

        if (meta.installments > 1)
            details += `üìÖ Parcelamento: ${meta.installments}x de ${fmt(v / meta.installments)}\n`;

        if (meta.sellOn > 0)
            details += `üìà Revenda: ${meta.sellOn}%\n`;

        details += `üìù Contrato: ${contractYears} anos\n`;
        details += `üíµ Sal√°rio Sugerido: ${fmt(meta.newSalary)}/sem\n`;
        details += `üëî Papel: ${meta.role || 'ROTACAO'}`;


        // Sistema de turnos (dono x comprador)
        let recipientId = target.teamId;

        if (old && old.id) {
            recipientId = (user.data.id === old.buyerId)
                ? old.sellerId
                : old.buyerId;
        }


        // Payload da proposta
        const pl = {

            playerId: target.id,
            playerName: targetPlayerName,

            buyerId: old?.buyerId || user.data.id,
            buyerName: old?.buyerName || actingTeamName,

            sellerId: target.teamId || old?.sellerId || 'FREE',
            recipientId: recipientId,

            type: type,
            value: v,
            offerContract: contractYears,

            description: details,

            meta: {
                ...meta,
                newSalary: parseFloat(meta.newSalary) || 0,
                signingBonus: parseFloat(meta.signingBonus) || 0,
                role: meta.role || 'ROTACAO',
                installments: parseInt(meta.installments) || 1,
                sellOn: parseInt(meta.sellOn) || 0
            },

            date: Date.now()
        };


        const b = db.batch();

        // Se for contraproposta, remove a antiga
        if (old && old.id) {
            b.delete(db.collection('offers').doc(old.id));
        }

        b.set(db.collection('offers').doc(), pl);
        await b.commit();


        // Not√≠cia
        const msgHead = (old && old.id)
            ? "üîÑ CONTRAPROPOSTA"
            : "üíº NOVA OFERTA";

        postNews(
            `${msgHead}\nO **${actingTeamName}** enviou termos detalhados por **${targetPlayerName}**!\n\n${details}`,
            'transfer'
        );

        setModal(null);
        alert("Proposta enviada com sucesso!");

    } catch (e) {

        console.error("Erro no Firebase:", e);
        alert("Erro t√©cnico: Verifique se os campos de pre√ßo e contrato cont√™m apenas n√∫meros.");

    }
};


/* ----------------------------------------------------------------------
   FUN√á√ÉO: acceptOffer
   Aceita uma proposta:
   - Trata parcelamento ou pagamento √† vista
   - Move o jogador
   - Atualiza saldo, contrato, sal√°rio e hist√≥rico
---------------------------------------------------------------------- */
const acceptOffer = async (o) => {

    try {

        const buy = teams.find(t => t.id === o.buyerId);
        const sel = teams.find(t => t.id === o.sellerId);
        const p = players.find(x => x.id === o.playerId);

        if (!buy || !sel || !p)
            return alert("Erro: Dados incompletos.");


        const valorEntrada =
            o.meta?.installments > 1
                ? (o.value / o.meta.installments)
                : o.value;

        if (buy.balance < valorEntrada)
            return alert("O comprador n√£o tem saldo para fechar o neg√≥cio!");

        if (!confirm(`Confirmar venda de ${p.name} por ${fmt(o.value)}?`))
            return;


        const b = db.batch();


        // Parte financeira
        if (o.meta?.installments > 1) {

            b.update(db.collection('teams').doc(buy.id), {
                balance: buy.balance - valorEntrada
            });

            b.update(db.collection('teams').doc(sel.id), {
                balance: sel.balance + valorEntrada
            });

            // Registra d√≠vida
            db.collection('debts').add({
                buyerId: buy.id,
                buyerName: buy.name,
                sellerId: sel.id,
                sellerName: sel.name,
                playerName: p.name,
                installmentVal: valorEntrada,
                weeksRemaining: parseInt(o.meta.installments) - 1,
                date: Date.now()
            });

        } else {

            b.update(db.collection('teams').doc(buy.id), {
                balance: buy.balance - o.value
            });

            b.update(db.collection('teams').doc(sel.id), {
                balance: sel.balance + o.value
            });

        }


        // Transfer√™ncia do jogador
        const historyEntry = {
            date: Date.now(),
            from: sel.name,
            to: buy.name,
            type: o.type,
            value: o.value
        };

        b.update(db.collection('players').doc(p.id), {

            teamId: buy.id,
            status: 'NAO_A_VENDA',

            contract: parseInt(o.offerContract) || 1,
            salary: parseFloat(o.meta?.newSalary) || p.salary,
            role: o.meta?.role || 'ROTACAO',

            sellOnDetails: o.meta?.sellOn > 0
                ? { percentage: o.meta.sellOn, beneficiary: sel.id }
                : null,

            history: firebase.firestore.FieldValue.arrayUnion(historyEntry)

        });


        // Remove proposta
        b.delete(db.collection('offers').doc(o.id));

        await b.commit();

        postNews(
            `ü§ù **NEG√ìCIO FECHADO**\nO **${buy.name}** fechou a contrata√ß√£o de **${p.name}**!`,
            'transfer'
        );

        alert("Transfer√™ncia conclu√≠da!");

    } catch (e) {

        console.error(e);
        alert("Erro ao aceitar proposta.");

    }
};


/* ----------------------------------------------------------------------
   FUN√á√ÉO: rejectOffer
   Encerra a negocia√ß√£o sem acordo
---------------------------------------------------------------------- */
const rejectOffer = async (o) => {

    if (!confirm("Encerrar negocia√ß√£o?")) return;

    await db.collection('offers').doc(o.id).delete();

    postNews(
        `‚ùå **SEM ACORDO**\nAs conversas por **${o.playerName}** foram encerradas.`,
        'transfer'
    );

};


/* ----------------------------------------------------------------------
   FUN√á√ÉO: renewContract
   Renova contrato do jogador atual
   - Cobra luvas (10% do valor)
---------------------------------------------------------------------- */
const renewContract = async (p) => {

    const cost = (parseFloat(p.value) || 1000000) * 0.10;

    if (user.data.balance < cost)
        return alert(`Sem saldo para luvas (Custo: ${fmt(cost)})`);

    if (!confirm(`Renovar com ${p.name}?\nCusto: ${fmt(cost)}`))
        return;

    const b = db.batch();

    b.update(db.collection('teams').doc(user.data.id), {
        balance: firebase.firestore.FieldValue.increment(-cost)
    });

    b.update(db.collection('players').doc(p.id), {
        contract: (parseInt(p.contract) || 0) + 1,
        balance: firebase.firestore.FieldValue.increment(cost)
    });

    await b.commit();

    postNews(
        `üìù **RENOVA√á√ÉO**\n**${p.name}** renovou com o **${user.data.name}**.`,
        'transfer'
    );

    setModal(null);

};
/* ========================== FIM BLOCO 9 ========================== */




            /* ======================================================================
   BLOCO 10 ‚Äî SISTEMA DE IMPRENSA E S√öMULAS DE PARTIDA
   Atualiza√ß√£o de tabela e lan√ßamento de desempenho individual
====================================================================== */

/* ----------------------------------------------------------------------
   FUN√á√ÉO: updateTeamStats
   Usada por jornalistas para atualizar estat√≠sticas do time na tabela
---------------------------------------------------------------------- */
const updateTeamStats = async (tid, stats) => {

    await db.collection('teams').doc(tid).update({
        stats
    });

    alert("Tabela atualizada!");

};


/* ----------------------------------------------------------------------
   FUN√á√ÉO: saveMatchStats
   Lan√ßa a s√∫mula de um jogador ap√≥s a partida
   - Soma estat√≠sticas individuais
   - Acumula XP pendente
   - Calcula e mant√©m m√©dia da imprensa
---------------------------------------------------------------------- */
const saveMatchStats = async (player, match, xpGained) => {

    // Valida√ß√£o: exige nota da imprensa
    if (match.rating === '' || match.rating === null)
        return alert("D√™ uma nota para a atua√ß√£o!");

    // üîí Blindagem da nota (sempre entre 0 e 10)
    const rating = Math.min(10, Math.max(0, parseFloat(match.rating)));

    const b = db.batch();
    const pRef = db.collection('players').doc(player.id);

    // Soma stats antigos + novos
    const newStats = {
        goals: (player.stats?.goals || 0) + match.goals,
        assists: (player.stats?.assists || 0) + match.assists,
        tackles: (player.stats?.tackles || 0) + match.tackles,
        saves: (player.stats?.saves || 0) + match.saves,
        yellows: (player.stats?.yellows || 0) + match.yellows,
        reds: (player.stats?.reds || 0) + match.reds
    };

    // ===== C√ÅLCULO DA M√âDIA DA IMPRENSA =====
    const currentSum = player.pressRatingSum || 0;
    const currentCount = player.pressRatingCount || 0;

    const newSum = currentSum + rating;
    const newCount = currentCount + 1;
    const newAvg = newSum / newCount;

    // Atualiza jogador
    b.update(pRef, {
        stats: newStats,
        pendingXP: (player.pendingXP || 0) + xpGained,
        pressRatingSum: newSum,
        pressRatingCount: newCount,
        pressRatingAvg: parseFloat(newAvg.toFixed(1)) // Ex: 7.5
    });

    await b.commit();

    alert(`S√∫mula lan√ßada! M√©dia do jogador agora √©: ${newAvg.toFixed(1)}`);
    setModal(null);

};
/* ========================== FIM BLOCO 10 ========================== */



// --- NOVA FUN√á√ÉO: A√á√ïES DE CARREIRA DO JOGADOR ---

const handlePlayerActions = async (type, p) => {

    const team = teams.find(t => t.id === p.teamId);

    // ==================================================
    // 1. PEDIR TRANSFER√äNCIA
    // ==================================================
    if (type === 'TRANSFER_REQUEST') {

        if (!team) return alert("J√° √©s um Agente Livre!");
        if (p.status === 'VENDA') return alert("J√° est√°s na lista de transfer√™ncias.");
        if (!confirm(`Tens a certeza que queres pedir para sair do ${team.name}? O adepto n√£o vai gostar...`)) return;

        await db.collection('players').doc(p.id).update({
            status: 'VENDA',
            mood: 'üò°'
        });

        postNews(
            `üí£ **CRISE NO ${team.name.toUpperCase()}!**\nO jogador **${p.name}** est√° insatisfeito e pediu para ser colocado na lista de transfer√™ncias!`,
            'rumor'
        );

        alert("O pedido foi feito. O teu humor piorou.");
    }

    // ==================================================
    // 2. PEDIR AUMENTO
    // ==================================================
    if (type === 'ASK_RAISE') {

        if (!team) return alert("Precisas de um clube para pedir aumento.");
        if (!confirm("Ir √† imprensa pedir um aumento salarial?")) return;

        postNews(
            `üí∞ **POL√âMICA**\n**${p.name}** declara publicamente: "Mere√ßo ganhar mais no ${team.name}. Espero uma renova√ß√£o em breve."`,
            'press'
        );

        alert("Declara√ß√£o feita √† imprensa! O presidente foi notificado.");
    }

    // ==================================================
    // 3. DECLARAR QUE EST√Å FELIZ NO CLUBE (NOVA)
    // ==================================================
    if (type === 'PLAYER_HAPPY') {

        if (!team) return alert("Sem clube n√£o h√° motivo para comemorar üòÖ");

        if (!confirm(`Confirmar declara√ß√£o positiva sobre o ${team.name}?`)) return;

        await db.collection('players').doc(p.id).update({
            mood: 'üòÅ'
        });

        postNews(
            `üòä **CLIMA BOM NO ${team.name.toUpperCase()}!**\n**${p.name}** afirmou estar muito feliz no clube e motivado para a temporada.`,
            'press'
        );

        alert("Declara√ß√£o feita! O teu humor melhorou.");
    }

};
// fim)

            

            // 3. Fun√ß√£o Mestra do Admin (COM IMPOSTO DE 3% NOS JOGADORES)

const adminAction = async (act, data) => {

    // ==================================================
    // ABRIR / FECHAR MERCADO
    // ==================================================
    if (act === 'MARKET') {

        await db.collection('config').doc('system').update({
            marketOpen: data
        });

        postNews(
            data ? "üì¢ JANELA DE TRANSFER√äNCIAS ABERTA" : "üîí JANELA DE TRANSFER√äNCIAS FECHADA",
            'infra'
        );

        alert(data ? "Mercado aberto!" : "Mercado fechado!");
    }

    // ==================================================
    // TRANSFER√äNCIA COM IMPOSTO DE 3%
    // data = { player, fromTeam, toTeam, price }
    // ==================================================
    if (act === 'TRANSFER_PLAYER') {

        const { player, fromTeam, toTeam, price } = data;

        if (!player || !toTeam || !price)
            return alert("Dados inv√°lidos para transfer√™ncia.");

        const transferValue = parseFloat(price);

        if (isNaN(transferValue) || transferValue <= 0)
            return alert("Valor da transfer√™ncia inv√°lido.");

        // Imposto de 3%
        const tax = transferValue * 0.03;
        const finalValue = transferValue - tax;

        const b = db.batch();

        const playerRef = db.collection('players').doc(player.id);
        const fromRef = fromTeam ? db.collection('teams').doc(fromTeam.id) : null;
        const toRef = db.collection('teams').doc(toTeam.id);
        const systemRef = db.collection('config').doc('system');

        // Atualiza jogador
        b.update(playerRef, {
            teamId: toTeam.id,
            status: 'ATIVO',
            mood: 'üôÇ'
        });

        // Clube vendedor recebe valor com imposto descontado
        if (fromRef) {
            b.update(fromRef, {
                money: (fromTeam.money || 0) + finalValue
            });
        }

        // Clube comprador paga valor cheio
        b.update(toRef, {
            money: (toTeam.money || 0) - transferValue
        });

        // Sistema recebe o imposto
        b.update(systemRef, {
            treasury: (data.systemTreasury || 0) + tax
        });

        await b.commit();

        postNews(
            `üíº **TRANSFER√äNCIA CONCLU√çDA**\n**${player.name}** foi transferido para o **${toTeam.name}** por ‚Ç¨${transferValue.toFixed(2)}.\nüí∞ Imposto do sistema: ‚Ç¨${tax.toFixed(2)}`,
            'market'
        );

        alert("Transfer√™ncia realizada com sucesso!");
    }
};
// fim

                

                                // VIRADA DE TEMPORADA (Igual ao anterior)

                if(act==='SEASON') { 
                    if(!confirm("‚ö†Ô∏è VIRAR TEMPORADA?\n\n1. Evoluir N√≠veis\n2. Envelhecer Contratos")) return; 

                    setLoading(true); 
                    const b = db.batch(); 

                    players.forEach(p => { 
                        let u = {}; 

                        const currentLvl = p.overall || 45;
                        const currentXP = p.xp || 0;

                        const res = calcNewLevel(currentLvl, currentXP, 0); 

                        if (res.lvl !== currentLvl) { 
                            u.overall = res.lvl; 
                            u.xp = res.xp; 
                        }

                        let nc = (p.contract || 0) - 1; 
                        if (nc < 0) nc = 0; 
                        u.contract = nc; 

                        if ((p.contract <= 1 || p.contract === 0) && p.preContract) { 
                            if (teams.some(t => t.id === p.preContract.teamId)) { 
                                u.teamId = p.preContract.teamId; 
                                u.contract = 1; 
                                u.status = 'NAO_A_VENDA'; 
                                u.preContract = firebase.firestore.FieldValue.delete(); 
                            } 
                        } 

                        b.update(db.collection('players').doc(p.id), u); 
                    }); 

                    try { 
                        await b.commit(); 
                        alert("Temporada virada!"); 
                    } catch (e) { 
                        alert("Erro: " + e.message); 
                    }

                    setLoading(false); 
                    postNews("üåû **NOVA TEMPORADA**", 'season'); 
                }

            }; 
/* ====================== FIM DA FUN√á√ÉO adminAction ====================== */


            /* ======================================================================
   IN√çCIO DO RENDER PRINCIPAL
   Respons√°vel por todas as telas, navega√ß√£o e modais do sistema
====================================================================== */

            // LOADING GLOBAL
            if (loading)
                return (
                    <div style={{ display: 'grid', placeItems: 'center', height: '100vh' }}>
                        Carregando...
                    </div>
                );

            // LOGIN / VISITOR
            if (!user)
                return (
                    <LoginScreen
                        teams={teams}
                        players={players}
                        papers={papers}
                        journalists={journalists}
                        companies={companies}
                        onLogin={login}
                        onCreateTeam={createTeam}
                        onCreatePaper={createNewspaper}
                        onCreateJourno={createJournalist}
                        onCreateCompany={createCompany}
                        onAdmin={loginAdmin}
                        onVisitor={() => {
                            setUser({ type: 'VISITOR' });
                            setScreen('RANKING');
                        }}
                    />
                );

            // ===================== RENDER PRINCIPAL =====================
            return (
                <div>

                    {/* ===================== HEADER ===================== */}
                    <div className="header">

                        <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                            {user.type === 'USER' && user.data.logo && (
                                <img
                                    src={user.data.logo}
                                    style={{
                                        width: 40,
                                        height: 40,
                                        borderRadius: '50%',
                                        border: '2px solid var(--primary)',
                                        objectFit: 'cover'
                                    }}
                                />
                            )}

                            <div>
                                <div style={{ fontWeight: 900, fontSize: 16 }}>
                                    {user.type === 'USER' ? user.data.name : user.data?.name || user.type}
                                </div>
                                <div className="dev-credits" style={{ textAlign: 'left', margin: 0 }}>
                                    Desenvolvido por: Nathan Reis | v1.90.5
                                </div>
                            </div>
                        </div>

                        <div style={{ display: 'flex', gap: 15, alignItems: 'center' }}>
                            {user.type === 'USER' && (
                                <div onClick={() => setScreen('OFFERS')}>
                                    <i
                                        className="fas fa-bell"
                                        style={{ color: offers.length ? 'var(--warning)' : '#555' }}
                                    ></i>
                                    {offers.length > 0 && (
                                        <span
                                            className="pulse"
                                            style={{
                                                position: 'absolute',
                                                top: -5,
                                                right: -5,
                                                background: 'red',
                                                borderRadius: '50%',
                                                width: 8,
                                                height: 8
                                            }}
                                        ></span>
                                    )}
                                </div>
                            )}

                            {(user.type === 'USER' || user.type === 'COMPANY') && (
                                <div style={{ color: 'var(--primary)', fontWeight: 'bold' }}>
                                    {fmt(user.data.balance)}
                                </div>
                            )}

                            {user.type === 'USER' && (
                                <i className="fas fa-cog" onClick={() => setModal({ type: 'SETTINGS', data: user.data })}></i>
                            )}

                            <i className="fas fa-sign-out-alt" onClick={() => window.location.reload()}></i>
                        </div>

                    </div>
                    {/* ===================== FIM HEADER ===================== */}


                    {/* ===================== CONTE√öDO ===================== */}
                    <div className="container">

                        {screen === 'HOME' && user.type === 'ADMIN' && (
                            <AdminPanel
                                teams={teams}
                                papers={papers}
                                journalists={journalists}
                                companies={companies}
                                reqs={reqs}
                                config={conf}
                                onAct={adminAction}
                                onPost={(t, b, tp) => postNews(`üì¢ **${t}**\n${b}`, tp)}
                                onEditT={(t) => { setAdminTeam(t); setScreen('ADMIN_TEAM'); }}
                                onApproveTeam={approveTeam}
                                onUpdateBal={updateBalance}
                                onDeleteTeam={deleteTeam}
                                onDeletePaper={deletePaper}
                                onDeleteJourno={deleteJournalist}
                                onApproveComp={async id => {
                                    await db.collection('companies').doc(id).update({ status: 'ACTIVE' });
                                    alert("Empresa Aprovada!");
                                }}
                                onDeleteComp={async id => {
                                    if (confirm("Excluir Empresa?"))
                                        await db.collection('companies').doc(id).delete();
                                }}
                                onUpdateCompBal={async (id, val) => {
                                    await db.collection('companies').doc(id).update({ balance: parseFloat(val) });
                                    alert("Saldo Alterado!");
                                }}
                            />
                        )}

                        {screen === 'HOME' && user.type === 'USER' && (
                            <TeamDashboard
                                team={user.data}
                                players={players.filter(p => p.teamId === user.data.id)}
                                isVisitor={false}
                                onEdit={p => setModal({ type: 'PLAYER', data: p })}
                                onAdd={() => setModal({ type: 'PLAYER' })}
                            />
                        )}

                        {screen === 'HOME' && user.type === 'VISITOR' && (
                            <VisitorDashboard players={players} teams={teams} />
                        )}

                        {screen === 'RANKING' && <Ranking teams={teams} players={players} />}

                        {screen === 'NEWS' && (
                            <div>
                                <h3>Not√≠cias</h3>
                                {news.map(n => (
                                    <div key={n.id} className={`news-card news-${n.type}`}>
                                        {n.text}
                                        <br />
                                        <small style={{ color: '#666' }}>
                                            {new Date(n.date).toLocaleString()}
                                        </small>
                                    </div>
                                ))}
                            </div>
                        )}

                    </div>
                    {/* ===================== FIM CONTE√öDO ===================== */}


                    {/* ===================== MODAL ===================== */}
                    {modal && (
                        <div
                            className="modal-overlay"
                            onClick={(e) => e.target === e.currentTarget && setModal(null)}
                        >
                            <div className="modal-content">

                                {modal.type === 'PLAYER' && (
                                    <PlayerForm
                                        initial={modal.data}
                                        onSave={savePlayer}
                                        onDelete={async id => {
                                            await db.collection('players').doc(id).delete();
                                            setModal(null);
                                        }}
                                        isAdmin={user.type === 'ADMIN'}
                                        teams={teams}
                                        onRenew={renewContract}
                                        isOwner={user.type === 'USER' && modal.data?.teamId === user.data?.id}
                                    />
                                )}

                            </div>
                        </div>
                    )}
                    {/* ===================== FIM MODAL ===================== */}

                </div>
            );
/* ===================== FIM DO RENDER PRINCIPAL ===================== */




        /* ======================================================================
   COMPONENTE: LoginScreen
   Fun√ß√£o:
   - Login de Times, Jogadores, Empresas e Imprensa
   - Cria√ß√£o de Time, Jornal e Empresa
   - Entrada como Visitante ou Admin
====================================================================== */

const LoginScreen = ({
    teams,
    players,
    papers,
    journalists,
    companies,
    onLogin,
    onCreateTeam,
    onCreatePaper,
    onCreateJourno,
    onCreateCompany,
    onAdmin,
    onVisitor
}) => {

    /* ===================== STATES ===================== */
    const [tab, setTab] = useState('LOGIN');
    const [subTab, setSubTab] = useState('TEAM');

    const [f, setF] = useState({ n: '', b: '10000000', s: 'A', p: '' });
    const [fc, setFC] = useState({ n: '', owner: '', p: '', type: 'COMERCIO' });

    const [sel, setSel] = useState(null);
    const [selPaper, setSelPaper] = useState(null);
    const [selTeamForPlayer, setSelTeamForPlayer] = useState(null);

    const [lp, setLp] = useState('');

    /* ===================== UPLOAD LOGO ===================== */
    const handleUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onloadend = () => setF({ ...f, l: reader.result });
        reader.readAsDataURL(file);
    };

    /* ===================== INFO EMPRESA ===================== */
    const selectedTypeInfo = COMPANY_TYPES[fc.type] || {};

    /* ===================== RENDER ===================== */
    return (
        <div style={{ minHeight: '100vh', padding: 20, textAlign: 'center' }}>

            {/* ===================== T√çTULO ===================== */}
            <h1 style={{ color: 'var(--primary)' }}>
                Gerenciador de Times<br />
                <span style={{ color: 'white' }}>de Mato Real</span>
            </h1>
            <div className="dev-credits">Desenvolvido por: Nathan Reis | v1.90.5</div>

            {/* ===================== TABS PRINCIPAIS ===================== */}
            <div className="login-tabs">
                <div className={`tab ${tab === 'LOGIN' ? 'active' : ''}`} onClick={() => setTab('LOGIN')}>ENTRAR</div>
                <div className={`tab ${tab === 'CREATE' ? 'active' : ''}`} onClick={() => setTab('CREATE')}>CRIAR TIME</div>
                <div className={`tab ${tab === 'PRESS' ? 'active' : ''}`} onClick={() => setTab('PRESS')}>IMPRENSA</div>
                <div className={`tab ${tab === 'COMPANY' ? 'active' : ''}`} onClick={() => setTab('COMPANY')}>EMPRESAS</div>
            </div>

            {/* ===================== LOGIN ===================== */}
            {tab === 'LOGIN' && (
                <div>

                    {/* SUBTABS */}
                    <div style={{ marginBottom: 15, display: 'flex', gap: 10, justifyContent: 'center' }}>
                        <button className={`btn ${subTab === 'TEAM' ? 'btn-green' : 'btn-ghost'}`} onClick={() => setSubTab('TEAM')}>TIMES</button>
                        <button className={`btn ${subTab === 'PLAYER' ? 'btn-blue' : 'btn-ghost'}`} onClick={() => { setSubTab('PLAYER'); setSelTeamForPlayer(null); }}>JOGADORES</button>
                        <button className={`btn ${subTab === 'COMPANY' ? 'btn-purple' : 'btn-ghost'}`} onClick={() => setSubTab('COMPANY')}>EMPRESAS</button>
                    </div>

                    {/* LOGIN TIMES */}
                    {subTab === 'TEAM' &&
                        (teams || []).filter(t => t.status !== 'PENDING').map(t => (
                            <div key={t.id} className="card" onClick={() => setSel({ ...t, type: 'TEAM' })}>
                                <b>{t.name}</b><br />
                                <small>S√©rie {t.serie}</small>
                            </div>
                        ))
                    }

                    {/* LOGIN JOGADOR - SELE√á√ÉO DO TIME */}
                    {subTab === 'PLAYER' && !selTeamForPlayer && (
                        <div>
                            <p style={{ color: '#aaa' }}>Selecione o clube onde voc√™ joga:</p>
                            {(teams || []).filter(t => t.status !== 'PENDING').map(t => (
                                <div key={t.id} className="card" onClick={() => setSelTeamForPlayer(t)}>
                                    <b>{t.name}</b>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* LOGIN JOGADOR - ELENCO */}
                    {subTab === 'PLAYER' && selTeamForPlayer && (
                        <div>
                            <button className="btn" style={{ background: '#333', marginBottom: 10 }} onClick={() => setSelTeamForPlayer(null)}>‚¨Ö VOLTAR</button>
                            {(players || []).filter(p => p.teamId === selTeamForPlayer.id).map(p => (
                                <div key={p.id} className="card" onClick={() => setSel({ ...p, type: 'PLAYER' })}>
                                    üëü {p.name}
                                </div>
                            ))}
                        </div>
                    )}

                    {/* LOGIN EMPRESA */}
                    {subTab === 'COMPANY' &&
                        (companies || []).filter(c => c.status !== 'PENDING').map(c => (
                            <div key={c.id} className="card" onClick={() => setSel({ ...c, type: 'COMPANY' })}>
                                üè¢ {c.name}
                            </div>
                        ))
                    }

                    {/* VISITANTE / ADMIN */}
                    <div style={{ marginTop: 20 }}>
                        <button className="btn btn-blue" onClick={onVisitor}>ENTRAR COMO VISITANTE</button>
                        <button className="btn btn-ghost" onClick={() => { if (prompt("Senha:") === '2503') onAdmin(); }}>ADMIN</button>
                    </div>

                </div>
            )}

            {/* ===================== CRIAR TIME ===================== */}
            {tab === 'CREATE' && (
                <div>
                    <input type="file" className="file-input" onChange={handleUpload} />
                    <input className="input-field" placeholder="Nome" value={f.n} onChange={e => setF({ ...f, n: e.target.value })} />
                    <input className="input-field" type="number" placeholder="Saldo" value={f.b} onChange={e => setF({ ...f, b: e.target.value })} />
                    <select className="input-field" value={f.s} onChange={e => setF({ ...f, s: e.target.value })}>
                        {['A', 'B', 'C', 'D'].map(s => <option key={s}>S√©rie {s}</option>)}
                    </select>
                    <input className="input-field" type="number" placeholder="Senha" value={f.p} onChange={e => setF({ ...f, p: e.target.value })} />
                    <button className="btn btn-green" onClick={() => onCreateTeam(f.n, f.b, f.s, f.p, f.l)}>CRIAR</button>
                </div>
            )}

            {/* ===================== MODAL LOGIN ===================== */}
            {sel && (
                <div className="modal-overlay">
                    <div className="modal-content">
                        <h3>{sel.name}</h3>
                        <input className="input-field" type="password" placeholder="Senha" value={lp} onChange={e => setLp(e.target.value)} />
                        <button className="btn btn-green" onClick={() => onLogin(sel.id, lp, sel.type)}>ENTRAR</button>
                        <button className="btn" onClick={() => setSel(null)}>CANCELAR</button>
                    </div>
                </div>
            )}

        </div>
    );
};

/* ===================== FIM DO COMPONENTE LoginScreen ===================== */




        /* ----------------------------------------------------------------------
   COMPONENTE: VisitorDashboard
   Painel p√∫blico (visitante)
   - Mostra artilheiro da temporada
   - Mostra l√≠der em assist√™ncias
   - N√£o altera o array original de jogadores
---------------------------------------------------------------------- */
const VisitorDashboard = ({ players = [], teams }) => {

    // Evita modificar o array original
    const sortedByGoals = [...players].sort(
        (a, b) => (b.stats?.goals || 0) - (a.stats?.goals || 0)
    );

    const sortedByAssists = [...players].sort(
        (a, b) => (b.stats?.assists || 0) - (a.stats?.assists || 0)
    );

    const topScorer = sortedByGoals[0];
    const topAssist = sortedByAssists[0];

    return (
        <div>

            <div className="highlight-card">
                <h2 style={{ margin: 0, color: 'var(--primary)' }}>
                    Jornal do Dia
                </h2>
                <small>Resumo da Temporada</small>

                <div style={{ marginTop: 15, textAlign: 'left' }}>

                    <div style={{ marginBottom: 10 }}>
                        <span style={{ color: '#aaa', fontSize: 10, textTransform: 'uppercase' }}>
                            Artilheiro
                        </span>

                        <div style={{ fontWeight: 'bold', fontSize: 16 }}>
                            ‚öΩ {topScorer?.name || 'Ningu√©m'}{' '}
                            <span style={{ color: 'var(--primary)' }}>
                                {topScorer?.stats?.goals || 0} Gols
                            </span>
                        </div>
                    </div>

                    <div>
                        <span style={{ color: '#aaa', fontSize: 10, textTransform: 'uppercase' }}>
                            Rei das Assist√™ncias
                        </span>

                        <div style={{ fontWeight: 'bold', fontSize: 16 }}>
                            üëü {topAssist?.name || 'Ningu√©m'}{' '}
                            <span style={{ color: 'var(--secondary)' }}>
                                {topAssist?.stats?.assists || 0} Assis
                            </span>
                        </div>
                    </div>

                </div>
            </div>

            <div style={{ textAlign: 'center', color: '#666' }}>
                Use o menu abaixo para navegar.
            </div>

        </div>
    );
};
/* ====================== FIM BLOCO VISITOR DASHBOARD ====================== */


        /* ======================================================================
   COMPONENTE: CompanyDashboard
   Painel da Empresa
   - Gerenciamento de produtos
   - Finan√ßas e hist√≥rico de vendas
   - Patroc√≠nios (solicita√ß√µes e contratos ativos)
====================================================================== */

const CompanyDashboard = ({
    company,
    products,
    sps,
    sales,
    teams,
    onSaveProd,
    onDeleteProd,
    onProcessSpons
}) => {

    const [tab, setTab] = useState('PRODS');
    const [editP, setEditP] = useState(null);

    return (
        <div>

            {/* ABAS */}
            <div style={{ display: 'flex', gap: 10, marginBottom: 15 }}>
                <button
                    className={`btn ${tab === 'PRODS' ? 'btn-purple' : 'btn-ghost'}`}
                    onClick={() => setTab('PRODS')}
                >
                    PRODUTOS
                </button>

                <button
                    className={`btn ${tab === 'FIN' ? 'btn-purple' : 'btn-ghost'}`}
                    onClick={() => setTab('FIN')}
                >
                    FINAN√áAS
                </button>
            </div>

            {/* ================= PRODUTOS ================= */}
            {tab === 'PRODS' && (
                <div>

                    <button
                        className="btn btn-green"
                        onClick={() =>
                            setEditP({ name: '', price: '', img: '', desc: '', cat: 'CHUTEIRA' })
                        }
                    >
                        + NOVO PRODUTO
                    </button>

                    {products.map(p => (
                        <div
                            key={p.id}
                            className="card"
                            style={{ display: 'flex', gap: 10, textAlign: 'left' }}
                        >
                            <img
                                src={p.img || 'https://via.placeholder.com/100'}
                                style={{
                                    width: 80,
                                    height: 80,
                                    objectFit: 'cover',
                                    borderRadius: 6
                                }}
                            />

                            <div style={{ flex: 1 }}>
                                <span
                                    style={{
                                        fontSize: 10,
                                        background: '#333',
                                        padding: '2px 6px',
                                        borderRadius: 4,
                                        color: '#aaa'
                                    }}
                                >
                                    {PROD_CATS[p.cat] || p.cat}
                                </span>

                                <div style={{ fontWeight: 'bold', marginTop: 2 }}>
                                    {p.name}
                                </div>

                                <span style={{ color: 'var(--primary)', fontWeight: 'bold' }}>
                                    {fmt(p.price)}
                                </span>

                                <p style={{ fontSize: 11, color: '#aaa', margin: '5px 0' }}>
                                    {p.desc}
                                </p>
                            </div>

                            <div style={{ display: 'flex', flexDirection: 'column', gap: 5 }}>
                                <button
                                    className="btn btn-blue"
                                    style={{ width: 'auto', padding: '5px 10px' }}
                                    onClick={() => setEditP(p)}
                                >
                                    ‚úèÔ∏è
                                </button>

                                <button
                                    className="btn btn-red"
                                    style={{ width: 'auto', padding: '5px 10px' }}
                                    onClick={() => onDeleteProd(p.id)}
                                >
                                    X
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            )}

            {/* ================= FINAN√áAS ================= */}
            {tab === 'FIN' && (
                <div>

                    <div className="highlight-card">
                        <h3>Saldo: {fmt(company.balance)}</h3>
                        <small>
                            Imposto Semanal:{' '}
                            {fmt((COMPANY_TYPES[company.companyType] || {}).tax || 0)}
                        </small>
                    </div>

                    <h4 style={{ marginTop: 20, color: '#ddd' }}>
                        Hist√≥rico de Vendas
                    </h4>

                    <div
                        style={{
                            maxHeight: 200,
                            overflowY: 'auto',
                            background: 'rgba(0,0,0,0.3)',
                            padding: 10,
                            borderRadius: 8,
                            marginBottom: 15,
                            border: '1px solid #333'
                        }}
                    >
                        {(!sales || sales.filter(s => s.companyId === company.id).length === 0) && (
                            <p
                                style={{
                                    color: '#666',
                                    textAlign: 'center',
                                    fontSize: 11,
                                    margin: 0
                                }}
                            >
                                Nenhuma venda recente.
                            </p>
                        )}

                        {(sales || [])
                            .filter(s => s.companyId === company.id)
                            .map((s, i) => (
                                <div
                                    key={i}
                                    style={{
                                        borderBottom: '1px solid #444',
                                        padding: '8px 0',
                                        fontSize: 11,
                                        textAlign: 'left'
                                    }}
                                >
                                    <div
                                        style={{
                                            display: 'flex',
                                            justifyContent: 'space-between'
                                        }}
                                    >
                                        <b style={{ color: 'var(--primary)' }}>
                                            + {fmt(s.price)}
                                        </b>
                                        <span style={{ color: '#888' }}>
                                            {new Date(s.date).toLocaleDateString()}
                                        </span>
                                    </div>

                                    <div style={{ marginTop: 2 }}>
                                        üë§ <b>{s.buyerName}</b> comprou 1x{' '}
                                        <span style={{ color: 'var(--purple)' }}>
                                            {s.productName}
                                        </span>
                                    </div>
                                </div>
                            ))}
                    </div>

                    <h4>Solicita√ß√µes</h4>

                    {sps.filter(s => s.status === 'PENDING').length === 0 && (
                        <p style={{ color: '#666' }}>Nenhuma.</p>
                    )}

                    {sps
                        .filter(s => s.status === 'PENDING')
                        .map(s => (
                            <div key={s.id} className="card">
                                <b>{s.teamName}</b> pede patroc√≠nio.
                                <br />
                                Valor:{' '}
                                <span style={{ color: 'var(--warning)' }}>
                                    {fmt(s.value)}
                                </span>

                                <div style={{ display: 'flex', gap: 5, marginTop: 5 }}>
                                    <button
                                        className="btn btn-green"
                                        onClick={() => onProcessSpons(s, 'ACTIVE')}
                                    >
                                        ACEITAR
                                    </button>
                                    <button
                                        className="btn btn-red"
                                        onClick={() => onProcessSpons(s, 'REJECTED')}
                                    >
                                        RECUSAR
                                    </button>
                                </div>
                            </div>
                        ))}

                    <h4>Contratos Ativos</h4>

                    {sps.filter(s => s.status === 'ACTIVE').length === 0 && (
                        <p style={{ color: '#666' }}>Nenhum.</p>
                    )}

                    {sps
                        .filter(s => s.status === 'ACTIVE')
                        .map(s => (
                            <div
                                key={s.id}
                                className="card"
                                style={{ borderLeft: '4px solid var(--primary)' }}
                            >
                                <b>{s.teamName}</b>
                                <br />
                                Pagamento: {fmt(s.value)}

                                <button
                                    className="btn btn-red"
                                    style={{ marginTop: 5 }}
                                    onClick={() => onProcessSpons(s, 'CANCELLED')}
                                >
                                    CANCELAR
                                </button>
                            </div>
                        ))}
                </div>
            )}

            {/* ================= MODAL PRODUTO ================= */}
            {editP && (
                <div className="modal-overlay">
                    <div className="modal-content">

                        <h3>{editP.id ? 'Editar' : 'Novo'} Produto</h3>

                        <label>Categoria</label>
                        <select
                            className="input-field"
                            value={editP.cat || 'CHUTEIRA'}
                            onChange={e =>
                                setEditP({ ...editP, cat: e.target.value })
                            }
                        >
                            {Object.keys(PROD_CATS).map(key => (
                                <option key={key} value={key}>
                                    {PROD_CATS[key]}
                                </option>
                            ))}
                        </select>

                        <label>Nome</label>
                        <input
                            className="input-field"
                            value={editP.name}
                            onChange={e =>
                                setEditP({ ...editP, name: e.target.value })
                            }
                        />

                        <label>Pre√ßo</label>
                        <input
                            className="input-field"
                            type="number"
                            value={editP.price}
                            onChange={e =>
                                setEditP({ ...editP, price: e.target.value })
                            }
                        />

                        <label>Imagem URL</label>
                        <input
                            className="input-field"
                            value={editP.img}
                            onChange={e =>
                                setEditP({ ...editP, img: e.target.value })
                            }
                        />

                        <label>Descri√ß√£o</label>
                        <textarea
                            className="input-field"
                            value={editP.desc}
                            onChange={e =>
                                setEditP({ ...editP, desc: e.target.value })
                            }
                        />

                        <div style={{ display: 'flex', gap: 10 }}>
                            <button
                                className="btn btn-green"
                                onClick={() => {
                                    onSaveProd(editP);
                                    setEditP(null);
                                }}
                            >
                                SALVAR
                            </button>

                            <button
                                className="btn"
                                onClick={() => setEditP(null)}
                            >
                                CANCELAR
                            </button>
                        </div>

                    </div>
                </div>
            )}

        </div>
    );
};

/* ====================== FIM BLOCO COMPANY DASHBOARD ====================== */




        /* ======================================================================
   COMPONENTE: ShoppingScreen
   Shopping Global
   - Lista produtos de empresas ativas
   - Busca por nome
   - Compra de produtos pelo time do usu√°rio
====================================================================== */

const ShoppingScreen = ({ products, companies, userTeam, onBuy }) => {

    const [term, setTerm] = useState('');

    // Filtro de busca (prote√ß√£o contra undefined)
    const list = (products || []).filter(p =>
        p.name.toLowerCase().includes(term.toLowerCase())
    );

    return (
        <div>

            <h3>Shopping Global</h3>

            <input
                className="input-field"
                placeholder="Buscar produto..."
                value={term}
                onChange={e => setTerm(e.target.value)}
            />

            <div
                style={{
                    display: 'grid',
                    gridTemplateColumns: '1fr 1fr',
                    gap: 10
                }}
            >
                {list.map(p => {

                    const comp = companies.find(c => c.id === p.companyId);

                    // S√≥ exibe produtos de empresas ativas
                    if (comp?.status !== 'ACTIVE') return null;

                    return (
                        <div
                            key={p.id}
                            className="card"
                            style={{ padding: 10, position: 'relative' }}
                        >
                            {/* Nome da Empresa */}
                            <div
                                style={{
                                    fontSize: 9,
                                    background: 'var(--purple)',
                                    position: 'absolute',
                                    top: 5,
                                    right: 5,
                                    padding: '2px 5px',
                                    borderRadius: 4,
                                    zIndex: 10
                                }}
                            >
                                {comp.name}
                            </div>

                            <img
                                src={p.img || 'https://via.placeholder.com/100'}
                                className="prod-img"
                                style={{
                                    width: '100%',
                                    height: 100,
                                    objectFit: 'cover',
                                    borderRadius: 4
                                }}
                            />

                            {/* Categoria */}
                            <span
                                style={{
                                    fontSize: 9,
                                    color: '#888',
                                    display: 'block',
                                    marginTop: 5
                                }}
                            >
                                {PROD_CATS[p.cat] || 'Item'}
                            </span>

                            <div
                                style={{
                                    fontWeight: 'bold',
                                    fontSize: 13,
                                    lineHeight: '1.2em'
                                }}
                            >
                                {p.name}
                            </div>

                            <div
                                style={{
                                    color: 'var(--primary)',
                                    fontWeight: 900,
                                    fontSize: 14
                                }}
                            >
                                {fmt(p.price)}
                            </div>

                            {userTeam && (
                                <button
                                    className="btn btn-green"
                                    style={{ marginTop: 5, fontSize: 10 }}
                                    onClick={() => onBuy(p, comp)}
                                >
                                    COMPRAR
                                </button>
                            )}
                        </div>
                    );
                })}
            </div>

            {list.length === 0 && (
                <p style={{ textAlign: 'center', color: '#666' }}>
                    Nenhum produto encontrado.
                </p>
            )}

        </div>
    );
};

/* ====================== FIM BLOCO SHOPPING SCREEN ====================== */




      /* ======================================================================
   COMPONENTE: TeamDashboard
   Painel do Time
   - Lista elenco do time
   - Calcula folha salarial automaticamente
   - Exibe atributos, contrato e estat√≠sticas
   - Permite editar/adicionar jogadores (se n√£o for visitante)
====================================================================== */

const TeamDashboard = ({ team, players = [], isVisitor, onEdit, onAdd }) => {

    // ---------------- FOLHA SALARIAL ----------------
    // Soma autom√°tica dos sal√°rios dos jogadores
    const payroll = players.reduce(
        (total, p) => total + (parseFloat(p.salary) || 0),
        0
    );
    // ------------------------------------------------

    return (
        <div>

            {/* CABE√áALHO */}
            <div
                style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    marginBottom: 15
                }}
            >
                <div>
                    <h3 style={{ margin: 0 }}>
                        Elenco ({players.length})
                    </h3>

                    {/* Folha salarial */}
                    <small style={{ color: '#ccc' }}>
                        Folha:{' '}
                        <span
                            style={{
                                color: 'var(--danger)',
                                fontWeight: 'bold'
                            }}
                        >
                            {fmt(payroll)}
                        </span>
                        /sem
                    </small>
                </div>

                {!isVisitor && (
                    <button
                        className="btn btn-green"
                        style={{ width: 'auto', padding: '5px 15px' }}
                        onClick={onAdd}
                    >
                        + JOGADOR
                    </button>
                )}
            </div>

            {/* LISTA VAZIA */}
            {players.length === 0 && (
                <p style={{ color: '#666', textAlign: 'center' }}>
                    Nenhum jogador contratado.
                </p>
            )}

            {/* LISTA DE JOGADORES */}
            {[...players]
                .sort((a, b) => b.overall - a.overall)
                .map(p => (
                    <div
                        key={p.id}
                        className="card"
                        onClick={() => !isVisitor && onEdit(p)}
                        style={{
                            cursor: isVisitor ? 'default' : 'pointer'
                        }}
                    >
                        {/* LINHA SUPERIOR */}
                        <div
                            style={{
                                display: 'flex',
                                justifyContent: 'space-between'
                            }}
                        >
                            <div>
                                <span
                                    className="badge-pos"
                                    style={{
                                        background: getPosColor(p.position)
                                    }}
                                >
                                    {p.position}
                                </span>

                                <b>{p.name}</b>

                                {p.rating > 0 && (
                                    <span className="rating-badge">
                                        ‚òÖ {p.rating}
                                    </span>
                                )}
                            </div>

                            <span className="player-ov">
                                {p.overall}
                            </span>
                        </div>

                        {/* DADOS FINANCEIROS */}
                        <div
                            style={{
                                display: 'grid',
                                gridTemplateColumns: '1fr 1fr',
                                fontSize: 11,
                                color: '#aaa',
                                marginTop: 5
                            }}
                        >
                            <div>Sal: {fmt(p.salary)}</div>
                            <div>Val: {fmt(p.value)}</div>
                            <div>Con: {p.contract}</div>
                            <div>Mul: {fmt(p.clause)}</div>
                        </div>

                        {/* ESTAT√çSTICAS */}
                        <div className="stats-grid">
                            <div className="stat-item">
                                <span className="stat-lbl">‚öΩ</span>
                                <span className="stat-val">
                                    {p.stats?.goals || 0}
                                </span>
                            </div>
                            <div className="stat-item">
                                <span className="stat-lbl">üëü</span>
                                <span className="stat-val">
                                    {p.stats?.assists || 0}
                                </span>
                            </div>
                            <div className="stat-item">
                                <span className="stat-lbl">üõ°Ô∏è</span>
                                <span className="stat-val">
                                    {p.stats?.tackles || 0}
                                </span>
                            </div>
                            <div className="stat-item">
                                <span className="stat-lbl">üß§</span>
                                <span className="stat-val">
                                    {p.stats?.saves || 0}
                                </span>
                            </div>
                            <div className="stat-item">
                                <span className="stat-lbl">üü®</span>
                                <span className="stat-val">
                                    {p.stats?.yellows || 0}
                                </span>
                            </div>
                            <div className="stat-item">
                                <span className="stat-lbl">üü•</span>
                                <span className="stat-val">
                                    {p.stats?.reds || 0}
                                </span>
                            </div>
                        </div>
                    </div>
                ))}
        </div>
    );
};

/* ====================== FIM BLOCO TEAM DASHBOARD ====================== */




       const StatsEditor = ({ players, teams, onSave }) => {
    const [search, setSearch] = useState('');
    const [selectedPlayer, setSelectedPlayer] = useState(null);
    const [stats, setStats] = useState({
        goals: 0,
        assists: 0,
        tackles: 0,
        saves: 0,
        yellows: 0,
        reds: 0
    });

    const filteredPlayers = players.filter(p =>
        p.name.toLowerCase().includes(search.toLowerCase())
    );

    // ===== TELA DE EDI√á√ÉO =====
    if (selectedPlayer) {
        return (
            <div>
                <h3>Editando: {selectedPlayer.name}</h3>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10 }}>
                    <div>
                        <label>Gols</label>
                        <input
                            className="input-field"
                            type="number"
                            value={stats.goals}
                            onChange={e => setStats({ ...stats, goals: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div>
                        <label>Assist√™ncias</label>
                        <input
                            className="input-field"
                            type="number"
                            value={stats.assists}
                            onChange={e => setStats({ ...stats, assists: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div>
                        <label>Desarmes</label>
                        <input
                            className="input-field"
                            type="number"
                            value={stats.tackles}
                            onChange={e => setStats({ ...stats, tackles: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div>
                        <label>Defesas</label>
                        <input
                            className="input-field"
                            type="number"
                            value={stats.saves}
                            onChange={e => setStats({ ...stats, saves: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div>
                        <label>Amarelos</label>
                        <input
                            className="input-field"
                            type="number"
                            value={stats.yellows}
                            onChange={e => setStats({ ...stats, yellows: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div>
                        <label>Vermelhos</label>
                        <input
                            className="input-field"
                            type="number"
                            value={stats.reds}
                            onChange={e => setStats({ ...stats, reds: parseInt(e.target.value) || 0 })}
                        />
                    </div>
                </div>

                <button
                    className="btn btn-green"
                    onClick={() => onSave(selectedPlayer.id, stats)}
                >
                    SALVAR ESTAT√çSTICAS
                </button>

                <button className="btn" onClick={() => setSelectedPlayer(null)}>
                    VOLTAR
                </button>
            </div>
        );
    }

    // ===== LISTA DE JOGADORES =====
    return (
        <div>
            <input
                className="input-field"
                placeholder="Buscar jogador..."
                value={search}
                onChange={e => setSearch(e.target.value)}
            />

            <div style={{ maxHeight: 300, overflowY: 'auto' }}>
                {search.length > 0 &&
                    filteredPlayers.map(p => (
                        <div
                            key={p.id}
                            className="card"
                            onClick={() => {
                                setSelectedPlayer(p);
                                setStats(p.stats || {
                                    goals: 0,
                                    assists: 0,
                                    tackles: 0,
                                    saves: 0,
                                    yellows: 0,
                                    reds: 0
                                });
                            }}
                        >
                            <b>{p.name}</b>{' '}
                            <small>
                                ({teams.find(t => t.id === p.teamId)?.name})
                            </small>
                        </div>
                    ))}
            </div>
        </div>
    );
};
// ===== fim



        // =========================
// COMPONENTE: PlayerForm
// IN√çCIO DO PlayerForm
// =========================

const PlayerForm = ({
    initial,
    onSave,
    onDelete,
    isAdmin,
    teams,
    onRenew,
    isOwner
}) => {

    const [f, setF] = useState(
        initial || {
            name: '',
            position: 'ATA',
            overall: '',
            value: '',
            salary: '',
            clause: '',
            contract: '',
            mood: 'üòê',
            status: 'NAO_A_VENDA',
            password: '',
            balance: 0,
            rating: '',
            stats: {
                goals: 0,
                assists: 0,
                tackles: 0,
                saves: 0,
                yellows: 0,
                reds: 0
            }
        }
    );

    return (
        <div>
            <div className="modal-bg">
                <div className="modal-content">

                    <h3>{initial ? 'Editar Jogador' : 'Novo Jogador'}</h3>

                    {/* NOME */}
                    <label>Nome</label>
                    <input
                        className="input-field"
                        value={f.name}
                        onChange={e => setF({ ...f, name: e.target.value })}
                    />

                    {/* SENHA */}
                    <div style={{
                        background: 'rgba(255,255,255,0.05)',
                        padding: 10,
                        borderRadius: 5,
                        marginBottom: 10,
                        border: '1px solid #444'
                    }}>
                        <label style={{ color: 'var(--secondary)' }}>üîê Senha de Acesso</label>
                        <input
                            className="input-field"
                            value={f.password || ''}
                            onChange={e => setF({ ...f, password: e.target.value })}
                        />
                    </div>

                    {/* SALDO ADMIN */}
                    {isAdmin && (
                        <div style={{
                            border: '1px solid var(--primary)',
                            padding: 8,
                            borderRadius: 5,
                            marginBottom: 10
                        }}>
                            <label style={{ color: 'var(--primary)' }}>üí∞ Saldo (Admin)</label>
                            <input
                                className="input-field"
                                type="number"
                                value={f.balance || 0}
                                onChange={e => setF({ ...f, balance: e.target.value })}
                            />
                        </div>
                    )}

                    {/* POSI√á√ÉO / OVERALL */}
                    <div style={{ display: 'flex', gap: 5 }}>
                        <div style={{ flex: 1 }}>
                            <label>Posi√ß√£o</label>
                            <select
                                className="input-field"
                                value={f.position}
                                onChange={e => setF({ ...f, position: e.target.value })}
                            >
                                {POS.map(p => (
                                    <option key={p} value={p}>{p}</option>
                                ))}
                            </select>
                        </div>

                        <div style={{ flex: 1 }}>
                            <label>Overall</label>
                            <input
                                className="input-field"
                                type="number"
                                value={f.overall}
                                onChange={e => setF({ ...f, overall: e.target.value })}
                                disabled={!isAdmin && initial}
                            />
                        </div>
                    </div>

                    {/* VALOR / SAL√ÅRIO */}
                    <div style={{ display: 'flex', gap: 5 }}>
                        <div style={{ flex: 1 }}>
                            <label>Valor</label>
                            <input
                                className="input-field"
                                type="number"
                                value={f.value}
                                onChange={e => setF({ ...f, value: e.target.value })}
                            />
                        </div>

                        <div style={{ flex: 1 }}>
                            <label>Sal√°rio</label>
                            <input
                                className="input-field"
                                type="number"
                                value={f.salary}
                                onChange={e => setF({ ...f, salary: e.target.value })}
                            />
                        </div>
                    </div>

                    {/* MULTA / CONTRATO */}
                    <div style={{ display: 'flex', gap: 5 }}>
                        <div style={{ flex: 1 }}>
                            <label>Multa</label>
                            <input
                                className="input-field"
                                type="number"
                                value={f.clause}
                                onChange={e => setF({ ...f, clause: e.target.value })}
                            />
                        </div>

                        <div style={{ flex: 1 }}>
                            <label>Contrato</label>
                            <input
                                className="input-field"
                                type="number"
                                value={f.contract}
                                onChange={e => setF({ ...f, contract: e.target.value })}
                            />
                        </div>
                    </div>

                    {/* STATUS / HUMOR */}
                    <label>Status</label>
                    <select
                        className="input-field"
                        value={f.status}
                        onChange={e => setF({ ...f, status: e.target.value })}
                    >
                        <option value="NAO_A_VENDA">N√£o listado</option>
                        <option value="VENDA">√Ä venda</option>
                        <option value="EMPRESTIMO">Empr√©stimo</option>
                        <option value="INTRANSFERIVEL">Bloqueado</option>
                    </select>

                    <label>Humor</label>
                    <select
                        className="input-field"
                        value={f.mood}
                        onChange={e => setF({ ...f, mood: e.target.value })}
                    >
                        <option>ü§©</option>
                        <option>üòê</option>
                        <option>üò°</option>
                    </select>

                    {/* BOT√ïES */}
                    <div style={{ display: 'flex', gap: 10, marginTop: 15 }}>
                        <button className="btn btn-green" onClick={() => onSave(f)}>SALVAR</button>
                        {isOwner && <button className="btn btn-blue" onClick={() => onRenew(initial)}>RENOVAR</button>}
                        {initial && <button className="btn btn-red" onClick={() => onDelete(initial.id)}>X</button>}
                        <button className="btn" onClick={() => setF(null)}>CANCELAR</button>
                    </div>

                </div>
            </div>
        </div>
    );
};

// =========================
// FIM DO PlayerForm
// =========================




        // =========================
// COMPONENTE: Market
// IN√çCIO DO Market
// =========================

const Market = ({
    me,
    teams,
    players,
    open,
    isVis,
    onNeg,
    onPayClause,
    onPre
}) => {

    const [view, setView] = useState('MENU');
    const [serie, setSerie] = useState('A');
    const [selT, setSelT] = useState(null);
    const [filt, setFilt] = useState('VENDA');

    // ===== MENU PRINCIPAL =====
    if (view === 'MENU') {
        return (
            <div>
                <h3>Mercado {open ? 'üü¢' : 'üî¥'}</h3>

                <div style={{ display: 'flex', gap: 10 }}>
                    <div
                        className="card"
                        style={{ flex: 1, textAlign: 'center', cursor: 'pointer', border: '1px solid var(--primary)' }}
                        onClick={() => { setFilt('VENDA'); setView('GLOBAL'); }}
                    >
                        üõí VENDA
                    </div>

                    <div
                        className="card"
                        style={{ flex: 1, textAlign: 'center', cursor: 'pointer', border: '1px solid var(--secondary)' }}
                        onClick={() => { setFilt('EMPRESTIMO'); setView('GLOBAL'); }}
                    >
                        üîÑ EMP
                    </div>
                </div>

                <h4>S√©ries</h4>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10 }}>
                    {SERIES.map(s => (
                        <div
                            key={s}
                            className="card"
                            style={{ textAlign: 'center', cursor: 'pointer' }}
                            onClick={() => { setSerie(s); setView('LIST'); }}
                        >
                            <b>S√©rie {s}</b>
                        </div>
                    ))}
                </div>
            </div>
        );
    }

    // ===== LISTA DE JOGADORES =====
    let list = [];

    if (view === 'GLOBAL') {
        list = players
            .filter(p => p.status === filt && p.teamId !== me)
            .sort((a, b) => b.overall - a.overall);
    }

    if (view === 'TEAM') {
        list = players
            .filter(p => p.teamId === selT.id)
            .sort((a, b) => b.overall - a.overall);
    }

    // ===== LISTA DE CLUBES =====
    if (view === 'LIST') {
        return (
            <div>
                <button className="btn" onClick={() => setView('MENU')}>Voltar</button>
                <h3>Clubes S√©rie {serie}</h3>

                {teams
                    .filter(t => t.serie === serie && t.status !== 'PENDING')
                    .map(t => (
                        <div
                            key={t.id}
                            className="card"
                            onClick={() => { setSelT(t); setView('TEAM'); }}
                            style={{ display: 'flex', alignItems: 'center', gap: 10, cursor: 'pointer' }}
                        >
                            {t.logo
                                ? <img src={t.logo} style={{ width: 30, height: 30, borderRadius: '50%', objectFit: 'cover' }} />
                                : <div style={{ width: 30 }}></div>
                            }
                            <b>{t.name}</b>
                        </div>
                    ))}
            </div>
        );
    }

    // ===== VIS√ÉO GLOBAL / TIME =====
    return (
        <div>

            <button className="btn" onClick={() => setView('MENU')}>Voltar</button>
            <h3>{view === 'GLOBAL' ? filt : selT?.name}</h3>

            {list.map(p => (
                <div key={p.id} className="card">

                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                        <div>
                            <span className="badge-pos" style={{ background: getPosColor(p.position) }}>
                                {p.position}
                            </span>
                            {p.name}
                            {p.rating > 0 && <span className="rating-badge">‚òÖ {p.rating}</span>}
                        </div>

                        <span className="player-ov">{p.overall}</span>
                    </div>

                    <div style={{ fontSize: 11, color: '#aaa', marginTop: 5 }}>
                        {view === 'GLOBAL' && (
                            <div>Time: {teams.find(t => t.id === p.teamId)?.name}</div>
                        )}
                        <div>Val: {fmt(p.value)} | Con: {p.contract}</div>
                    </div>

                    {/* ESTAT√çSTICAS */}
                    <div className="stats-grid">
                        <div className="stat-item"><span className="stat-lbl">‚öΩ</span><span className="stat-val">{p.stats?.goals || 0}</span></div>
                        <div className="stat-item"><span className="stat-lbl">üëü</span><span className="stat-val">{p.stats?.assists || 0}</span></div>
                        <div className="stat-item"><span className="stat-lbl">üõ°Ô∏è</span><span className="stat-val">{p.stats?.tackles || 0}</span></div>
                        <div className="stat-item"><span className="stat-lbl">üß§</span><span className="stat-val">{p.stats?.saves || 0}</span></div>
                        <div className="stat-item"><span className="stat-lbl">üü®</span><span className="stat-val">{p.stats?.yellows || 0}</span></div>
                        <div className="stat-item"><span className="stat-lbl">üü•</span><span className="stat-val">{p.stats?.reds || 0}</span></div>
                    </div>

                    {/* A√á√ïES */}
                    {!isVis && (
                        <div style={{ marginTop: 5, display: 'flex', gap: 5 }}>

                            {(open || p.status === 'EMPRESTIMO') && p.status !== 'INTRANSFERIVEL'
                                ? <button className="btn btn-purple" style={{ flex: 1 }} onClick={() => onNeg(p)}>NEGOCIAR</button>
                                : <button className="btn btn-ghost" style={{ flex: 1 }} disabled>BLOQUEADO</button>
                            }

                            {parseFloat(p.clause) > 0 && (
                                <button className="btn btn-gold" onClick={() => onPayClause(p)}>MULTA</button>
                            )}

                            {parseInt(p.contract) === 1 && !p.preContract && (
                                <button className="btn btn-blue" onClick={() => onPre(p)}>PR√â</button>
                            )}
                        </div>
                    )}

                </div>
            ))}

        </div>
    );
};

// =========================
// FIM DO Market
// =========================




        const OfferForm = ({ target, myPlayers, onSend }) => {

            const old = target.oldOffer || {};

            const isCounter = !!old.id;



            // ESTADOS INICIAIS (Blindagem Num√©rica)

            const [t, setT] = useState(old.type || 'COMPRA');

            const [v, setV] = useState(old.value || '');

            const [sal, setSal] = useState(old.meta?.newSalary || target.salary || 0); // CAMPO DE SAL√ÅRIO

            const [con, setCon] = useState(old.offerContract || '1');

            const [role, setRole] = useState(old.meta?.role || 'ROTACAO');

            const [meta, setMeta] = useState(old.meta || { sellOn: 0, installments: 1 });

            const [swaps, setSwaps] = useState(old.swapPlayerIds || []);



            return (

                <div className="modal-bg"><div className="modal-content" style={{maxWidth: '500px'}}>

                    <h3 style={{color:'var(--primary)'}}>{isCounter ? 'Contraproposta' : `Negociar ${target.name}`}</h3>

                    

                    <div style={{borderBottom: '1px solid #444', paddingBottom: 15, marginBottom: 15}}>

                        <label style={{fontSize: '11px', color: 'gold', fontWeight: 'bold'}}>1. ACORDO ENTRE CLUBES</label>

                        <div style={{display:'flex', gap:5, margin:'10px 0'}}>

                            {['COMPRA','EMPRESTIMO','TROCA'].map(x=><button key={x} className={`btn ${t===x?'btn-green':'btn-ghost'}`} onClick={()=>setT(x)} style={{flex: 1}}>{x}</button>)}

                        </div>



                        <label>Taxa de Transfer√™ncia (‚Ç£)</label>

                        <input className="input-field" type="number" value={v} onChange={e=>setV(e.target.value)} />



                        {t === 'COMPRA' && (

                            <div className="card" style={{background: '#222', padding: '10px'}}>

                                <small>üì¶ PARCELAMENTO: <b>{meta.installments}x</b></small>

                                <input type="range" min="1" max="12" value={meta.installments} onChange={e=>setMeta({...meta, installments: parseInt(e.target.value)})} style={{width:'100%'}} />

                                <small style={{display:'block', marginTop:10}}>üìà REVENDA: <b>{meta.sellOn}%</b></small>

                                <input type="range" min="0" max="50" value={meta.sellOn} onChange={e=>setMeta({...meta, sellOn: parseInt(e.target.value)})} style={{width:'100%'}} />

                            </div>

                        )}

                    </div>



                    <div>

                        <label style={{fontSize: '11px', color: 'cyan', fontWeight: 'bold'}}>2. CONTRATO DO JOGADOR</label>

                        <div style={{marginTop: 10}}>

                            <label>Sal√°rio Mensal (‚Ç£)</label>

                            <input className="input-field" type="number" value={sal} onChange={e=>setSal(e.target.value)} />

                        </div>

                        

                        <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:10}}>

                            <div><label>Dura√ß√£o (Anos)</label><input className="input-field" type="number" value={con} onChange={e=>setCon(e.target.value)} /></div>

                            <div><label>Papel no Elenco</label>

                                <select className="input-field" value={role} onChange={e=>setRole(e.target.value)}>

                                    <option value="CRUCIAL">‚≠ê Crucial</option>

                                    <option value="TITULAR">‚úÖ Titular</option>

                                    <option value="ROTACAO">üîÑ Rota√ß√£o</option>

                                    <option value="RESERVA">üí§ Reserva</option>

                                </select>

                            </div>

                        </div>

                    </div>



                    <div style={{display:'flex', gap:10, marginTop:15}}>

                        <button className="btn btn-green" style={{flex: 2}} onClick={() => {

                            // Limpeza de seguran√ßa para evitar erro de campos num√©ricos

                            const finalV = parseFloat(v) || 0;

                            const finalSal = parseFloat(sal) || 0;

                            const finalCon = parseInt(con) || 1;

                            

                            onSend(target, t, finalV, swaps, finalCon, {

                                ...meta, 

                                newSalary: finalSal, 

                                role: role,

                                installments: parseInt(meta.installments) || 1,

                                sellOn: parseInt(meta.sellOn) || 0

                            }, old);

                        }}>

                            {isCounter ? 'ENVIAR CONTRAPROPOSTA' : 'ENVIAR PROPOSTA'}

                        </button>

                        <button className="btn btn-red" style={{flex: 1}} onClick={()=>setModal(null)}>CANCELAR</button>

                    </div>

                </div></div>

            );

        };
//fim


        const AdminPanel = ({ onUpdateCompBal, teams, papers, journalists, companies, reqs, config, onAct, onPost, onApprove, onReject, onEditT, onApproveTeam, onUpdateBal, onDeleteTeam, onConfig, onApprovePaper, onDeletePaper, onDeleteJourno, onRejectPaper, onApproveComp, onDeleteComp }) => (

            <div>

                <h3>Painel Master</h3>

                <div className="card">

                    <button className={`btn ${config.marketOpen?'btn-red':'btn-green'}`} onClick={()=>onAct('MARKET', !config.marketOpen)}>{config.marketOpen?'FECHAR MERCADO':'ABRIR MERCADO'}</button>

                    <button className="btn btn-purple" onClick={()=>onAct('WEEK')}>VIRAR SEMANA (Cobr. Impostos)</button>

                    <button className="btn btn-red" onClick={()=>onAct('SEASON')}>VIRAR TEMPORADA</button>

                    <button className="btn btn-gold" onClick={()=>{ const t=prompt("T√≠tulo"); const b=prompt("Texto"); if(t)onPost(t,b,'admin'); }}>COMUNICADO</button>

                </div>



                {/* CORRE√á√ÉO AQUI: Adicionado ?.label e || 'Desconhecido' para n√£o travar se o tipo n√£o existir */}

                {(companies||[]).some(c=>c.status==='PENDING') && <h4>Empresas Pendentes</h4>}

                {(companies||[]).filter(c=>c.status==='PENDING').map(c => (

                    <div key={c.id} className="card" style={{borderLeft:'4px solid var(--purple)'}}>

                        <b>{c.name}</b> ({(COMPANY_TYPES[c.companyType] || {}).label || 'Tipo Desconhecido'})<br/>

                        Dono: {c.owner}

                        <div style={{display:'flex', gap:5, marginTop:5}}>

                            <button className="btn btn-green" onClick={()=>onApproveComp(c.id)}>APROVAR</button>

                            <button className="btn btn-red" onClick={()=>onDeleteComp(c.id)}>X</button>

                        </div>

                    </div>

                ))}



                <h4>Gest√£o de Empresas</h4>

                {(companies||[]).filter(c=>c.status!=='PENDING').map(c => (

                    <div key={c.id} className="card">

                        <b>{c.name}</b> {c.status==='BLOCKED' && <span style={{color:'red'}}>(BLOQUEADA)</span>}<br/>

                        Saldo: {fmt(c.balance)}

                        <div style={{display:'flex', gap:5, marginTop:5}}>

                            {/* NOVO: Bot√£o de Alterar Saldo */}

                            <button className="btn btn-green" onClick={()=>{

                                const n = prompt("Novo Saldo da Empresa:", c.balance); 

                                if(n !== null) onUpdateCompBal(c.id, n);

                            }}>$</button>

                            

                            <button className="btn btn-red" onClick={()=>onDeleteComp(c.id)}>EXCLUIR</button>

                        </div>

                    </div>

                ))}



                {(teams||[]).some(t=>t.status==='PENDING') && <h4>Times Pendentes</h4>}

                {(teams||[]).filter(t=>t.status==='PENDING').map(t=><div key={t.id} className="card" style={{borderLeft:'4px solid var(--warning)'}}><b>{t.name}</b><div style={{display:'flex', gap:5}}><input className="input-field" style={{marginBottom:0, width:100}} defaultValue={t.balance} id={`bal-${t.id}`} /><button className="btn btn-green" onClick={()=>onApproveTeam(t.id, document.getElementById(`bal-${t.id}`).value)}>V</button><button className="btn btn-red" onClick={()=>onDeleteTeam(t.id)}>X</button></div></div>)}

                

                {(papers||[]).some(p=>p.status==='PENDING') && <h4>Jornais Pendentes</h4>}

                {(papers||[]).filter(p=>p.status==='PENDING').map(p=><div key={p.id} className="card"><b>üì∞ {p.name}</b><br/><small>Dono: {p.ownerName}</small><button className="btn btn-green" onClick={()=>onApprovePaper(p.id)}>APROVAR</button><button className="btn btn-red" style={{marginLeft:5}} onClick={()=>onRejectPaper(p.id)}>X</button></div>)}

                

                <h4>Gest√£o de Imprensa</h4>

                {(papers||[]).filter(p=>p.status==='ACTIVE').map(p=><div key={p.id} className="card" style={{display:'flex', justifyContent:'space-between'}}><span>üì∞ {p.name}</span><button className="btn btn-red" style={{width:'auto'}} onClick={()=>onDeletePaper(p.id)}>X</button></div>)}

                {(journalists||[]).map(j=><div key={j.id} className="card" style={{display:'flex', justifyContent:'space-between'}}><span>‚úíÔ∏è {j.name}</span><button className="btn btn-red" style={{width:'auto'}} onClick={()=>onDeleteJourno(j.id)}>X</button></div>)}

                

                <h4>Solicita√ß√µes Financeiras</h4>

                {(reqs||[]).filter(r=>r.status==='PENDING').map(r=><div key={r.id} className="card"><b>{r.teamName}</b>: {fmt(r.amount)} ({r.type})<br/>{r.details}<br/><button className="btn-green" style={{width:'auto', marginRight:5}} onClick={()=>onApprove(r)}>V</button><button className="btn-red" style={{width:'auto'}} onClick={()=>onReject(r.id)}>X</button></div>)}

                

                <h4>Clubes</h4>

                {(teams||[]).filter(t=>t.status!=='PENDING').map(t=><div key={t.id} className="card" style={{display:'flex', justifyContent:'space-between'}}><span>{t.name}</span><div><button className="btn btn-ghost" style={{width:'auto', marginRight:5}} onClick={()=>onConfig(t)}><i className="fas fa-cog"></i></button><button className="btn btn-green" style={{width:'auto', marginRight:5}} onClick={()=>{const n=prompt("Novo Saldo:", t.balance); if(n)onUpdateBal(t.id, n)}}>$</button><button className="btn btn-purple" style={{width:'auto'}} onClick={()=>onEditT(t)}>ELENCO</button><button className="btn btn-red" style={{width:'auto', marginLeft:5}} onClick={()=>onDeleteTeam(t.id)}><i className="fas fa-trash"></i></button></div></div>)}

            </div>

        );



        const SettingsForm = ({ team, isAdmin, onUp, onUpgrade, onReq, onWithdraw }) => {

            const [form, setF] = useState({name: team.name, logo: team.logo, balance: team.balance, serie: team.serie});

            useEffect(() => { setF({name: team.name, logo: team.logo, balance: team.balance, serie: team.serie}); }, [team]);

            return <div><label>Nome</label><input className="input-field" value={form.name} onChange={e=>setF({...form, name:e.target.value})} /><label>Logo</label><input className="input-field" value={form.logo} onChange={e=>setF({...form, logo:e.target.value})} />{isAdmin && <label>Saldo (ADM)</label>} {isAdmin && <input className="input-field" type="number" value={form.balance} onChange={e=>setF({...form, balance:parseFloat(e.target.value)})} />}{isAdmin && <label>S√©rie (ADM)</label>}{isAdmin && <select className="input-field" value={form.serie} onChange={e=>setF({...form, serie:e.target.value})}>{SERIES.map(s=><option key={s} value={s}>{s}</option>)}</select>}<button className="btn btn-blue" onClick={()=>onUp(form)}>SALVAR</button><hr style={{borderColor:'#444'}}/><p>Est√°dio N√≠vel {team.stadiumLevel||1}</p><button className="btn btn-purple" onClick={onUpgrade}>EVOLUIR (‚Ç£ {fmt(COSTS[team.stadiumLevel]||0).replace('‚Ç£ ','')})</button><hr style={{borderColor:'#444'}}/><button className="btn btn-green" onClick={()=>{const v=prompt("Valor");const m=prompt("Motivo"); if(v)onReq('INJECTION',v,m)}}>PEDIR INJE√á√ÉO</button><button className="btn btn-gold" onClick={()=>{const v=prompt("Valor");const m=prompt("Empresa"); if(v)onReq('SPONSORSHIP',v,m)}}>PEDIR PATROC√çNIO</button><button className="btn btn-red" onClick={()=>{const v=prompt("Valor a retirar:"); if(v){ const m=prompt("Motivo:"); if(m) onWithdraw(v, m); }}}>RETIRAR DINHEIRO</button></div>;

        };
//fim

//alguma outra coisa
        const PlayerDashboard = ({ player, team, sales, onUpdatePassword, onAction }) => {
    const [newPass, setNewPass] = useState('');
    const [tab, setTab] = useState('PERFIL');

    /* =========================
       ITENS COMPRADOS
    ========================= */
    const myItems = (sales || []).filter(
        s => s.buyerName === player.name
    );

    /* =========================
       XP / N√çVEL / ENERGIA
    ========================= */
    const xpNeed = getXPNext(player.overall);
    const future = calcNewLevel(
        player.overall,
        player.xp || 0,
        player.pendingXP || 0
    );

    const diffLvl = future.lvl - player.overall;
    const xpPerc = Math.min(
        100,
        Math.max(0, ((player.xp || 0) / xpNeed) * 100)
    );

    const energy = player.energy !== undefined ? player.energy : 100;

    /* =========================
       CONQUISTAS
    ========================= */
    const getAchievements = () => {
        const list = [];
        const s = player.stats || {};

        if (s.goals >= 1) list.push({ icon: '‚öΩ', name: 'Primeiro Gol', color: '#fff' });
        if (s.goals >= 10) list.push({ icon: 'üî•', name: 'Artilheiro', color: 'gold' });
        if (s.assists >= 10) list.push({ icon: 'üé©', name: 'Maestro', color: 'var(--secondary)' });
        if (s.tackles >= 10) list.push({ icon: 'üß±', name: 'Pared√£o', color: '#aaa' });
        if (player.overall >= 80) list.push({ icon: '‚≠ê', name: 'Craque', color: 'var(--purple)' });

        return list;
    };

    const badges = getAchievements();

    return (
        <div>
            {/* =========================
               CABE√áALHO
            ========================= */}
            <div
                className="highlight-card"
                style={{ textAlign: 'center', paddingBottom: 30, position: 'relative' }}
            >
                <h2 style={{ margin: 0 }}>
                    {player.name}{' '}
                    <span style={{ fontSize: 14 }}>{player.mood}</span>
                </h2>

                <small style={{ color: '#ccc' }}>
                    {team?.name || 'Agente Livre'}
                </small>

                <div
                    style={{
                        display: 'flex',
                        justifyContent: 'center',
                        gap: 30,
                        marginTop: 15
                    }}
                >
                    <div style={{ textAlign: 'center' }}>
                        <div
                            style={{
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: 5
                            }}
                        >
                            <div
                                style={{
                                    fontSize: 40,
                                    fontWeight: 900,
                                    color: 'var(--warning)',
                                    lineHeight: 1
                                }}
                            >
                                {player.overall}
                            </div>

                            {diffLvl !== 0 && (
                                <span
                                    style={{
                                        fontSize: 16,
                                        fontWeight: 'bold',
                                        color: diffLvl > 0 ? '#00E676' : '#FF1744',
                                        animation: 'pulse 1.5s infinite'
                                    }}
                                >
                                    {diffLvl > 0 ? '+' : ''}
                                    {diffLvl}
                                </span>
                            )}
                        </div>

                        <span style={{ fontSize: 10, textTransform: 'uppercase', color: '#888' }}>
                            N√≠vel Atual
                        </span>
                    </div>

                    <div style={{ textAlign: 'center' }}>
                        <div
                            style={{
                                fontSize: 40,
                                fontWeight: 900,
                                color: energy > 50 ? 'var(--primary)' : 'var(--danger)',
                                lineHeight: 1
                            }}
                        >
                            {energy}%
                        </div>

                        <span style={{ fontSize: 10, textTransform: 'uppercase', color: '#888' }}>
                            Energia
                        </span>
                    </div>
                </div>

                {/* Barra XP */}
                <div
                    style={{
                        position: 'absolute',
                        bottom: 0,
                        left: 0,
                        right: 0,
                        height: 8,
                        background: '#333'
                    }}
                >
                    <div
                        style={{
                            width: `${xpPerc}%`,
                            height: '100%',
                            background: 'linear-gradient(90deg, var(--warning), gold)',
                            transition: '1s'
                        }}
                    />
                </div>

                <div
                    style={{
                        position: 'absolute',
                        bottom: 10,
                        right: 5,
                        fontSize: 9,
                        color: '#fff',
                        textShadow: '0 1px 2px black'
                    }}
                >
                    {player.xp || 0} / {xpNeed} XP
                </div>
            </div>

            {/* =========================
               ABAS
            ========================= */}
            <div style={{ display: 'flex', gap: 10, marginBottom: 15, overflowX: 'auto' }}>
                <button className={`btn ${tab === 'PERFIL' ? 'btn-blue' : 'btn-ghost'}`} onClick={() => setTab('PERFIL')}>PERFIL</button>
                <button className={`btn ${tab === 'ACOES' ? 'btn-red' : 'btn-ghost'}`} onClick={() => setTab('ACOES')}>A√á√ïES</button>
                <button className={`btn ${tab === 'CARREIRA' ? 'btn-purple' : 'btn-ghost'}`} onClick={() => setTab('CARREIRA')}>CARREIRA</button>
                <button className={`btn ${tab === 'INV' ? 'btn-gold' : 'btn-ghost'}`} onClick={() => setTab('INV')}>MOCHILA ({myItems.length})</button>
            </div>

            {/* =========================
               PERFIL
            ========================= */}
            {tab === 'PERFIL' && (
                <div>
                    <div className="card" style={{ borderLeft: '4px solid var(--primary)' }}>
                        <h3 style={{ marginTop: 0 }}>üè¶ {fmt(player.balance)}</h3>
                        <small style={{ color: '#aaa' }}>
                            Sal√°rio: {fmt(player.salary)} | Passe: {fmt(player.value)}
                        </small>
                    </div>
                </div>
            )}

            {/* =========================
               A√á√ïES
            ========================= */}
            {tab === 'ACOES' && (
                <div>
                    <div className="card">
                        <h4>üîê Seguran√ßa</h4>
                        <div style={{ display: 'flex', gap: 5 }}>
                            <input
                                className="input-field"
                                type="password"
                                placeholder="Nova Senha"
                                value={newPass}
                                onChange={e => setNewPass(e.target.value)}
                                style={{ marginBottom: 0 }}
                            />
                            <button
                                className="btn btn-purple"
                                style={{ width: 'auto' }}
                                onClick={() => {
                                    if (!newPass) return alert('Digite uma senha!');
                                    onUpdatePassword(newPass);
                                    setNewPass('');
                                }}
                            >
                                ALTERAR
                            </button>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};
//fim

        // üì¨ TELA DE PROPOSTAS RECEBIDAS
// Exibe apenas ofertas destinadas ao usu√°rio logado.
// O jogador pode aceitar, recusar ou enviar uma contraproposta.
// Decis√µes afetam reputa√ß√£o e rela√ß√µes no mercado.

const OffersScreen = ({ user, offers, teams, onAccept, onReject, onCounter }) => {

    // üéØ FILTRO CRUCIAL: Mostra apenas ofertas onde EU sou o destinat√°rio
    // Se recipientId n√£o existir (ofertas antigas), mostra para o dono (sellerId)
    const myOffers = offers.filter(o => 
        o.recipientId === user.data.id ||
        (!o.recipientId && o.sellerId === user.data.id)
    );

    return (
        <div>

            <h3>Caixa de Entrada ({myOffers.length})</h3>

            {myOffers.length === 0 && (
                <p style={{ color:'#666', textAlign:'center' }}>
                    Nenhuma proposta aguardando sua resposta.
                </p>
            )}

            {myOffers.map(o => (
                <div key={o.id} className="card" style={{ borderLeft:'4px solid gold' }}>

                    <div style={{ display:'flex', justifyContent:'space-between' }}>
                        <b style={{ color:'var(--primary)', fontSize:16 }}>
                            {o.playerName}
                        </b>
                        <span style={{ fontSize:10, color:'gold', fontWeight:'bold' }}>
                            {o.type}
                        </span>
                    </div>

                    <small style={{ display:'block', marginBottom:10 }}>
                        De: <b>{o.buyerName}</b>
                    </small>

                    <div
                        style={{
                            background:'#222',
                            padding:10,
                            borderRadius:8,
                            whiteSpace:'pre-wrap',
                            fontSize:12,
                            border:'1px solid #333',
                            lineHeight:'1.4'
                        }}
                    >
                        {o.description}
                    </div>

                    <div style={{ display:'flex', gap:5, marginTop:12 }}>
                        <button className="btn btn-green" style={{ flex:1 }} onClick={() => onAccept(o)}>
                            ACEITAR
                        </button>
                        <button className="btn btn-blue" style={{ flex:1 }} onClick={() => onCounter(o)}>
                            CONTRA
                        </button>
                        <button className="btn btn-red" style={{ flex:1 }} onClick={() => onReject(o)}>
                            RECUSAR
                        </button>
                    </div>

                </div>
            ))}

            {/* Rodap√© visual */}
            <p style={{ marginTop: 15, fontSize: 10, color: '#777', textAlign: 'center' }}>
                ‚ö†Ô∏è Propostas n√£o respondidas podem expirar automaticamente.
            </p>

        </div>
    );
};
//fim





        

// üèÜ RANKING GERAL DO CAMPEONATO
// Exibe rankings de clubes e jogadores.
// Clubes s√£o ordenados por patrim√¥nio total (saldo + valor do elenco).
// Jogadores s√£o ranqueados por overall, sal√°rio e estat√≠sticas.
// Jogadores sem time v√°lido s√£o automaticamente ignorados.

const Ranking = ({ teams, players }) => {

    const [view, setView] = React.useState('TEAMS');

    // Filtra para n√£o mostrar jogadores bugados (sem time)
    const validPlayers = players.filter(
        p => p.teamId && p.teamId !== 'FREE' && p.name
    );

    // üìä Ranking de Clubes por Patrim√¥nio
    const renderTeams = () => teams
        .filter(t => t.status !== 'PENDING')
        .map(t => {
            const squadValue = validPlayers
                .filter(p => p.teamId === t.id)
                .reduce((a, b) => a + (parseFloat(b.value) || 0), 0);

            return {
                ...t,
                squadValue,
                totalWealth: (parseFloat(t.balance) || 0) + squadValue
            };
        })
        .sort((a, b) => b.totalWealth - a.totalWealth)
        .map((t, i) => (
            <div
                key={t.id}
                className="card"
                style={{ display: 'flex', alignItems: 'center', gap: 10 }}
            >
                <b style={{ fontSize: 20, color: '#555', width: 30 }}>
                    {i + 1}
                </b>

                {t.logo ? (
                    <img
                        src={t.logo}
                        style={{
                            width: 35,
                            height: 35,
                            borderRadius: '50%',
                            objectFit: 'cover'
                        }}
                    />
                ) : (
                    <div style={{ width: 35 }}></div>
                )}

                <div style={{ flex: 1 }}>
                    <b>{t.name}</b><br />
                    <small style={{ color: 'var(--primary)', fontWeight: 'bold' }}>
                        Patrim√¥nio: {fmt(t.totalWealth)}
                    </small>
                </div>
            </div>
        ));

    // üë§ Ranking de Jogadores
    const renderPlayers = (sortKey, label, color, isStat = true) => {

        let sorted = [];

        if (isStat) {
            sorted = validPlayers
                .filter(p => p.stats && p.stats[sortKey] > 0)
                .sort(
                    (a, b) =>
                        (b.stats[sortKey] || 0) - (a.stats[sortKey] || 0)
                );
        } else {
            sorted = [...validPlayers].sort(
                (a, b) =>
                    (parseFloat(b[sortKey]) || 0) -
                    (parseFloat(a[sortKey]) || 0)
            );
        }

        return sorted.slice(0, 20).map((p, i) => (
            <div
                key={p.id}
                className="card"
                style={{ display: 'flex', alignItems: 'center', gap: 10 }}
            >
                <b style={{ fontSize: 20, color: '#555', width: 30 }}>
                    {i + 1}
                </b>

                <div style={{ flex: 1 }}>
                    <b>{p.name}</b>{' '}
                    <small>
                        ({teams.find(t => t.id === p.teamId)?.name})
                    </small>
                </div>

                <div style={{ fontWeight: 'bold', fontSize: 14, color }}>
                    {label}{' '}
                    {isStat
                        ? p.stats[sortKey]
                        : sortKey === 'salary'
                        ? fmt(p[sortKey])
                        : p[sortKey]}
                </div>
            </div>
        ));
    };

    return (
        <div>

            <h3>Ranking e Estat√≠sticas</h3>

            {/* Abas de navega√ß√£o */}
            <div className="rank-tabs">
                <div className={`rank-tab ${view === 'TEAMS' ? 'active' : ''}`} onClick={() => setView('TEAMS')}>üí∞ Clubes</div>
                <div className={`rank-tab ${view === 'OVERALL' ? 'active' : ''}`} onClick={() => setView('OVERALL')}>‚≠ê Craques</div>
                <div className={`rank-tab ${view === 'SALARY' ? 'active' : ''}`} onClick={() => setView('SALARY')}>üí∏ Sal√°rios</div>
                <div className={`rank-tab ${view === 'GOALS' ? 'active' : ''}`} onClick={() => setView('GOALS')}>‚öΩ Gols</div>
                <div className={`rank-tab ${view === 'ASSIST' ? 'active' : ''}`} onClick={() => setView('ASSIST')}>üëü Assis</div>
                <div className={`rank-tab ${view === 'SAVES' ? 'active' : ''}`} onClick={() => setView('SAVES')}>üß§ Defesas</div>
                <div className={`rank-tab ${view === 'YEL' ? 'active' : ''}`} onClick={() => setView('YEL')}>üü® Amarelos</div>
                <div className={`rank-tab ${view === 'RED' ? 'active' : ''}`} onClick={() => setView('RED')}>üü• Vermelhos</div>
            </div>

            <div style={{ marginTop: 10 }}>
                {view === 'TEAMS' && renderTeams()}
                {view === 'OVERALL' && renderPlayers('overall', 'Ov:', 'var(--warning)', false)}
                {view === 'SALARY' && renderPlayers('salary', '', 'var(--primary)', false)}
                {view === 'GOALS' && renderPlayers('goals', '‚öΩ', '#fff')}
                {view === 'ASSIST' && renderPlayers('assists', 'üëü', '#fff')}
                {view === 'SAVES' && renderPlayers('saves', 'üß§', '#fff')}
                {view === 'YEL' && renderPlayers('yellows', 'üü®', 'yellow')}
                {view === 'RED' && renderPlayers('reds', 'üü•', 'red')}
            </div>

        </div>
    );
};

// üîö FIM DO COMPONENTE RANKING


// =====================================================
// IN√çCIO ‚Äî COMPONENTES QUE FALTAVAM (S√öMULA E TABELA)
// ESQUECIDO ANTES:
// - Trava de seguran√ßa da NOTA (0 a 10)
// - Organiza√ß√£o visual da S√∫mula
// - Separa√ß√£o clara entre S√∫mula e Tabela
// =====================================================

const MatchPerformanceForm = ({ players, teams, onSaveStats }) => {
    const [selP, setSelP] = useState(null);
    const [search, setSearch] = useState('');

    // Dados da partida
    const [match, setMatch] = useState({
        goals: 0,
        assists: 0,
        tackles: 0,
        saves: 0,
        yellows: 0,
        reds: 0,
        rating: '',
        result: 'NENHUM'
    });

    // =====================================================
    // C√ÅLCULO DE XP (INTERNO ‚Äî N√ÉO APARECE PARA O JORNALISTA)
    // =====================================================
    const calcMatchXP = () => {
        let xp = 0;

        const R = (typeof XP_RULES !== 'undefined')
            ? XP_RULES
            : {
                GOAL: 150,
                ASSIST: 120,
                TACKLE: 80,
                SAVE: 100,
                WIN: 300,
                DRAW: 100,
                LOSS: -100,
                YELLOW: -50,
                RED: -200,
                RATING_MULT: 50
            };

        xp += (match.goals || 0) * R.GOAL;
        xp += (match.assists || 0) * R.ASSIST;
        xp += (match.tackles || 0) * R.TACKLE;
        xp += (match.saves || 0) * R.SAVE;
        xp += (match.yellows || 0) * R.YELLOW;
        xp += (match.reds || 0) * R.RED;

        if (match.result === 'VITORIA') xp += R.WIN;
        if (match.result === 'EMPATE') xp += R.DRAW;
        if (match.result === 'DERROTA') xp += R.LOSS;

        // NOTA DO JORNALISTA (TRAVADA ENTRE 0 E 10)
        xp += (parseFloat(match.rating) || 0) * R.RATING_MULT;

        return parseInt(xp);
    };

    const filtered = players.filter(p =>
        p.name.toLowerCase().includes(search.toLowerCase())
    );

    // =====================================================
    // TELA DA S√öMULA (JOGADOR SELECIONADO)
    // =====================================================
    if (selP) return (
        <div>
            <h3 style={{ color: 'var(--primary)' }}>S√∫mula: {selP.name}</h3>

            <div style={{
                background: 'rgba(255,255,255,0.05)',
                padding: 10,
                borderRadius: 8,
                marginBottom: 10
            }}>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10 }}>
                    <div><label>‚öΩ Gols</label>
                        <input className="input-field" type="number"
                            value={match.goals}
                            onChange={e => setMatch({ ...match, goals: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div><label>üëü Assist√™ncias</label>
                        <input className="input-field" type="number"
                            value={match.assists}
                            onChange={e => setMatch({ ...match, assists: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div><label>üõ°Ô∏è Desarmes</label>
                        <input className="input-field" type="number"
                            value={match.tackles}
                            onChange={e => setMatch({ ...match, tackles: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div><label>üß§ Defesas</label>
                        <input className="input-field" type="number"
                            value={match.saves}
                            onChange={e => setMatch({ ...match, saves: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div><label>üü® Amarelos</label>
                        <input className="input-field" type="number"
                            value={match.yellows}
                            onChange={e => setMatch({ ...match, yellows: parseInt(e.target.value) || 0 })}
                        />
                    </div>

                    <div><label>üü• Vermelhos</label>
                        <input className="input-field" type="number"
                            value={match.reds}
                            onChange={e => setMatch({ ...match, reds: parseInt(e.target.value) || 0 })}
                        />
                    </div>
                </div>

                <hr style={{ borderColor: '#444' }} />

                {/* TRAVA DE SEGURAN√áA DA NOTA */}
                <label>‚≠ê Nota da Atua√ß√£o (0 a 10)</label>
                <input
                    className="input-field"
                    type="number"
                    step="0.1"
                    min="0"
                    max="10"
                    placeholder="0.0 a 10.0"
                    value={match.rating}
                    onChange={e => {
                        let v = parseFloat(e.target.value);
                        if (v > 10) v = 10;
                        if (v < 0) v = 0;
                        setMatch({ ...match, rating: v });
                    }}
                />

                <label>üö© Resultado do Time</label>
                <select
                    className="input-field"
                    value={match.result}
                    onChange={e => setMatch({ ...match, result: e.target.value })}
                >
                    <option value="NENHUM">Neutro</option>
                    <option value="VITORIA">Vit√≥ria</option>
                    <option value="EMPATE">Empate</option>
                    <option value="DERROTA">Derrota</option>
                </select>
            </div>

            <div style={{ display: 'flex', gap: 10 }}>
                <button className="btn btn-green"
                    onClick={() => onSaveStats(selP, match, calcMatchXP())}>
                    LAN√áAR NA S√öMULA
                </button>
                <button className="btn" onClick={() => setSelP(null)}>VOLTAR</button>
            </div>
        </div>
    );

    // =====================================================
    // TELA DE BUSCA DE JOGADOR
    // =====================================================
    return (
        <div>
            <h3>Lan√ßar Desempenho</h3>
            <input
                className="input-field"
                placeholder="Buscar jogador..."
                value={search}
                onChange={e => setSearch(e.target.value)}
            />

            <div style={{ maxHeight: 300, overflowY: 'auto' }}>
                {search.length > 0 && filtered.map(p => (
                    <div
                        key={p.id}
                        className="card"
                        onClick={() => {
                            setSelP(p);
                            setMatch({
                                goals: 0,
                                assists: 0,
                                tackles: 0,
                                saves: 0,
                                yellows: 0,
                                reds: 0,
                                rating: '',
                                result: 'NENHUM'
                            });
                        }}
                    >
                        <b>{p.name}</b>
                        <small> ({teams.find(t => t.id === p.teamId)?.name})</small>
                    </div>
                ))}
            </div>
        </div>
    );
};

// =====================================================
// FIM ‚Äî MATCH PERFORMANCE FORM
// =====================================================




        

        const root = ReactDOM.createRoot(document.getElementById('root'));

        root.render(<ErrorBoundary><App /></ErrorBoundary>);

    </script>

</body>

</html>
